<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Money SS Supervisor</title>
    <link rel="shortcut icon" href="../assets/img/profile_small.png"/>
    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css" integrity="sha384-oS3vJWv+0UjzBfQzYUhtDYW+Pj2yciDJxpsK1OYPAYjqT085Qq/1cq5FLXAZQ7Ay" crossorigin="anonymous">
    <link href="../font-awesome/css/font-awesome.css" rel="stylesheet">
    <link href="../css/plugins/iCheck/custom.css" rel="stylesheet">
    <link href="../css/animate.css" rel="stylesheet">
    <link href="../assets/css/StyleS.css" rel="stylesheet">
    <link href="../css/plugins/sweetalert/sweetalert.css" rel="stylesheet">
    <link href="../css/plugins/toastr/toastr.min.css" rel="stylesheet">
    <link href="../css/datetimepicker.css" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/6.0.4/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/5.9.1/firebase-storage.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>


    <script>
        if ( typeof module === "object" && typeof module.exports === "object" ) {
            window.$ = window.jQuery = require('jquery');
        }

        var NombreEmpresa = "";
        var nombreAsesorReporte = "";

        function generarPDFCierre(){

            var doc = new window.jspdf.jsPDF();

            var fecha = new Date();
            var fechaFormateada = fecha.getDate() + "-" + (fecha.getMonth() + 1) + "-" + fecha.getFullYear();
            var hora = fecha.getHours() + ":" + fecha.getMinutes() + ":" + fecha.getSeconds();

            var baseDiaria = document.getElementById('text_baseAsesor').textContent;
            var totalRecaudado = document.getElementById('text_recolectadoAsesor').textContent;
            var totalGastos = document.getElementById('text_gastosAsesor').textContent;
            var totalSistema = document.getElementById('text_total_sistema').textContent;
            var totalAsesor = document.getElementById('text_total_asesor').value;
            var totalDiferencia = document.getElementById('text_diferencia_cierre').textContent;
            var selectElement = document.getElementById('id_asesor_cierre');
            var datosAsesor = selectElement.options[selectElement.selectedIndex].text;
            var nombreAsesorReportee = datosAsesor.match(/^(.*?)\sID:/)[1];

            //Gastos
            var tabla = document.getElementById('lista_gastos_exeAsesor');
            var filas = tabla.getElementsByTagName('tr');
            var datos = [];
            var total = 0;

            //Cobros
            var tabla1 = document.getElementById('listado_cobros_cierre');
            var datos2 = [];
            var total2 = 0; 

            doc.setFontSize(18);
            doc.setFont("Helvetica","bold")
            doc.text(NombreEmpresa,105,10,null,null,"center");
            doc.text("Reporte de Cierre",105,20,null,null,"center")
            doc.setFontSize(10);


            doc.text("Fecha: "+ fechaFormateada + "  Hora: " + hora,10,30);
            doc.text("Nombre de asesor: " + nombreAsesorReportee,10,50);
            doc.setFillColor(200, 200, 200);
            doc.rect(0, 55, 210,10, "F");
            doc.text("Base diaria: " + baseDiaria,10,60);
            doc.text("Total recaudado: "+ totalRecaudado, 70, 60);
            doc.text("Total gastos: " + totalGastos, 140,60);

            doc.text("Total sistema: " + totalSistema,10,70);
            doc.text("Total asesor: " + totalAsesor,70,70);
            doc.text("Diferencia: " + totalDiferencia, 140, 70);

            doc.setFillColor(200,200,200);
            doc.rect(0,95,210,10,"F");
            doc.text("DPI", 10,100);
            doc.text("Nombre Cliente",35,100);
            doc.text("Dirección",100,100);
            doc.text("Monto",170,100);
            doc.text("Hora",190,100);

            //Cobros

            for (var i = 0; i < tabla1.rows.length; i++) {
                var dpi = tabla1.rows[i].cells[0].innerText;
                var nombre = tabla1.rows[i].cells[1].innerText;
                var direccion = tabla1.rows[i].cells[2].innerText;
                var montoTexto = tabla1.rows[i].cells[3].innerText;
                var montoNumero = parseFloat(montoTexto.replace("Q", ""));
                var hora = tabla1.rows[i].cells[4].innerText;
                if (!isNaN(montoNumero)) {
                    datos2.push({
                        dpi: dpi,
                        nombre: nombre,
                        direccion: direccion,
                        monto: montoNumero,
                        hora: hora
                    });
                    total2 += montoNumero; 
                    }
                }

            var y1 = 110;
            var maxPageHeight = doc.internal.pageSize.height -20;

            for(var i = 0; i < datos2.length; i++){
                if (y > maxPageHeight) {
                    doc.addPage();
                    y=20; 
                    doc.setTextColor(0 ,0 ,0);
                    doc.text('DPI',10,y);
                    doc.text('Nombre Cliente',50,y1);
                    doc.text('Dirección',130,y1);
                    doc.text('Monto',170,y1);
                    doc.text('Hora',190,y1);
                    y +=10; 
                }
                doc.setTextColor(0, 0, 0); 
                doc.setFont("bold");
                doc.setFontSize(10)
                doc.text(datos2[i].dpi.toString(), 10, y1);
                doc.text(datos2[i].nombre.toString(), 35, y1);
                doc.text(datos2[i].direccion.toString(), 100, y1);
                doc.text("Q"+datos2[i].monto.toString(), 170, y1);
                doc.text(datos2[i].hora.toString(), 190, y1);
                doc.setFont("normal");
                doc.setFontSize(12);

                if (i < datos2.length - 1) {
                    if (y1 + 15 > maxPageHeight) {
                        doc.addPage();
                        y1 = 20;
                    }
                    doc.line(10, y1 + 5, 200, y1 + 5);
                }
                y1 += 10; 
                
            }

            if(y1 > maxPageHeight){
                doc.addPage();
                y1 = 20
            }

            doc.setTextColor(0,0,0)
            doc.setFont("Helvetica","bold");
            doc.text("Total:                                                                                                                            Q"+ total2.toString(),10,y1);

            //Gastos
            var datos = [];
            var total = 0;

            for(var i = 0; i < filas.length; i++){
                var celdas = filas[i].getElementsByTagName("td");
                if(celdas.length === 2){
                    var motivo = celdas[0].textContent;
                    var monto = parseFloat(celdas[1].textContent.replace("Q",""));
                    datos.push({motivo: motivo, monto: monto});
                    total += monto;
                }
            }

            var y = y1 + 20;

            doc.setFillColor(200,200,200);
            doc.rect(0,y -10, 210,10, "F");
            doc.setTextColor(0,0,0);
            doc.text("Motivo de gasto",10, y -4);
            doc.text("Monto",170, y -4);
            y += 10;

            for(var i = 0; i < datos.length; i ++){
                if(y > maxPageHeight){
                    doc.addPage();
                    y = 20;
                    doc.setTextColor(0,0,0);
                    doc.text("Motivo de gasto",10, y);
                    doc.text("Monto",170,y);
                    y += 10;
                }
                doc.setTextColor(0, 0, 0);
                doc.setFont("bold");
                doc.setFontSize(10);
                doc.text(datos[i].motivo.toString(), 10, y);
                doc.text("Q" + datos[i].monto.toString(), 170, y);
                doc.setFont("normal");
                doc.setFontSize(12);
                if (i < datos.length - 1) {
                    doc.line(10, y + 5, 200, y + 5);
                }
                y += 10;
            }

            if(y > maxPageHeight){
                doc.addPage();
                y = 20;
            }

            doc.setTextColor(0,0,0)
            doc.setFont("Helvetica", "bold");
            doc.text("Total:                                                                                                                              Q"+ total.toString(),10,y);

            //doc.save('Reporte Cierre.pdf');
            doc.save('Reporte Cierre de Fecha: ' + fechaFormateada + ' Hora:' + hora + '.pdf'); 
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('boton_pdf_cierre').addEventListener('click', function() {
                generarPDFCierre();
            });
        });

        function generarPDFCobros(){
            var doc = new window.jspdf.jsPDF();
            var img = new Image();

            var fecha = new Date();
            var fechaFormateada = fecha.getDate() + "-" + (fecha.getMonth() + 1) + "-" + fecha.getFullYear();
            var hora = fecha.getHours() + ":" + fecha.getMinutes() + ":" + fecha.getSeconds();

            var tabla = document.getElementById('listado_cobros_por_fechas');
            var datos = [];
            var total = 0;
            var selectElement = document.getElementById('id_asesor_cobros');
            var datosAsesor = selectElement.options[selectElement.selectedIndex].text;
            var nombreAsesorReportee = datosAsesor.match(/^(.*?)\sID:/)[1];

            for (var i = 0; i < tabla.rows.length; i++) {
                var montoTexto = tabla.rows[i].cells[3].innerText;
                var montoNumero = parseFloat(montoTexto.replace("Q", ""));
                if (!isNaN(montoNumero)) {
                    datos.push({
                        dpi: tabla.rows[i].cells[0].innerText,
                        nombre: tabla.rows[i].cells[1].innerText,
                        direccion: tabla.rows[i].cells[2].innerText,
                        monto: montoNumero,
                        hora: tabla.rows[i].cells[4].innerText
                    });
                    total += montoNumero; 
                }
            }
            
            doc.setFillColor(200, 200, 200);
            doc.rect(0, 35, 210, 10, 'F');
            doc.setFontSize(18);
            doc.setFont('Helvetica', 'bold')
            doc.text(NombreEmpresa, 105, 10, null, null, "center");
            doc.text("Reporte de cobros", 105, 20, null, null, "center");
            doc.setFontSize(10);

            doc.text('Fecha: ' + fechaFormateada + ' Hora: ' + hora, 10, 30);
            doc.text("Nombre de asesor: "+nombreAsesorReportee, 100, 30);

            doc.setTextColor(0, 0, 0); 
            doc.text('DPI', 10, 40);
            doc.text('Nombre Cliente', 40, 40);
            doc.text('Dirección', 110, 40);
            doc.text('Monto', 160, 40);
            doc.text('Hora', 180, 40);

            var y = 50;
            var maxPageHeight = doc.internal.pageSize.height - 20; 

            for (var i = 0; i < datos.length; i++) {
                if (y > maxPageHeight) {
                    doc.addPage();
                    y = 20; 
                    doc.setTextColor(255, 255, 255);
                    doc.text('DPI', 10, y);
                    doc.text('Nombre Cliente', 40, y);
                    doc.text('Dirección', 110, y);
                    doc.text('Monto', 160, y);
                    doc.text('Hora', 180, y);
                    y += 10; 
                }
                doc.setTextColor(0, 0, 0); 
                doc.setFont("bold");
                doc.setFontSize(8)
                doc.text(datos[i].dpi.toString(), 10, y);
                doc.text(datos[i].nombre.toString(), 40, y);
                doc.text(datos[i].direccion.toString(), 110, y);
                doc.text("Q"+datos[i].monto.toString(), 160, y);
               
                doc.text(datos[i].hora.toString(),180,y)
                doc.setFont("normal");
                doc.setFontSize(12);
                if (i < datos.length - 1) {
                    if (y + 15 > maxPageHeight) { 
                        doc.addPage();
                        y = 20;
                    }
                    doc.line(10, y + 5, 200, y + 5); 
                }
                y += 10; 
            }

            if (y > maxPageHeight) {
                doc.addPage();
                y = 20;
            }

            doc.setTextColor(0, 0, 0);
            doc.setFont('Helvetica', 'bold'); 
            doc.text('Total monto', 10, y);
            doc.text("Q" + total.toString(), 160, y);
            doc.setFont('Helvetica'); 

            doc.save('Reporte de gastos por cobros ' + fechaFormateada + ' Hora:' + hora + '.pdf');            
        }

        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('boton_Reporte_Cobros').addEventListener('click', function() {
                generarPDFCobros();
            });
        });

        function generarPDFGastos() {
            
            var doc = new window.jspdf.jsPDF();

            var fecha = new Date();
            var fechaFormateada = fecha.getDate() + "-" + (fecha.getMonth() + 1) + "-" + fecha.getFullYear();
            var hora = fecha.getHours() + ":" + fecha.getMinutes() + ":" + fecha.getSeconds();

            var tabla = document.getElementById('lista_gastos_exe');
            var datos = [];
            var total = 0;
            var selectElement = document.getElementById('id_asesor_gastos_consulta');
            var datosAsesor = selectElement.options[selectElement.selectedIndex].text;
            var nombreAsesorReportee = datosAsesor.match(/^(.*?)\sID:/)[1];

            for (var i = 0; i < tabla.rows.length; i++) {
                var montoTexto = tabla.rows[i].cells[1].innerText;
                var montoNumero = parseFloat(montoTexto.replace("Q", ""));
                if (!isNaN(montoNumero)) {
                    datos.push({
                        motivo: tabla.rows[i].cells[0].innerText,
                        monto: montoNumero
                    });
                    total += montoNumero; 
                } 
            }

            doc.setFillColor(200, 200, 200);
            doc.rect(0, 35, 210, 10, 'F');
            doc.setFontSize(18);
            doc.setFont('Helvetica', 'bold');
            doc.text(NombreEmpresa, 105, 10, null, null, "center");
            doc.text("Reporte de gastos", 105, 20, null, null, "center");
            doc.setFontSize(12);
            
            doc.text('Fecha: ' + fechaFormateada + ' Hora: ' + hora, 10, 30);
            doc.text("Nombre de asesor: "+nombreAsesorReportee, 100, 30);

            doc.setTextColor(0, 0, 0);
            doc.text('Motivo de gasto', 10, 40);
            doc.text('Monto', 160, 40);

            var y = 50;
            var maxPageHeight = doc.internal.pageSize.height - 20; 

            
            for (var i = 0; i < datos.length; i++) {
                
                if (y > maxPageHeight) {
                    doc.addPage();
                    y = 20; 
                    doc.setTextColor(255, 255, 255);
                    doc.text('Motivo de gasto', 10, y);
                    doc.text('Monto', 160, y);
                    y += 10; 
                }
                doc.setTextColor(0, 0, 0); 
                doc.setFont("bold");
                doc.setFontSize(10)
                doc.text(datos[i].motivo.toString(), 10, y);
                doc.text("Q"+datos[i].monto.toString(), 160, y);
                doc.setFont("normal");
                doc.setFontSize(12);
                if (i < datos.length - 1) {
                    doc.line(10, y + 5, 200, y + 5);
                }
                y += 10; 
            }

            
            if (y > maxPageHeight) {
                doc.addPage();
                y = 20;
            }

            doc.setTextColor(0, 0, 0);
            doc.setFont('Helvetica', 'bold'); 
            doc.text('Total', 10, y);
            doc.text("Q" + total.toString(), 160, y);
            doc.setFont('Helvetica');        

            doc.save('Reporte de gastos por fechas ' + fechaFormateada + ' Hora:' + hora + '.pdf');        
        }

        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('boton_Reporte_Gastos').addEventListener('click', function() {
                generarPDFGastos();
            });
        });

    </script>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
                document.getElementById('buscarContratos').addEventListener('input', function() {
                    let searchValue = this.value.toLowerCase();
                    let rows = document.querySelectorAll('#lista_enorme tr');
                    for (let row of rows) {
                        let dpiCell = row.querySelector('td:nth-child(3)');
                        if (dpiCell) {
                            let dpiValue = dpiCell.textContent.toLowerCase();
                            row.style.display = dpiValue.includes(searchValue) ? '' : 'none';
                        }
                    }
                });
            });
    </script>

    <style>
        @media (max-width: 576px) {
            .profile-info{
                margin-left: 0%;
            }
            .profile-image{
                margin-left: 31%;
            }
            .modalete{
                left: -3% !important;
                width: auto !important;
            }
        }
        /*@media (max-width: 768px) {
            .profile-info{
                margin-left: 0%;
            }
            .profile-info{
                margin-left: 0%;
            }
        }*/
        /*@media (max-width: 992px) {
            .profile-info{
                margin-left: 0%;
            }
            .profile-info{
                margin-left: 0%;
            }
        }*/
        /*@media (max-width: 1200px) {
            .profile-info{
                margin-left: 0%;
            }
            .profile-info{
                margin-left: 0%;
            }
        }*/
    </style>
</head>

<body class="fixed-sidebar no-skin-config full-height-layout">

<div id="wrapper">

    <div class="modal inmodal" id="identidad_fotos" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content animated bounceInRight">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal"><span
                            aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                    <h4 class="modal-title">Información visual</h4>
                </div>
                <div class="modal-body" align="center">
                    <div class="col-xs-12">
                        <img id="idfoto" class="ima" src="../img/profile_small.png"
                             style="padding:4px;max-width: 100%;height: auto;display:block;"/>
                    </div>
                    <div class="col-xs-12 img-fluid">
                        <img id="caratula" class="ima" src="../img/profile_small.png"
                             style="padding:4px;max-width: 100%;height: auto;display:block;"/>
                    </div>
                    <div class="col-xs-12 img-fluid">
                        <img id="reverso" class="ima" src="../img/profile_small.png"
                             style="padding:4px;max-width: 100%;height: auto;display:block;"/>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-white" data-dismiss="modal">Cerrar</button>
                </div>
            </div>
        </div>
    </div>
	
	<div class="modal inmodal" id="modal_comporta" tabindex="-1" role="dialog" aria-hidden="true">
		<div class="modal-dialog modal-lg">
			<div class="modal-content animated fadeIn">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
					<h4 class="modal-title">Comportamiento</h4>
				</div>
				<div class="modal-body">
					<div class="row">
						 <div class="col-sm-4 col-md-4 col-xs-12">
							<table class="table">
								<thead>
								<tr>
									<th colspan="3" style="color:white;background-color:#28a745cc;">Contratos completos</th>
								</tr>
								</thead>
								<tbody>
								<tr>
									<td>Cantidad:</td>
									<td>Porcentaje:</td>
									<td>Total:</td>
								</tr>
								<tr>
									<td id="com_canti"></td>
									<td id="com_porce"></td>
									<td id="com_valor"></td>
								</tr>
								</tbody>
							</table>
						</div>
						
						<div class="col-sm-4 col-md-4 col-xs-12">
							<table class="table">
								<thead>
								<tr>
									<th colspan="3" style="color:white;background-color:#fd7e14cc;">Cuotas incompletas</th>
								</tr>
								</thead>
								<tbody>
								<tr>
									<td>Cantidad:</td>
									<td>Porcentaje:</td>
									<td>Total:</td>
								</tr>
								<tr>
									<td id="mcom_canti"></td>
									<td id="mcom_porce"></td>
									<td id="mcom_valor"></td>
								</tr>
								</tbody>
							</table>
						</div>
						
						
						<div class="col-sm-4 col-md-4 col-xs-12">
							<table class="table">
								<thead>
								<tr>
									<th colspan="3" style="color:white;background-color:#dc3545cc;">Cuotas no pagadas</th>
								</tr>
								</thead>
								<tbody>
								<tr>
									<td>Cantidad:</td>
									<td>Porcentaje:</td>
									<td>Total:</td>
								</tr>
								<tr>
									<td id="incom_canti"></td>
									<td id="incom_porce"></td>
									<td id="incom_valor"></td>
								</tr>
								</tbody>
							</table>
						</div>
						
						<div class="col-sm-4 col-md-4 col-xs-12">
							<table class="table">
								<thead>
								<tr>
									<th colspan="3" style="color:white;background-color:#007bffcc;">Recaudado de cuotas incompletas</th>
								</tr>
								</thead>
								<tbody>
								<tr>
									<td>Cantidad:</td>
									<td>Porcentaje:</td>
									<td>Total:</td>
								</tr>
								<tr>
									<td id="rcom_canti"></td>
									<td id="rcom_porce"></td>
									<td id="rcom_valor"></td>
								</tr>
								</tbody>
							</table>
						</div>
						
						<div class="col-sm-4 col-md-4 col-xs-12">
							<table class="table">
								<thead>
								<tr>
									<th colspan="3" style="color:white;background-color:#ffc107cc;">Estimación del monto pendiente</th>
								</tr>
								</thead>
								<tbody>
								<tr>
									<td>Cantidad:</td>
									<td>Porcentaje:</td>
									<td>Total:</td>
								</tr>
								<tr>
									<td id="ecom_canti"></td>
									<td id="ecom_porce"></td>
									<td id="ecom_valor"></td>
								</tr>
								</tbody>
							</table>
						</div>
						
						<div class="col-sm-4 col-md-4 col-xs-12">
							<table class="table">
								<thead>
								<tr>
									<th colspan="3" style="color:white;background-color:#343a40cc;">Capital</th>
								</tr>
								</thead>
								<tbody>
								<tr>
									<td>Total:</td>
								</tr>
								<tr>
									<td id="todi_capi"></td>
								</tr>
								</tbody>
							</table>
						</div>
					</div>
				</div>
				<div class="modal-footer">
					<label style="margin-top: 6px;" id="capital_neto"></label><button type="button" class="btn btn-white" data-dismiss="modal">Close</button>
				</div>
			</div>
		</div>
	</div>

    <nav class="navbar-default navbar-static-side" role="navigation">
        <div class="sidebar-collapse">
            <ul class="nav metismenu" id="side-menu">
                <li class="nav-header">
                    <div class="dropdown profile-element">
                        <img alt="image" src="../img/profile_small.png"
                             style="margin-top: -24px; width: 120px; height: 75px; margin-left: 8%"/>
                        <a data-toggle="dropdown" class="dropdown-toggle" href="index.html">
                            <span class="block m-t-xs font-bold" style="margin-left: 21%;">Supervisor</span>
                        </a>
                    </div>
                    <div class="logo-element">
                        ME
                    </div>
                </li>
                <!-- <li>
                    <a href="#"><i class="fa fa-user"></i> <span class="nav-label">Clientes</span><span class="fa arrow"></span></a>
                    <ul class="nav nav-second-level collapse">
                        <li><a href="javascript:crear_infor();">Registrar</a></li>
                        <li><a href="javascript:cliente_lista();">Consultar</a></li>
                    </ul>
                </li> -->
                <li>
                    <a href="#"><i class="fa fa-copy"></i> <span class="nav-label">Contratos de asesores</span><span class="fa arrow"></span></a>
                    <ul class="nav nav-second-level collapse">
                        <!-- <li><a href="javascript:crear_contrato();">Registrar</a></li> -->
                        <li><a href="javascript:vers_contratos();">Consultar</a></li>
                    </ul>
                </li>
                <li>
                    <a href="#"><i class="fa fa-hand-holding-usd"></i> <span class="nav-label">Administración</span><span class="fa arrow"></span></a>
                    <ul class="nav nav-second-level collapse">
                        <li><a href="javascript:informe_completo();">Liquidación</a></li>
                        <li><a href="javascript:informe_completo_cobros();">Consultar cobros</a></li>
                        <li><a href="javascript:informe_completo_gastos();">Consultar gastos</a></li>
                        <li><a href="javascript:informe_completo_cierre();">Cierre</a></li>
                    </ul>
                </li>              
                <li>
                    <a id="couta_search" href="javascript:buscar_mapa();"><i class="fa fa-map-marker"></i> <span
                    class="nav-label">Mapa de clientes</span></a>
                </li>
                <li>
                    <a id="couta_search" href="javascript:historial_clientes();"><i class="fa fa-users" aria-hidden="true"></i> <span
                    class="nav-label">Historial de clientes</span></a>
                </li>
            </ul>
        </div>
    </nav>

    <div id="page-wrapper" class="gray-bg" style="min-height: 757px;">
        <div class="row border-bottom">
            <nav class="navbar navbar-static-top" role="navigation" style="margin-bottom: 0">
                <div class="navbar-header">
                    <a class="navbar-minimalize minimalize-styl-2 btn btn-primary " href="#"><i class="fa fa-bars"></i>
                    </a>
                    <form role="search" class="navbar-form-custom">
                        <div class="form-group pull-right">
                            <p style="text-align: center; "><img alt="image" src="../img/logos.png" style="width: 183px; margin-top: 0px; border-radius: 67px 36% 3% -9%; height: 50px; background: #448ed300; position: absolute; bottom: 9px;"/>
                        </div>
                    </form>
                </div>
                <ul class="nav navbar-top-links navbar-right">
                    <li>
                        <a href="javascript:salida_sistema();">
                            <i class="fa fa-sign-out"></i> Cerrar sesión
                        </a>
                    </li>
                </ul>
            </nav>
        </div>

        <div class="wrapper wrapper-content animated fadeInRight">


            <div class="row">

                <div class="col-lg-6" id="lista_asi_ayu">
                    <div class="ibox ">
                        <div class="ibox-title">
                            <h5>Lista de Ayudantes asignados</h5>
                        </div>
                        <div class="ibox-content row" style="margin-right: 0px;margin-left: 0px;">
                            <div class="table-responsive">
                                <table class="table table-striped">
                                    <thead>
                                    <tr align="center">
                                        <th>Nombre del ayudante</th>
                                        <th>Nombre del asesor</th>
                                    </tr>
                                    </thead>
                                    <tbody align="center" id="listado_ayudante_asignado">
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-lg-12" id="configuracion_general">
                    <div class="ibox ">
                        <div class="ibox-title">
                            <h5>Configuración principal de credito</h5>
                        </div>
                        <div class="ibox-content row" style="margin-right: 0px;margin-left: 0px;">

                            <div class="col-sm-6 col-md-6 col-xs-12">
                                <form role="form">
                                    <div class="form-group"><label>Prestamo minimo <strong id="prestamo_principal_ini">Q1.000</strong></label>
                                        <input id="prestamo_principal"
                                               type="range"
                                               class="form-control" disabled min="1000" max="50000"></div>
                                </form>
                                <form role="form">
                                    <div class="form-group"><label>Prestamo minimo </label> <input
                                            id="monto_num_prestamo"
                                            type="number" min="1000" max="50000"
                                            placeholder="" maxlength="8"
                                            class="form-control"></div>
                                </form>

                            </div>

                            <div class="col-sm-6 col-md-6 col-xs-12">
                                <form role="form">
                                    <div class="form-group"><label>Prestamo maximo <strong id="prestamo_principal_ini2">Q50.000</strong></label>
                                        <input id="prestamo_principal2"
                                               type="range"
                                               class="form-control" disabled min="50000" max="99999999"></div>
                                </form>
                                <form role="form">
                                    <div class="form-group"><label>Prestamo maximo </label> <input
                                            id="monto_num_prestamo2"
                                            type="number" min="50000" max="99999999"
                                            placeholder="" maxlength="8"
                                            class="form-control"></div>
                                </form>

                            </div>

                            <div class="col-sm-6 col-md-4 col-xs-12">

                                <form role="form">
                                    <label>Interes por mora</label>
                                    <select class="form-control m-b" id="selector_demora">
                                        <option value="">Seleccione</option>
                                        <option value="1">Cobrar interes sobre la deuda</option>
                                        <option value="2">Cobrar interes sobre la monto</option>
                                        <option value="3">No cobrar interes por mora</option>
                                    </select>
                                </form>

                            </div>
                            <div class="col-sm-6 col-md-4 col-xs-12">

                                <form role="form">
                                    <label>Prestamos permitidos</label>
                                    <select class="form-control m-b" id="mora_clientes_prestamo">
                                        <option value="">Seleccione</option>
                                        <option value="1">Permitir crear prestamo a pesar que tiene Credito con otra Empresa</option>
                                        <option value="2">Aprobar Credito a Clientes que se encuentre con mas de 2 asesores en mi Empresa</option>
                                        <option value="3">Desaprobar Creditos a Clientes en mas de 1 Ruta</option>
                                    </select>
                                </form>

                            </div>

                            <div class="col-sm-6 col-md-4 col-xs-12">

                                <form role="form">
                                    <div class="form-group"><label>Cuotas permitidas para refinanciación </label> <input
                                            id="count_refinansacion"
                                            type="number" min="1" max="100"
                                            placeholder="" maxlength="2"
                                            class="form-control"></div>
                                </form>

                            </div>

                            <div class="col-sm-6 col-md-4 col-xs-12">
                                <form role="form">
                                    <div class="form-group"><label>Nombre de empresa</label> <input
                                            id="nom_empresa"
                                            type="text"  maxlength="120"
                                            class="form-control"></div>
                                </form>
                            </div>

                            <div class="col-sm-6 col-md-4 col-xs-12">
                                <form role="form">
                                    <div class="form-group"><label>Dirección de empresa</label> <input
                                            id="dire_empresa"
                                            type="text"  maxlength="120"
                                            class="form-control"></div>
                                </form>
                            </div>


                            <div class="col-sm-6 col-md-4 col-xs-12">
                                <form role="form">
                                    <div class="form-group"><label>Nit de empresa</label> <input
                                            id="nit_empresa"
                                            type="text"  maxlength="120"
                                            class="form-control"></div>
                                </form>
                            </div>


                            <div class="col-sm-6 col-md-6 col-xs-12">

                                <form role="form">
                                    <label>Colores de dia</label>
                                    <select class="form-control m-b" id="dias_colores">
                                    </select>
                                </form>

                            </div>

                            <div class="col-sm-2 col-md-2 col-xs-12" style="display: none;">

                                <form role="form">
                                    <input type="color"
                                           class="form-control" id="color_click" style="margin-bottom: 11px;">
                                </form>

                            </div>

                            <div class="col-sm-6 col-md-6 col-xs-12" style="margin-top: 3%;text-align: center;">
                                <div class="form-group" style="display: inline-flex;">
                                    <div id="valor_lunes"
                                         style="padding-top: 12px;padding-left: 14px;padding-right: 14px;padding-bottom: 12px;background-color: #007bff;color: white;border-radius: 3px;">
                                        L
                                    </div>
                                    <div id="valor_martes"
                                         style="padding: 12px;background-color: #dc3545;color: white;border-radius: 3px; margin-left: 2px;">
                                        M
                                    </div>
                                    <div id="valor_miercoles"
                                         style="padding: 12px;background-color: #ffc107;color: white;border-radius: 3px; margin-left: 2px;">
                                        M
                                    </div>
                                    <div id="valor_jueves"
                                         style="padding-top: 12px;padding-left: 16px;padding-right: 15px;padding-bottom: 12px;background-color: #28a745;color: white;border-radius: 3px; margin-left: 2px;">
                                        J
                                    </div>
                                    <div id="valor_viernes"
                                         style="padding-top: 12px;padding-left: 14px;padding-right: 14px;padding-bottom: 12px;background-color: #6f42c1;color: white;border-radius: 3px; margin-left: 2px;">
                                        V
                                    </div>
                                    <div id="valor_sabado"
                                         style="padding: 12px;background-color: #e83e8c;color: white;border-radius: 3px; margin-left: 2px;">
                                        S
                                    </div>
                                    <div id="valor_domingo"
                                         style="padding: 12px;background-color: #6c757d;color: white;border-radius: 3px; margin-left: 2px;">
                                        D
                                    </div>
                                </div>
                            </div>

                            <div class="col-xs-12" style="margin-left: 2%;">
                                <button class="btn btn-primary btn-block " style="margin-left: 2px;"
                                        id="configurar_directa"
                                        type="button">Configurar
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-lg-12" id="crear_contrato_form">
                    <div class="ibox ">
                        <div class="ibox-title">
                            <h5>Creación de contrato</h5>
                        </div>
                        <div class="ibox-content row" style="margin-right: 0px;margin-left: 0px;">


                            <div class="col-sm-6 col-md-6 col-lg-6">
                                <div class="profile-image" style="margin-top: 12%;">
                                    <img src="../img/default.jpg" id="asesor_foto_selec" class="rounded-circle circle-border m-b-md" alt="profile">
                                </div>
                                <div class="profile-info col-xs-12">

                                    <div class="col-xs-12">
                                        <form role="form">
                                            <label>Lista de asesores a asignar</label>
                                            <select class="form-control m-b" id="selector_asesores_lista">
                                            </select>
                                        </form>
                                    </div>
                                    <div class="col-xs-12">
                                            <form role="form">
                                                <div class="form-group"><label>DPI del asesor</label> <input
                                                        id="text_cedula_asesor"
                                                        type="text" disabled
                                                        placeholder=""
                                                        class="form-control"></div>
                                            </form>
                                        </div>

                                </div>
                            </div>


                            <div class="col-sm-6 col-md-6 col-lg-6">
                                <div class="profile-image" style="margin-top: 12%;">
                                    <img src="../img/default.jpg" id="foto_user_clien" class="rounded-circle circle-border m-b-md" alt="profile">
                                </div>
                                <div class="profile-info">

                                    <div class="form-group col-xs-6">
                                        <label>DPI del cliente</label>
                                        <div class="input-group"><input disabled placeholder="Inserte cedula" id="text_cedula_cliente" type="text" class="form-control"> <span class="input-group-append"> <button type="button" id="buscar_cedula_cliente" disabled class="btn btn-primary"><i class="fa fa-search"></i>
                                        </button> </span></div>
                                    </div>


                                    <div class="col-xs-6">
                                        <form role="form">
                                            <div class="form-group"><label>Nombre y apellido</label> <input
                                                    id="text_nombre_cliente"
                                                    type="text" disabled
                                                    placeholder=""
                                                    class="form-control"></div>
                                        </form>
                                    </div>

                                </div>
                            </div>

                        </div>
                    </div>
                </div>

                <div class="col-lg-12" id="configuracion_general_cuotas">
                    <div class="ibox ">
                        <div class="ibox-title">
                            <h5>Configuración cuotas</h5>
                        </div>
                        <div class="ibox-content row" style="margin-right: 0px;margin-left: 0px;">

                            <div class="col-sm-12 col-md-12 col-xs-12 table-responsive">
                                <table class="table table-striped">
                                    <thead>
                                    <tr align="center">
                                        <th>Descripción de cuota</th>
                                        <th>Dias de cuota</th>
                                        <th>Interes que se aplica</th>
                                    </tr>
                                    </thead>
                                    <tbody align="center" id="listado_cuotas_lis">
                                    </tbody>
                                </table>
                            </div>


                            <div class="col-sm-6 col-md-3 col-xs-12">

                                <form role="form">
                                    <div class="form-group"><label>Descripción de cuota </label> <input
                                            id="descripcion_couta"
                                            type="text"
                                            placeholder="Nombre de cuota"
                                            class="form-control"></div>

                                </form>
                            </div>

                            <div class="col-sm-6 col-md-3 col-xs-12">

                                <form role="form">
                                    <div class="form-group"><label>Dias de prestamo </label> <input id="dias_coutas"
                                                                                                    type="number"
                                                                                                    min="2" max="365"
                                                                                                    placeholder=""
                                                                                                    maxlength="3"
                                                                                                    class="form-control">
                                    </div>

                                </form>
                            </div>


                            <div class="col-sm-6 col-md-3 col-xs-12">

                                <form role="form">
                                    <div class="form-group"><label>Valor de interes</label> <input
                                            id="monto_num_interes"
                                            type="number" min="1" max="100"
                                            placeholder="" maxlength="3"
                                            class="form-control"></div>
                                </form>
                            </div>

                            <div class="col-sm-6 col-md-3 col-xs-12" style="margin-top: 28px;">

                                <button class="btn btn-primary btn-block " style="margin-left: 2px;" id="guardar_cuota"
                                        type="button">Guardar cuota
                                </button>
                            </div>

                        </div>
                    </div>
                </div>

                <div class="col-lg-12" id="crear_contrato_form_dos">
                    <div class="ibox ">
                        <div class="ibox-title">
                            <h5>Asignación de cuotas</h5>
                        </div>
                        <div class="ibox-content row" style="margin-right: 0px;margin-left: 0px;">

                            <div class="col-sm-6 col-md-3 col-xs-12">
                                <form role="form">
                                    <div class="form-group"><label>Total de prestamo</label> <input onkeyup="format(this)" onchange="format(this)"
                                            id="monto_prestar_ya_admin"
                                            type="text"
                                            placeholder="" maxlength="10"
                                            class="form-control"></div>
                                </form>
                            </div>

                            <div class="col-sm-6 col-md-3 col-xs-12">
                                <form role="form">
                                    <label>Cuota a aplicar</label>
                                    <select class="form-control m-b" id="selector_cuotas_selec">
                                    </select>
                                </form>
                            </div>

                            <div class="col-sm-6 col-md-2 col-xs-12">
                                <form role="form">
                                    <div class="form-group"><label>Fecha</label> <input
                                            id="fechaActual"
                                            type="date"
                                            placeholder=""
                                            class="form-control"></div>
                                </form>
                            </div>

                            <div class="col-sm-6 col-md-2 col-xs-12">
                                <form role="form">
                                    <label>Frecuencia de pago</label>
                                    <select class="form-control m-b" id="selector_frecuencia">
                                        <option value="">Seleccione</option>
                                        <option value="1">Diario</option>
                                        <option value="2">Semanal</option>
                                    </select>
                                </form>
                            </div>

                            <div class="col-sm-6 col-md-2 col-xs-12">
                                <form role="form">
                                    <div class="form-group"><label>Cuotas a descontar</label> <input
                                            id="cuota_descontar_sistema"
                                            type="number"  value="1"
                                            placeholder="" maxlength="3"
                                            class="form-control"></div>
                                </form>
                            </div>

                        <div class="col-sm-12 col-md-12 col-xs-12" style="padding: 4%;margin-left: 8%;">
                            <blockquote style="background-color: #2125290f;padding: 4%;margin-left: -9%;" class="row col-sm-12 col-md-12 col-xs-12">
                                <div class="col-sm-6 col-md-4 col-xs-12">
                                    <form role="form">
                                        <div class="form-group"><label>Utilidad del porcentaje</label> <br> <label id="utilidad_prestada">0</label>%</div>
                                    </form>
                                </div>
                                <div class="col-sm-6 col-md-4 col-xs-12">
                                    <form role="form">
                                        <div class="form-group"><label>Utilidad en peso</label> <br> $<label id="utilidad_prestada_peso">0</label></div>
                                    </form>
                                </div>
                                <div class="col-sm-6 col-md-4 col-xs-12">
                                    <form role="form">
                                        <div class="form-group"><label>Valor de la cuota</label> <br> $<label id="utilidad_cuota">0</label></div>
                                    </form>
                                </div>
                            </blockquote>
                         </div>

                            <div class="col-xs-6">

                                <button class="btn btn-primary btn-block " style="margin-left: 2px;" id="crear_contrato"
                                        type="button">Crear contrato
                                </button>
                            </div>

                            <div class="col-xs-6">

                                <button class="btn btn-primary btn-block " style="display:none;" id="limpiar_contrato"
                                        type="button">Limpiar contrato
                                </button>
                            </div>

                        </div>
                    </div>
                </div>

				<!-- <div class="col-lg-12" id="liquidacion_page2" style="display:none;">
					<div class="ibox-title">
						Total recaudo: <label id="text_recolectado"></label>
                        <button class="btn btn-primary pull-right" id="registro_base"
								type="button">Registro de base
						</button>
					</div>
				</div> -->
				
                <div class="col-lg-12" id="liquidacion_page">
                    <div class="ibox ">
                        <div class="ibox-title">
                            <h5>Liquidación</h5>
                        </div>

                        <div class="ibox-content row" style="margin-right: 0px;margin-left: 0px;">

                            <div class="col-sm-6 col-md-5 col-xs-12" style="display:none;">
                                <label>Fecha de pago</label>
                                <div id="picker-no-time"></div>
                                <input type="hidden" id="result2" value="" />
                            </div>

                            <div class="col-sm-6 col-md-4 col-xs-12">
                                <label>Asesor</label>
                                <select class="form-control m-b" id="lista_asesores_general">
                                </select>
                            </div>

                            <!-- <div class="col-sm-6 col-md-2 col-xs-6">
                                <form role="form" style="margin-top: 24px;display:grid;">
                                    <button type="button" class="btn btn-success" id="comporta">Comportamiento</button>
                                </form>
                            </div> -->

                            <div class="col-sm-6 col-md-1 col-xs-6" style="display:none">
                                <form role="form" style="margin-top: 24px;display:grid;">
                                    <button type="button" class="btn btn-danger" id="boton_Reporte"><i class="fa fa-file-pdf"></i></button>
                                </form>
                            </div>



                            <div class="table-responsive">
                                <table class="table table-striped sortable" >
                                    <thead>
                                    <tr align="center">
                                        <th>Contrato</th>
                                        <th>Cliente</th>
                                        <th>Alias</th>
                                        <th>Valor cuota</th>
                                        <th>Saldo favor</th>
                                        <th>Prestamo</th>
                                        <th>Total deuda</th>
                                    </tr>
                                    </thead>
                                    <tbody align="center" id="listado_operacion_asesore">
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-lg-12" id="HistorialClientes">
                    <div class="ibox ">
                        <div class="ibox-title">
                            <h5>Historial de clientes</h5>
                        </div>

                        <div class="ibox-content row" style="margin-right: 0px;margin-left: 0px;">

                            <div class="col-sm-6 col-md-5 col-xs-12" style="display:none;">
                                <label>Fecha de pago</label>
                                <div id="picker-no-time"></div>
                                <input type="hidden" id="result2" value="" />
                            </div>
                                                       
                            <div class="col-sm-6 col-md-4 col-xs-12">
                                <label>DPI del cliente a buscar</label>
                                <div class="input-group">
                                    <input placeholder="Inserte DPI del cliente" id="text_cedula_cliente_historial" maxlength="13" type="text" class="form-control" onkeypress="return event.charCode >= 48 && event.charCode <= 57" oninput="this.value = this.value.replace(/[^0-9]/g, '')">
                                    <span class="input-group-append">
                                        <button type="button" id="buscar_cedula_cliente_historia" class="btn btn-primary">
                                            <i class="fa fa-search"></i> Buscar
                                        </button>
                                    </span>
                                </div>
                            </div>
 
                            <div class="table-responsive">
                                <table class="table table-striped sortable" style="margin-top: 15px;">
                                    <thead>
                                    <tr align="center">
                                        <th>Cliente</th>
                                        <th>Cantidad de prestamos otorgados</th>
                                        <th>Comportamiento</th>
                                    </tr>
                                    </thead>
                                    <tbody align="center" id="listado_historial_cliente">
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-lg-12" id="consulta_cobros" style="display:none;">
                    <div class="ibox ">
                        <div class="ibox-title">
                            <h5>Busqueda de cobros por fecha</h5>
                        </div>
                        <div class="ibox-content row" style="margin-right: 0px;margin-left: 0px;">

                            <div class="col-sm-6 col-md-4 col-xs-12">
                                <label>Id asesor</label>
                                <select class="form-control m-b" id="id_asesor_cobros">
                                </select>
                            </div>

                            <div class="col-sm-6 col-md-4 col-xs-12">
                                <form role="form">
                                    <div class="form-group"><label>Fecha de asignación</label> 
                                        <input id="fecha_busqueda_cobros"
                                            type="date"
                                            placeholder="Inserte fecha de asignación"
                                            class="form-control"
                                            >
                                    </div>
                                </form>
                            </div>

                            <div class="col-sm-6 col-md-4 col-xs-12" style="margin-top: 3%;">
                                <button class="btn btn-primary btn-lg btn-block btn-sm" style="margin-left: 2px;"
                                        id="busqueda_cobros"
                                        type="button">Buscar
                                </button>
                                <form role="form" style="margin-top: 24px;display:grid;">
                                    <button type="button" class="btn btn-danger" id="boton_Reporte_Cobros"><i class="fa fa-file-pdf"></i></button>
                                </form>
                            </div>
                            <div class="table-responsive" style="margin-top: 50px;">
                                <table class="table table-striped">
                                    <thead>
                                    <tr align="center">
                                        <th>DPI</th>
                                        <th>Nombre Cliente</th>
                                        <th>Dirección</th>
                                        <th>Monto</th>
                                        <th>Hora</th>
                                    </tr>
                                    </thead>
                                    <tbody align="center" id="listado_cobros_por_fechas">
                                    </tbody>
                                </table>
                            </div>

                        </div>
                    </div>
                </div>

                <div class="col-lg-12" id="consulta_gastos" style="display:none;">
                    <div class="ibox ">
                        <div class="ibox-title">
                            <h5>Busqueda de gastos por fecha</h5>
                        </div>
                        <div class="ibox-content row" style="margin-right: 0px;margin-left: 0px;">

                            <div class="col-sm-6 col-md-4 col-xs-12">
                                <label>Id asesor</label>
                                <select class="form-control m-b" id="id_asesor_gastos_consulta">
                                </select>

                            </div>

                            <div class="col-sm-6 col-md-4 col-xs-12">
                                <form role="form">
                                    <div class="form-group"><label>Fecha de asignación</label> <input id="fecha_gasto"
                                                                                                      type="date"
                                                                                                      placeholder="Inserte fecha de asignación"
                                                                                                      class="form-control">
                                    </div>
                                </form>
                            </div>

                            <div class="col-sm-6 col-md-4 col-xs-12" style="margin-top: 3%;">
                                <button class="btn btn-primary btn-lg btn-block btn-sm" style="margin-left: 2px;"
                                        id="busqueda_gasto"
                                        type="button">Buscar
                                </button>
                                <form role="form" style="margin-top: 24px;display:grid;">
                                    <button type="button" class="btn btn-danger" id="boton_Reporte_Gastos"><i class="fa fa-file-pdf"></i></button>
                                </form>

                            </div>
                            <div class="table-responsive" style="margin-top: 50px;">
                                <table class="table table-striped" >
                                    <thead>
                                    <tr align="center">
                                        <th>Motivo de gasto</th>
                                        <th>Monto</th>
                                    </tr>
                                    </thead>
                                    <tbody align="center" id="lista_gastos_exe">
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>


                <div class="col-lg-12" id="contratos_view">
                    <div class="ibox ">
                        <div class="ibox-title">
                            <h5>Consulta de contrato</h5>
                            &nbsp;
                            <input class="form-control col-md-4" type="text" id="buscarContratos" placeholder="Buscar por DPI"  oninput="this.value = this.value.replace(/[^0-9]/g, '')">
                        </div>
                        <div class="ibox-content row" style="margin-right: 0px;margin-left: 0px;">

                            <div class="col-md-6 col-xs-12 " >
                                <select class="form-control m-b" id="lista_asesores_general3">
                                </select>
                            </div>

                            <div class="table-responsive">
                                <table class="table table-striped">
                                    <thead>
                                    <tr>
                                        <th>Fecha de prestamo </th>
                                        <th>A pagar</th>
                                        <th>DPI</th>
                                        <th>Nombre cliente</th>
                                        <th>Asesor</th>
                                        <th>Prestamo</th>
                                        <th>Porcentaje</th>
                                        <th>Cuotas</th>
                                    </tr>
                                    </thead>
                                    <tbody id="lista_enorme">
                                    </tbody>
                                </table>
                            </div>


                        </div>
                    </div>
                </div>


                <div class="col-lg-12" id="cierre_view">
                    <div class="ibox ">
                        <div class="ibox-title">
                            <h5>Consulta de cierre</h5>
                        </div>
                        <div class="ibox-content row" style="margin-right: 0px;margin-left: 0px;">

                            <div class="col-md-4 col-xs-12">
                                <form role="form">
                                    <div class="form-group"><label>Fecha de consulta</label>
                                        <input id="fecha_busqueda_cobros_supervisor"
                                            type="date"
                                            placeholder="Inserte fecha de asignación"
                                            class="form-control"
                                        >
                                    </div>
                                </form>
                            </div>

                            <div class="col-md-8 col-xs-12">
                                <label>Asesor</label>
                                <div style="display: flex; justify-content: space-between; align-items: center; margin: auto;">
                                    <select class="form-control m-b" id="id_asesor_cierre" style="margin-right: 20px;">
                                    </select>
                                    <button type="button" class="btn btn-danger px-5" id="boton_pdf_cierre"><i class="fa fa-file-pdf"></i></button>
                                    <button type="button" class="btn btn-success mx-5" id="btn_buscar_cierre_supervisor">Buscar</button>
                                </div>                            
                            </div>

                            <div class="table-responsive">
                                <table class="table table-striped">
                                    <div class="ibox ">
                                        <div class="ibox-title" style="display: flex; justify-content: space-around;">
                                            <div>Base diaria: <label id="text_baseAsesor"></label></div>
                                            <div>Total recaudado: <label id="text_recolectadoAsesor"></label></div>
                                            <div>Total gastos: <label id="text_gastosAsesor"></label></div>
                                        </div>
                                    </div>
                                </table>
                            </div>
                            <div class="table-responsive table-responsive-sm">
                                <div class="ibox">
                                    <div style="display: flex; justify-content:space-evenly; flex-wrap: wrap;">
                                        <div>Total Sistema: <label id="text_total_sistema"></label></div>
                                        <div>Total entregado por asesor: Q.<input type="number" id="text_total_asesor"></div>
                                        <div>Diferencia: <label id="text_diferencia_cierre"></label></div>
                                        <button class="btn btn-primary btn-md" id="registrar_cierre"
                                                type="button">Registrar cierre
                                    </button>
                                    </div>
                                </div>
                            </div>
                            <div class="table-responsive">
                                <div class="ibox-title">
                                    <h5>Consulta de cobros</h5>
                                </div>
                                <div class="table-responsive" style="margin-top: 50px;">
                                    <table class="table table-striped">
                                        <thead>
                                        <tr align="center">
                                            <th>DPI</th>
                                            <th>Nombre Cliente</th>
                                            <th>Dirección</th>
                                            <th>Monto</th>
                                            <th>Hora</th>
                                        </tr>
                                        </thead>
                                        <tbody align="center" id="listado_cobros_cierre">
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <div class="table-responsive">
                                <div class="ibox-title">
                                    <h5>Consulta de gastos</h5>
                                </div>
                                <table class="table table-striped">
                                    <thead>
                                        <tr align="center">
                                            <th>Motivo de gasto</th>
                                            <th>Monto</th>
                                        </tr>
                                        </thead>
                                        <tbody align="center" id="lista_gastos_exeAsesor">
                                        </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="googleMap" style="display:none;width:100%;height:800px;"></div>

            </div>
            <input type="file" id="foto1" accept="image/*" style="display:none;">
            <input type="file" id="foto2" accept="image/*" style="display:none;">
            <input type="file" id="foto3" accept="image/*" style="display:none;">

            <input type="file" id="foto1m" accept="image/*" style="display:none;">
            <input type="file" id="foto2m" accept="image/*" style="display:none;">
            <input type="file" id="foto3m" accept="image/*" style="display:none;">
            <input type="file" id="foto4m" accept="image/*" style="display:none;">

            <input type="file" id="foto1md" accept="image/*" style="display:none;">
            <input type="file" id="foto2md" accept="image/*" style="display:none;">
            <input type="file" id="foto3md" accept="image/*" style="display:none;">
            <input type="file" id="foto4md" accept="image/*" style="display:none;">

        </div>    
        <div class="footer" style="display:none;">
            <div class="float-right">
                Conexión:<strong id="conectado_server">falsa</strong>.
            </div>
            <div>
                <strong>Copyright</strong> Money Engineering SuperSistemas&copy; 2023
            </div>
        </div>
    </div>
</div>


<!-- Mainly scripts -->
<script src="../js/jquery-3.1.1.min.js"></script>
<script src="../js/plugins/toastr/toastr.min.js" type="text/javascript"></script>
<script src="../js/popper.min.js"></script>
<script src="../js/bootstrap.js"></script>
<script src="../js/plugins/metisMenu/jquery.metisMenu.js"></script>
<script src="../js/plugins/slimscroll/jquery.slimscroll.min.js"></script>
<script src="https://www.gstatic.com/firebasejs/5.10.1/firebase-database.js"></script>

<!-- Peity -->
<script src="../js/plugins/peity/jquery.peity.min.js"></script>

<!-- Custom and plugin javascript -->
<script src="../js/inspinia.js"></script>
<script src="../js/plugins/pace/pace.min.js"></script>
<script src="../js/plugins/mommet/mommet.js"></script>

<!-- iCheck -->
<script src="../js/plugins/iCheck/icheck.min.js"></script>

<script>

    var firebaseConfig = {

        // apiKey: "AIzaSyDm6brlpGU1WfSoh_jCtAChk5c5feszYxo",
        // authDomain: "nororiente-f57b1.firebaseapp.com",
        // databaseURL: "https://nororiente-f57b1-default-rtdb.firebaseio.com",
        // projectId: "nororiente-f57b1",
        // storageBucket: "nororiente-f57b1.appspot.com",
        // messagingSenderId: "551056198200",
        // appId: "1:551056198200:web:c131ade0d078e2956bb4cd",
        // measurementId: "G-QPMR8Z13BH"

        apiKey: "AIzaSyD0IUGt9jsr8baMbhQ9th3sAEXPms8Neqw",
        authDomain: "axelssmoney.firebaseapp.com",
        databaseURL: "https://axelssmoney-default-rtdb.firebaseio.com",
        projectId: "axelssmoney",
        storageBucket: "axelssmoney.appspot.com",
        messagingSenderId: "915189749485",
        appId: "1:915189749485:web:1a3bfd97e0ee9cf1221ee4",
        measurementId: "G-N2Z1GX04BF"

        // apiKey: "AIzaSyAj2W3P9Qyg93M-4zt4z2C4hRCHU6GEdWE",
        // authDomain: "creditoselamigo-f3217.firebaseapp.com",
        // databaseURL: "https://creditoselamigo-f3217-default-rtdb.firebaseio.com",
        // projectId: "creditoselamigo-f3217",
        // storageBucket: "creditoselamigo-f3217.appspot.com",
        // messagingSenderId: "91763694848",
        // appId: "1:91763694848:web:aacdf5d06c1a6624f3a7e5",
        // measurementId: "G-DY06MSN1DM" 
    };
    firebase.initializeApp(firebaseConfig);
	
</script>

<script src="../js/plugins/sweetalert/sweetalert.min.js"></script>
<script src="../js/imagen_tool.js"></script>
<script src="../js/backend.js"></script>
<script src="../js/datetimepicker.js"></script>
<!-- <link href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.2/themes/smoothness/jquery-ui.css" rel="stylesheet"/>
<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.2/jquery-ui.min.js"></script> -->



<script>
    function generarPDFDePrueba() {
        var doc = new window.jspdf.jsPDF({
            unit: 'mm',
            format: [80,Infinity]
        }); 
        
        imprimir_texto(doc, 'Nombre: Juan Pérez', 10, 10, 12, 'black', 'left');
        imprimir_texto(doc, 'Email: juan@example.com', 10, 20, 12, 'black', 'left');
        imprimir_texto(doc, 'Teléfono: 123-456-7890', 10, 30, 12, 'black', 'left');

        doc.save('documento.pdf');
    }

    function imprimir_texto(doc, texto, x, y, size, color, align) {
        doc.setFontSize(size);
        doc.setTextColor(color);
        doc.text(texto, x, y, {align: align});
    }
    
    document.addEventListener('DOMContentLoaded', function() {
        document.getElementById('boton_pdff')?.addEventListener('click', function() {
            generarPDFDePrueba(); 
        });
    });

</script>







<script>
    var block = this;

    function salida_sistema() {
         window.sessionStorage.clear(); window.localStorage.clear();
        location.href = "../index.html";
    }

    function informe_completo_cierre(){

        $("#crear_contrato_form").css("display", "none");
        $("#crear_contrato_form_dos").css("display", "none");
        $("#lista_ayu").css("display", "none");
        $("#lista_sup").css("display", "none");
        $("#lista_ase").css("display", "none");
        $("#crear").css("display", "none");
        $("#asig_supervidor").css("display", "none");
        $("#lista_asi_ayu").css("display", "none");
        $("#lista_asi_sup").css("display", "none");
        $("#configuracion_general").css("display", "none");
        $("#busqueda_asignaciones").css("display", "none");
        $("#configuracion_general_cuotas").css("display", "none");
        $("#create_clientes_listo").css("display", "none");
        $("#liquidacion_page").css("display", "none");
        $("#contratos_view").css("display", "none");
        $("#cliente_lista_admi").css("display", "none");
        $("#googleMap").css("display","none");
        $("#flotante2").css("display","none");
        $("#flotante3").css("display","none");
        $("#recaduos_ink").css("display", "none");
        $("#migrar_cion_div").css("display", "none");
        $("#suplanter").css("display", "none");
        $("#consulta_cobros").css("display", "none");
        $("#consulta_gastos").css("display", "none");
        $("#HistorialClientes").css("display","none");
        $("#cierre_view").css("display", "initial");
        cargarListas_asigandos();
    }

    if (window.sessionStorage.getItem("Money-vars-token") == null) {
        salida_sistema();
    }

    $(document).ready( function () {
        $('#picker').dateTimePicker();
        $('#picker-no-time').dateTimePicker({ showTime: false, dateFormat: 'DD/MM/YYYY'});
    });

    $("#selector_cuotas_selec").change(function(){

        if ($("#monto_prestar_ya_admin").val()!=="" && $("#selector_cuotas_selec").val()!=="") {

            if(window.sessionStorage.getItem("Lista_cuota")!==null) {
                block.cuotas = JSON.parse(window.sessionStorage.getItem("Lista_cuota"));
                if ($("#monto_prestar_ya_admin").val()!=="") {

                    if($("#text_nombre_cliente").val()!==""){
                        $("#crear_contrato").prop("disabled",false);
                    }else{
                        $("#crear_contrato").prop("disabled",true);
                    }

                    for(var w =0; w < block.cuotas.length; w++){
                        if(block.cuotas[w][2]==$("#selector_cuotas_selec").val()){
                            $("#utilidad_prestada").html(block.cuotas[w][3]);
                            block.limpi = $("#monto_prestar_ya_admin").val();
                            block.comp = block.limpi.replace(".","");
                            block.wsqa = block.comp.replace(".","");
                            block.monq = parseInt(block.wsqa);
                            block.poce = parseFloat(block.cuotas[w][3]);
                            block.dias = parseInt(block.cuotas[w][2]);
                            block.resul = parseInt(block.monq * (block.poce / 100)) ;
                            block.reas = (block.monq + block.resul) / block.dias;
                            block.resul = block.resul.toString().split('').reverse().join('').replace(/(?=\d*\.?)(\d{3})/g,'$1.');
                            block.resul = block.resul.split('').reverse().join('').replace(/^[\.]/,'');
                            block.reas = parseInt(block.reas);
                            block.reas = block.reas.toString().split('').reverse().join('').replace(/(?=\d*\.?)(\d{3})/g,'$1.');
                            block.reas = block.reas.split('').reverse().join('').replace(/^[\.]/,'')
                            $("#utilidad_prestada_peso").html(block.resul);
                            $("#utilidad_cuota").html(block.reas);
                        }
                    }
                }else{
                    $("#utilidad_prestada_peso").html("0");
                    $("#utilidad_prestada").html("0");
                    $("#utilidad_cuota").html("0");
                }
            }

        }else{
            $("#utilidad_prestada_peso").html("0");
            $("#utilidad_prestada").html("0");
            $("#utilidad_cuota").html("0");
        }
    });

    function format(input) {

        var num = input.value.replace(/\./g,'');
        if(!isNaN(num)){
            num = num.toString().split('').reverse().join('').replace(/(?=\d*\.?)(\d{3})/g,'$1.');
            num = num.split('').reverse().join('').replace(/^[\.]/,'');
            input.value = num;

            if(window.sessionStorage.getItem("Lista_cuota")!==null) {
                block.cuotas = JSON.parse(window.sessionStorage.getItem("Lista_cuota"));
                if ($("#monto_prestar_ya_admin").val()!=="") {

                    for(var w =0; w < block.cuotas.length; w++){
                        if(block.cuotas[w][2]==$("#selector_cuotas_selec").val()){
                            $("#utilidad_prestada").html(block.cuotas[w][3]);
                            block.limpi = $("#monto_prestar_ya_admin").val();
                            block.comp = block.limpi.replace(".","");
                            block.wsqa = block.comp.replace(".","");
                            block.monq = parseInt(block.wsqa);
                            block.poce = parseInt(block.cuotas[w][3]);
                            block.dias = parseInt(block.cuotas[w][2]);
                            block.resul = parseInt(block.monq * (block.poce / 100));
                            block.reas = (block.monq + block.resul) / block.dias;
                            block.resul = block.resul.toString().split('').reverse().join('').replace(/(?=\d*\.?)(\d{3})/g,'$1.');
                            block.resul = block.resul.split('').reverse().join('').replace(/^[\.]/,'');
                            block.reas = parseInt(block.reas);
                            block.reas = block.reas.toString().split('').reverse().join('').replace(/(?=\d*\.?)(\d{3})/g,'$1.');
                            block.reas = block.reas.split('').reverse().join('').replace(/^[\.]/,'')
                            $("#utilidad_prestada_peso").html(block.resul);
                            $("#utilidad_cuota").html(block.reas);
                        }
                    }
                }else{
                    $("#utilidad_prestada_peso").html("0");
                    $("#utilidad_prestada").html("0");
                    $("#utilidad_cuota").html("0");
                }
            }

        }else{
            input.value = input.value.replace(/[^\d\.]*/g,'');
        }
    }

    block.filein = document.querySelector("#foto1");
    block.filein.onchange = function (e) {
        block.files = e.target.files;
        block.file = block.files[0];
        ImageTools.resize(block.file, {
            width: 259,
            height: 259
        }, function (blob, didItResize) {

            var storageRef = firebase.storage().ref();
            var uploadTask = storageRef.child('images/' + blob.name).put(blob);
            uploadTask.on(firebase.storage.TaskEvent.STATE_CHANGED,
                    function(snapshot) {
                        var progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                        switch (snapshot.state) {
                            case firebase.storage.TaskState.PAUSED:
                                break;
                            case firebase.storage.TaskState.RUNNING:
                                break;
                        }
                    }, function(error) {
                        switch (error.code) {
                            case 'storage/unauthorized':
                                break;
                            case 'storage/canceled':
                                break;
                            case 'storage/unknown':
                                break;
                        }
                    }, function() {
                        uploadTask.snapshot.ref.getDownloadURL().then(function(downloadURL) {
                            $("#foto_m1").attr("src", downloadURL);
                            window.sessionStorage.setItem("Money-vars-foto-id", downloadURL);
                        });
                    });

        });
    };

    block.filein = document.querySelector("#foto1m");
    block.filein.onchange = function (e) {
        block.files = e.target.files;
        block.file = block.files[0];
        ImageTools.resize(block.file, {
            width: 259,
            height: 259
        }, function (blob, didItResize) {

            var storageRef = firebase.storage().ref();
            var uploadTask = storageRef.child('images/' + blob.name).put(blob);
            uploadTask.on(firebase.storage.TaskEvent.STATE_CHANGED,
                    function(snapshot) {
                        var progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                        switch (snapshot.state) {
                            case firebase.storage.TaskState.PAUSED:
                                break;
                            case firebase.storage.TaskState.RUNNING:
                                break;
                        }
                    }, function(error) {
                        switch (error.code) {
                            case 'storage/unauthorized':
                                break;
                            case 'storage/canceled':
                                break;
                            case 'storage/unknown':
                                break;
                        }
                    }, function() {
                        uploadTask.snapshot.ref.getDownloadURL().then(function(downloadURL) {
                            $("#foto_m1m").attr("src", downloadURL);
                            window.sessionStorage.setItem("Money-vars-foto-idm",downloadURL);
                        });
                    });
        });
    };

    block.filein = document.querySelector("#foto1md");
    block.filein.onchange = function (e) {
        block.files = e.target.files;
        block.file = block.files[0];
        ImageTools.resize(block.file, {
            width: 259,
            height: 259
        }, function (blob, didItResize) {

            var storageRef = firebase.storage().ref();
            var uploadTask = storageRef.child('images/' + blob.name).put(blob);
            uploadTask.on(firebase.storage.TaskEvent.STATE_CHANGED,
                    function(snapshot) {
                        var progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                        switch (snapshot.state) {
                            case firebase.storage.TaskState.PAUSED:
                                break;
                            case firebase.storage.TaskState.RUNNING:
                                break;
                        }
                    }, function(error) {
                        switch (error.code) {
                            case 'storage/unauthorized':
                                break;
                            case 'storage/canceled':
                                break;
                            case 'storage/unknown':
                                break;
                        }
                    }, function() {
                        uploadTask.snapshot.ref.getDownloadURL().then(function(downloadURL) {
                            $("#foto_m1md").attr("src", downloadURL);
                            window.sessionStorage.setItem("Money-vars-foto-idmd", downloadURL);
                        });
                    });
        });
    };

    block.filein = document.querySelector("#foto4m");
    block.filein.onchange = function (e) {
        block.files = e.target.files;
        block.file = block.files[0];
        ImageTools.resize(block.file, {
            width: 259,
            height: 259
        }, function (blob, didItResize) {

            var storageRef = firebase.storage().ref();
            var uploadTask = storageRef.child('images/' + blob.name).put(blob);
            uploadTask.on(firebase.storage.TaskEvent.STATE_CHANGED,
                    function(snapshot) {
                        var progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                        switch (snapshot.state) {
                            case firebase.storage.TaskState.PAUSED:
                                break;
                            case firebase.storage.TaskState.RUNNING:
                                break;
                        }
                    }, function(error) {
                        switch (error.code) {
                            case 'storage/unauthorized':
                                break;
                            case 'storage/canceled':
                                break;
                            case 'storage/unknown':
                                break;
                        }
                    }, function() {
                        uploadTask.snapshot.ref.getDownloadURL().then(function(downloadURL) {
                            $("#foto_m4m").attr("src",downloadURL);
                            window.sessionStorage.setItem("Money-vars-foto-frontal", downloadURL);
                        });
                    });

        });
    };

    block.filein = document.querySelector("#foto4md");
    block.filein.onchange = function (e) {
        block.files = e.target.files;
        block.file = block.files[0];
        ImageTools.resize(block.file, {
            width: 259,
            height: 259
        }, function (blob, didItResize) {

            var storageRef = firebase.storage().ref();
            var uploadTask = storageRef.child('images/' + blob.name).put(blob);
            uploadTask.on(firebase.storage.TaskEvent.STATE_CHANGED,
                    function(snapshot) {
                        var progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                        switch (snapshot.state) {
                            case firebase.storage.TaskState.PAUSED:
                                break;
                            case firebase.storage.TaskState.RUNNING:
                                break;
                        }
                    }, function(error) {
                        switch (error.code) {
                            case 'storage/unauthorized':
                                break;
                            case 'storage/canceled':
                                break;
                            case 'storage/unknown':
                                break;
                        }
                    }, function() {
                        uploadTask.snapshot.ref.getDownloadURL().then(function(downloadURL) {
                            $("#foto_m4md").attr("src", downloadURL);
                            window.sessionStorage.setItem("Money-vars-foto-frontald", downloadURL);
                        });
                    });

        });
    };

    block.filein2 = document.querySelector("#foto2");
    block.filein2.onchange = function (e) {
        block.files = e.target.files;
        block.file = block.files[0];
        ImageTools.resize(block.file, {
            width: 300,
            height: 500
        }, function (blob, didItResize) {

            var storageRef = firebase.storage().ref();
            var uploadTask = storageRef.child('images/' + blob.name).put(blob);
            uploadTask.on(firebase.storage.TaskEvent.STATE_CHANGED,
                    function(snapshot) {
                        var progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                        switch (snapshot.state) {
                            case firebase.storage.TaskState.PAUSED:
                                break;
                            case firebase.storage.TaskState.RUNNING:
                                break;
                        }
                    }, function(error) {
                        switch (error.code) {
                            case 'storage/unauthorized':
                                break;
                            case 'storage/canceled':
                                break;
                            case 'storage/unknown':
                                break;
                        }
                    }, function() {
                        uploadTask.snapshot.ref.getDownloadURL().then(function(downloadURL) {
                            $("#foto_m2").attr("src", downloadURL);
                            window.sessionStorage.setItem("Money-vars-foto-id-normal",downloadURL);
                        });
                    });

        });
    };

    block.filein2 = document.querySelector("#foto2m");
    block.filein2.onchange = function (e) {
        block.files = e.target.files;
        block.file = block.files[0];
        ImageTools.resize(block.file, {
            width: 300,
            height: 500
        }, function (blob, didItResize) {

            var storageRef = firebase.storage().ref();
            var uploadTask = storageRef.child('images/' + blob.name).put(blob);
            uploadTask.on(firebase.storage.TaskEvent.STATE_CHANGED,
                    function(snapshot) {
                        var progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                        switch (snapshot.state) {
                            case firebase.storage.TaskState.PAUSED:
                                break;
                            case firebase.storage.TaskState.RUNNING:
                                break;
                        }
                    }, function(error) {
                        switch (error.code) {
                            case 'storage/unauthorized':
                                break;
                            case 'storage/canceled':
                                break;
                            case 'storage/unknown':
                                break;
                        }
                    }, function() {
                        uploadTask.snapshot.ref.getDownloadURL().then(function(downloadURL) {
                            $("#foto_m2m").attr("src", downloadURL);
                            window.sessionStorage.setItem("Money-vars-foto-id-normalm", downloadURL);
                        });
                    });
        });
    };

    block.filein3 = document.querySelector("#foto3");
    block.filein3.onchange = function (e) {
        block.files = e.target.files;
        block.file = block.files[0];
        ImageTools.resize(block.file, {
            width: 300,
            height: 500
        }, function (blob, didItResize) {

            var storageRef = firebase.storage().ref();
            var uploadTask = storageRef.child('images/' + blob.name).put(blob);
            uploadTask.on(firebase.storage.TaskEvent.STATE_CHANGED,
                    function(snapshot) {
                        var progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                        switch (snapshot.state) {
                            case firebase.storage.TaskState.PAUSED:
                                break;
                            case firebase.storage.TaskState.RUNNING:
                                break;
                        }
                    }, function(error) {
                        switch (error.code) {
                            case 'storage/unauthorized':
                                break;
                            case 'storage/canceled':
                                break;
                            case 'storage/unknown':
                                break;
                        }
                    }, function() {
                        uploadTask.snapshot.ref.getDownloadURL().then(function(downloadURL) {
                            $("#foto_m3").attr("src", downloadURL);
                            window.sessionStorage.setItem("Money-vars-foto-id-reverso", downloadURL);
                        });
                    });

        });
    };

    block.filein3 = document.querySelector("#foto3m");
    block.filein3.onchange = function (e) {
        block.files = e.target.files;
        block.file = block.files[0];
        ImageTools.resize(block.file, {
            width: 300,
            height: 500
        }, function (blob, didItResize) {

            var storageRef = firebase.storage().ref();
            var uploadTask = storageRef.child('images/' + blob.name).put(blob);
            uploadTask.on(firebase.storage.TaskEvent.STATE_CHANGED,
                    function(snapshot) {
                        var progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                        switch (snapshot.state) {
                            case firebase.storage.TaskState.PAUSED:
                                break;
                            case firebase.storage.TaskState.RUNNING:
                                break;
                        }
                    }, function(error) {
                        switch (error.code) {
                            case 'storage/unauthorized':
                                break;
                            case 'storage/canceled':
                                break;
                            case 'storage/unknown':
                                break;
                        }
                    }, function() {
                        uploadTask.snapshot.ref.getDownloadURL().then(function(downloadURL) {
                            $("#foto_m3m").attr("src", downloadURL);
                            window.sessionStorage.setItem("Money-vars-foto-id-reversom",downloadURL);
                        });
                    });

        });
    };

    block.filein3 = document.querySelector("#foto2md");
    block.filein3.onchange = function (e) {
        block.files = e.target.files;
        block.file = block.files[0];
        ImageTools.resize(block.file, {
            width: 300,
            height: 500
        }, function (blob, didItResize) {

            var storageRef = firebase.storage().ref();
            var uploadTask = storageRef.child('images/' + blob.name).put(blob);
            uploadTask.on(firebase.storage.TaskEvent.STATE_CHANGED,
                    function(snapshot) {
                        var progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                        switch (snapshot.state) {
                            case firebase.storage.TaskState.PAUSED:
                                break;
                            case firebase.storage.TaskState.RUNNING:
                                break;
                        }
                    }, function(error) {
                        switch (error.code) {
                            case 'storage/unauthorized':
                                break;
                            case 'storage/canceled':
                                break;
                            case 'storage/unknown':
                                break;
                        }
                    }, function() {
                        uploadTask.snapshot.ref.getDownloadURL().then(function(downloadURL) {
                            $("#foto_m2md").attr("src", downloadURL);
                            window.sessionStorage.setItem("Money-vars-foto-id-normalmd",downloadURL);
                        });
                    });

        });
    };

    block.filein3 = document.querySelector("#foto3md");
    block.filein3.onchange = function (e) {
        block.files = e.target.files;
        block.file = block.files[0];
        ImageTools.resize(block.file, {
            width: 300,
            height: 500
        }, function (blob, didItResize) {

            var storageRef = firebase.storage().ref();
            var uploadTask = storageRef.child('images/' + blob.name).put(blob);
            uploadTask.on(firebase.storage.TaskEvent.STATE_CHANGED,
                    function(snapshot) {
                        var progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                        switch (snapshot.state) {
                            case firebase.storage.TaskState.PAUSED:
                                break;
                            case firebase.storage.TaskState.RUNNING:
                                break;
                        }
                    }, function(error) {
                        switch (error.code) {
                            case 'storage/unauthorized':
                                break;
                            case 'storage/canceled':
                                break;
                            case 'storage/unknown':
                                break;
                        }
                    }, function() {
                        uploadTask.snapshot.ref.getDownloadURL().then(function(downloadURL) {
                            $("#foto_m3md").attr("src", downloadURL);
                            window.sessionStorage.setItem("Money-vars-foto-id-reversomd", downloadURL);
                        });
                    });

        });
    };

    $("#limpiar_contrato").click(function () {
        $("#asesor_foto_selec").attr("src", "../img/default.jpg");
        $("#foto_user_clien").attr("src", "../img/default.jpg");
        $("#selector_asesores_lista option[value='']").attr("selected", true);
        $("#selector_cuotas_selec option[value='']").attr("selected", true);
        $("#monto_prestar_ya_admin").val("");
        $("#text_cedula_cliente").val("");
        $("#text_cedula_asesor").val("");
        $("#text_nombre_cliente").val("");
        $("#utilidad_prestada").html("0");
        $("#utilidad_prestada_peso").html("0");
        $("#utilidad_cuota").html("0");
        $("#cuota_descontar_sistema").val("1");
        actualFeacha();
        $("#text_cedula_cliente").prop("disabled",true);
        $("#text_cedula_cliente").prop("disabled",true);
        window.sessionStorage.removeItem("Money-vars-registrado");
    });
	
		$("#comporta").click(function(){
		if($("#lista_asesores_general").val()!==""){
		
			if (window.localStorage.getItem("Money-vars-token") !== null) {
				block.tokens = JSON.parse(window.localStorage.getItem("Money-vars-token"));
			} else {
				block.tokens = JSON.parse(window.sessionStorage.getItem("Money-vars-token"));
			}
		
			block.ele = $("#lista_asesores_general").val();
			block.elex = block.ele.split("_");
			
			block.arrays = [block.tokens[1],block.elex[0]];
			block.obj = {"r": "comportamiento", "d": block.arrays};
			backend.conexionEnvio(JSON.stringify(block.obj), function (salida) {
				var valor = JSON.parse(salida);
				if (!valor.e) {
					block.penientes = parseInt(valor.d[0]);
					block.resuduoPendiente = parseInt(valor.d[1]);
					block.cuantoDieronmocho = parseInt(valor.d[2]);
					block.incompleta = parseInt(valor.d[3]);
					block.cuatoincompleta = parseInt(valor.d[4]);
					block.completa = parseInt(valor.d[6]);
					block.cuatocompleta = parseInt(valor.d[5]);
					block.sumato9 = parseInt(valor.d[7]);
					block.sumato10 = parseInt(valor.d[8]);
					block.sumato11 = parseInt(valor.d[9]);
					block.sumato12 = parseInt(valor.d[10]);
					block.sumato13 = parseInt(valor.d[11]);
					block.sumato14 = parseInt(valor.d[12]);
					block.sumato15 = parseInt(valor.d[13]);
					block.sumato16 = parseInt(valor.d[14]);
					block.sumato19 = parseInt(valor.d[15]);
					block.sumato18 = parseInt(valor.d[16]);
					
					
					block.tempA1 = parseInt(valor.d[18]); //si no pago nada (sumo los monto no pagados)
					block.tempA2 = parseInt(valor.d[19]); //numero del anterior
					block.tempB1 = parseInt(valor.d[20]);  //no pagon completo pero pago un repele (sumos los repeles)
					block.tempB2 = parseInt(valor.d[21]); //numero del anterior
					block.tempC1 = parseInt(valor.d[22]);  //si no pagaron (sumo la deuda de lo que debe el asesor) 
					block.tempC2 = parseInt(valor.d[23]); //numero del anterior
					block.numMonto = parseInt(valor.d[24]); //monto pago completo completo de hoy
					block.numCant = parseInt(valor.d[25]); //numero del anterior
					
					$("#expeci").html("Monto de quien no pago nada el dia de hoy: Q"+ block.tempA1+" y son: "+block.tempA2+" <br> Monto de quienes pagaron completo pero quedo mocho (sumo el repele): Q"+block.tempB1+" y son: "+block.tempB2+" <br> Monto de todo lo que quedan debiendo los pagos mochos: Q"+block.tempC1+" y son: "+block.tempC2+" <br> Monto de los que pagaron completos hoy: Q"+block.numMonto+" y son :"+block.numCant+" <br>" );

					block.sumato = block.cuantoDieronmocho + block.cuatoincompleta + block.cuatocompleta;
					block.porce_2 = parseInt((block.cuantoDieronmocho / block.sumato) * 100);
					block.porce_3 = parseInt((block.cuatoincompleta / block.sumato) * 100);
					block.porce_1 = parseInt((block.cuatocompleta / block.sumato) * 100);

					if(isNaN(block.porce_1)){
						block.porce_1 = 0;
					}
					if(isNaN(block.porce_2)){
						block.porce_2 = 0;
					}
					if(isNaN(block.porce_3)){
						block.porce_3 = 0;
					}

					block.penientesx = block.penientes.toString().split('').reverse().join('').replace(/(?=\d*\.?)(\d{3})/g,'$1.');
                    block.penientesx = block.penientesx.split('').reverse().join('').replace(/^[\.]/,'');
					block.incompletax = block.incompleta.toString().split('').reverse().join('').replace(/(?=\d*\.?)(\d{3})/g,'$1.');
                    block.incompletax = block.incompletax.split('').reverse().join('').replace(/^[\.]/,'');
					block.completax = block.completa.toString().split('').reverse().join('').replace(/(?=\d*\.?)(\d{3})/g,'$1.');
                    block.completax = block.completax.split('').reverse().join('').replace(/^[\.]/,'');

					block.sumato2 = block.cuantoDieronmocho + block.cuatocompleta;
					block.sumato4 = parseInt(block.penientes) + parseInt(block.completa);
					block.porce_4 = parseInt((block.sumato2 / sumato) * 100);

					if(isNaN(block.porce_4)){
						block.porce_4 = 0;
					}

					block.sumato4 = block.sumato4.toString().split('').reverse().join('').replace(/(?=\d*\.?)(\d{3})/g,'$1.');
                    block.sumato4 = block.sumato4.split('').reverse().join('').replace(/^[\.]/,'');

					block.sumato7 = block.cuatoincompleta + block.cuantoDieronmocho + block.cuatocompleta;
					block.sumato3 = block.sumato10;
					block.sumato3 = block.sumato3.toString().split('').reverse().join('').replace(/(?=\d*\.?)(\d{3})/g,'$1.');
                    block.sumato3 = block.sumato3.split('').reverse().join('').replace(/^[\.]/,'');

					$("#com_canti").text(parseInt(block.cuatocompleta));
					$("#com_valor").text("Q"+block.completax);
					$("#com_porce").text(block.porce_1+"%");

					$("#incom_canti").text(parseInt(block.cuatoincompleta));
					$("#incom_valor").text("Q"+block.incompletax);
					$("#incom_porce").text(block.porce_3+"%");

					$("#mcom_canti").text(parseInt(block.cuantoDieronmocho));
					$("#mcom_valor").text("Q"+penientesx);
					$("#mcom_porce").text(block.porce_2+"%");

					$("#rcom_canti").text(parseInt(block.sumato2));
					$("#rcom_valor").text("Q"+block.sumato4);
					$("#rcom_porce").text(block.porce_4+"%");

					$("#ecom_canti").text(parseInt(block.sumato7));
					$("#ecom_valor").text("Q"+sumato3);
					$("#ecom_porce").text("100%");

					block.sumato9x = block.sumato9.toString().split('').reverse().join('').replace(/(?=\d*\.?)(\d{3})/g,'$1.');
                    block.sumato9x = block.sumato9x.split('').reverse().join('').replace(/^[\.]/,'')
					$("#todi_capi").text("Q"+block.sumato9x);                    

					block.sumato11x = block.sumato11.toString().split('').reverse().join('').replace(/(?=\d*\.?)(\d{3})/g,'$1.');
                    block.sumato11x = block.sumato11x.split('').reverse().join('').replace(/^[\.]/,'');
					$("#inclavos").text("Q"+block.sumato11x);                    
					$("#cinclavos").text(block.sumato12);                    

					block.sumato13x = block.sumato13.toString().split('').reverse().join('').replace(/(?=\d*\.?)(\d{3})/g,'$1.');
                    block.sumato13x = block.sumato13x.split('').reverse().join('').replace(/^[\.]/,'');
					$("#involados").text("Q"+block.sumato13x);
					$("#cinvolados").text(block.sumato14);

					block.sumato15x = block.sumato15.toString().split('').reverse().join('').replace(/(?=\d*\.?)(\d{3})/g,'$1.');
                    block.sumato15x = block.sumato15x.split('').reverse().join('').replace(/^[\.]/,'');
					$("#inficticios").text("Q"+block.sumato15x);
					$("#cinficticios").text(block.sumato16);

					block.refloes = block.sumato11+ block.sumato13 + block.sumato15;
					block.sumato17 = block.refloes.toString().split('').reverse().join('').replace(/(?=\d*\.?)(\d{3})/g,'$1.');
                    block.sumato17 = block.sumato17.split('').reverse().join('').replace(/^[\.]/,'');

					block.real = block.sumato9 - block.refloes;
					block.real = block.real.toString().split('').reverse().join('').replace(/(?=\d*\.?)(\d{3})/g,'$1.');
                    block.real = block.real.split('').reverse().join('').replace(/^[\.]/,'');

					block.uneaa = "Q"+block.sumato9x + " - Q" +block.sumato17 + " => Capital Neto Q"+block.real;
					$("#capital_neto").text(block.uneaa);


					block.sumato18 = block.sumato18.toString().split('').reverse().join('').replace(/(?=\d*\.?)(\d{3})/g,'$1.');
                    block.sumato18 = block.sumato18.split('').reverse().join('').replace(/^[\.]/,'');
					$("#capital_pendiente").text("El asesor posee "+block.sumato19+" monto pendiente por un total de Q"+block.sumato18);

					$("#modal_comporta").modal("show");
				}
			});
		}else {
			toastr.warning('Seleccione asesor', 'Atención!');
		}
	});

    $("#crear_contrato").click(function () {
        if(window.sessionStorage.getItem("Money-vars-registrado")!==null &&  $("#monto_prestar_ya_admin").val()!==""){
            block.asesor = $("#selector_asesores_lista").val();
            block.ruta = block.asesor.split("_");
            block.rutax = block.ruta[0];
            block.monto_prestar = $("#monto_prestar_ya_admin").val();
            block.frecuencia = $("#selector_frecuencia").val();
            block.dias = $("#selector_cuotas_selec").val();
            block.fecha_prestamo = $("#fechaActual").val();
            block.descontar = $("#cuota_descontar_sistema").val();
            block.porcentaje = $("#utilidad_prestada").html();
            block.quedo_cuota = $("#utilidad_cuota").html();
            block.dias = block.dias - block.descontar;

            if(block.descontar<block.dias){

                if (window.localStorage.getItem("Money-vars-token") !== null) {
                    block.tokens = JSON.parse(window.localStorage.getItem("Money-vars-token"));
                } else {
                    block.tokens = JSON.parse(window.sessionStorage.getItem("Money-vars-token"));
                }

                block.arrays = [block.tokens[1],window.sessionStorage.getItem("Money-vars-registrado"),block.rutax,block.monto_prestar,block.dias,block.fecha_prestamo,block.descontar,block.porcentaje,block.quedo_cuota,block.tokens[4],block.frecuencia];
                block.obj = {"r": "crear_contrato", "d": block.arrays};
                backend.conexionEnvio(JSON.stringify(block.obj), function (salida) {
                    var valor = JSON.parse(salida);
                    if (!valor.e) {
                        $("#text_cedula_cliente").prop("disabled",false);
                        toastr.success('Creado con éxito teniendo en cuenta '+valor.d[1]+' contratos en la esta empresa y '+valor.d[2]+' contratos en otra empresa ', 'Atención!');
                        $("#limpiar_contrato").click();
                    }else{
                        if(valor.d[1]=="4"){
                            toastr.warning('El cliente tiene '+valor.d[2]+' prestamos y no cumple con las condiciones del jefe', 'Atención!');
                        }
                    }
                });

            }else{
                toastr.warning('No puede colocar prestamo de '+block.dias+' cuotas y va a descontar '+block.descontar+' cuotas ', 'Atención!');
            }

        }else{
            toastr.warning('No esta registrado el cliente', 'Atención!');
        }
    });

    $("#foto_m1").click(function () {
        $("#foto1").click();
    });

    $("#foto_m2").click(function () {
        $("#foto2").click();
    });

    $("#foto_m3").click(function () {
        $("#foto3").click();
    });

    $("#foto_m1m").click(function () {
        $("#foto1m").click();
    });

    $("#foto_m1md").click(function () {
        $("#foto1md").click();
    });

    $("#foto_m2m").click(function () {
        $("#foto2m").click();
    });

    $("#foto_m3m").click(function () {
        $("#foto3m").click();
    });

    $("#foto_m4m").click(function () {
        $("#foto4m").click();
    });

    $("#foto_m4md").click(function () {
        $("#foto4md").click();
    });

    $("#foto_m3md").click(function () {
        $("#foto3md").click();
    });

    $("#foto_m2md").click(function () {
        $("#foto2md").click();
    });


    function listar_cuotas() {
        if (window.localStorage.getItem("Money-vars-token") !== null) {
            block.tokens = JSON.parse(window.localStorage.getItem("Money-vars-token"));
        } else {
            block.tokens = JSON.parse(window.sessionStorage.getItem("Money-vars-token"));
        }

        block.arrays = [block.tokens[1]];
        block.obj = {"r": "listar_cuotas", "d": block.arrays};
        backend.conexionEnvio(JSON.stringify(block.obj), function (salida) {
            var valor = JSON.parse(salida);
            if (!valor.e) {
                block.lista = valor.d[1];
                block.nuevo = "";
                block.nuevo2 = "<option value=''>Seleccione</option>";
                block.lisat = [];
                for (var e = 0; e < block.lista.length; e++) {
                    block.iten = JSON.parse(block.lista[e]);
                    block.lisat.push(block.iten);
                    block.nuevo2 = block.nuevo2 + '<option value="'+block.iten[2]+'">'+block.iten[1]+'</option>';
                    block.nuevo = block.nuevo + '<tr><td>' + block.iten[1] + '</td><td>' + block.iten[2] + '</td><td>' + block.iten[3] + '%</td></td>';
                }
                window.sessionStorage.setItem("Lista_cuota",JSON.stringify(block.lisat));
                $("#selector_cuotas_selec").html(block.nuevo2);
                $("#listado_cuotas_lis").html(block.nuevo);
            }
        });
    }

    $("#nombre_id1").prop("disabled", true);
    $("#nombre_id2").prop("disabled", true);
    $("#apellido_id1").prop("disabled", true);
    $("#apellido_id2").prop("disabled", true);

    $("#nombre_id1m").prop("disabled", true);
    $("#nombre_id2m").prop("disabled", true);
    $("#apellido_id1m").prop("disabled", true);
    $("#apellido_id2m").prop("disabled", true);

    $("#nombre_id1md").prop("disabled", true);
    $("#nombre_id2md").prop("disabled", true);
    $("#apellido_id1md").prop("disabled", true);
    $("#apellido_id2md").prop("disabled", true);

    $("#guardar_cuota").click(function () {
        if ($("#descripcion_couta").val() !== "" && $("#dias_coutas").val() !== "" && $("#monto_num_interes").val() !== "") {

            if (window.localStorage.getItem("Money-vars-token") !== null) {
                block.tokens = JSON.parse(window.localStorage.getItem("Money-vars-token"));
            } else {
                block.tokens = JSON.parse(window.sessionStorage.getItem("Money-vars-token"));
            }

            block.arrays = [block.tokens[1], $("#descripcion_couta").val(), $("#dias_coutas").val(), $("#monto_num_interes").val()];
            block.obj = {"r": "crear_cuota", "d": block.arrays};
            backend.conexionEnvio(JSON.stringify(block.obj), function (salida) {
                var valor = JSON.parse(salida);
                if (!valor.e) {
                    $("#descripcion_couta").val("");
                    $("#dias_coutas").val("");
                    $("#monto_num_interes").val("");
                    listar_cuotas();
                    toastr.success('Registrado correctamente', 'Atención!');
                }
            });

        }
    });


    listar_cuotas();

    $("#numero_id").keypress(function (e) {
        if (e.which == 13) {
            $("#consultar_registra").click();
        }
    });


    function buscar_contratos(cedula){
        if (window.localStorage.getItem("Money-vars-token") !== null) {
            block.tokens = JSON.parse(window.localStorage.getItem("Money-vars-token"));
        } else {
            block.tokens = JSON.parse(window.sessionStorage.getItem("Money-vars-token"));
        }

        block.arrays = [block.tokens[1],cedula];
        $("#lista_enorme").html("");
        block.oso="";
        block.obj = {"r": "contratos_lista", "d": block.arrays};
        backend.conexionEnvio(JSON.stringify(block.obj), function (salida) {
            var valor = JSON.parse(salida);
            if (!valor.e) {

                function capitalize(string) {
                    return string.charAt(0).toUpperCase() + string.slice(1).toLowerCase();
                }

                block.listaGrande = valor.d[1];
                for(var w = 0; w < block.listaGrande.length; w++){
                    block.asesor="";
                    block.dat0s = block.listaGrande[w];
                    block.unox = JSON.parse(block.dat0s[0]);
                    block.dosx = JSON.parse(block.dat0s[1]);
                    block.tresx = JSON.parse(block.dat0s[2]);
                    if(block.dat0s[3].length>0){
                        block.cuatrox = JSON.parse(block.dat0s[3]);
                        block.exta = block.cuatrox[3].split("_");
                        block.exta2 = block.cuatrox[2].split("_");
                        block.superv = block.exta[3] + " " +block.exta[4];
                        block.asesor = block.exta2[3] + " " +block.exta[4];
                    }else{
                        block.superv = "No asignado";
                    }
                    if(block.dat0s[4].length>0) {
                        block.cincox = JSON.parse(block.dat0s[4]);
                        block.extav = block.cincox[3].split("_");
                        block.exta2f = block.cincox[2].split("_");
                        block.ayudan = block.extav[3] + " " +block.extav[4];
                        block.asesor = block.exta2f[3]+ " " +block.exta2f[4];
                    }else{
                        block.ayudan = "No asignado";
                    }
                    if(block.dat0s[5]!==null) {
                        if (block.dat0s[5].length > 0) {
                            block.seisx = JSON.parse(block.dat0s[5]);
                            block.asesor = block.seisx[7] + " " + block.seisx[8];
                        }
                    }

                    block.oso = block.oso + '<tr><td>'+block.unox[5]+'</td><td>'+block.tresx[24]+'_'+block.unox[0]+'</td> <td>'+block.tresx[6]+'</td> <td>'+block.tresx[7]+' '+block.tresx[9]+'</td><td>'+block.asesor+'</td><td>$'+block.unox[3]+'</td> <td>'+block.unox[7]+'</td> <td>$'+block.unox[8]+'</td><td>'+block.ayudan+'</td><td>'+block.superv+'</td><td><div class="btn-group"><button data-toggle="dropdown" class="btn btn-default dropdown-toggle"></button> <ul class="dropdown-menu"><li><a class="dropdown-item" href="javascript:refinanciar_lis('+String.fromCharCode(39)+'contrato_'+block.unox[1]+'_'+block.unox[2]+'_'+block.unox[5]+'_'+block.unox[0]+String.fromCharCode(39)+')"><i class="fa fa-retweet"></i> &nbsp Refinanciar</a></li> <li class="dropdown-divider"></li><li><a class="dropdown-item"  href="javascript:impresion_lis('+String.fromCharCode(39)+'contrato_'+block.unox[1]+'_'+block.unox[2]+'_'+block.unox[5]+'_'+block.unox[0]+String.fromCharCode(39)+');"><i class="fa fa-print"></i> &nbsp Imprimir</a></li> </ul></div></td></tr>';

                }
                $("#lista_enorme").html(block.oso);

            }
        });
    }


    function listado_contratos(mun){

        block.unico =  parseInt(mun);

        if (window.localStorage.getItem("Money-vars-token") !== null) {
            block.tokens = JSON.parse(window.localStorage.getItem("Money-vars-token"));
        } else {
            block.tokens = JSON.parse(window.sessionStorage.getItem("Money-vars-token"));
        }

        block.arrays = [block.tokens[1],block.tokens[4],block.unico,$("#lista_asesores_general3").val()];        
        block.obj = {"r": "contratos_lista_all", "d": block.arrays};        
        backend.conexionEnvio(JSON.stringify(block.obj), function (salida) {
            var valor = JSON.parse(salida);
            if (!valor.e) {

                block.oso="";
                block.dat0s =valor.d[1][0];
                block.unox = JSON.parse(block.dat0s[0]);
                block.dosx = block.dat0s[1];
                block.tresx = block.dat0s[2];
                block.cuatrosx = JSON.parse(block.dat0s[3]);

                if(block.dosx.length>0){
					block.exta2 = block.dosx[3];
					block.exta = block.exta2.split("_");
                    block.superv = block.exta[3] + " " +block.exta[4];
                }else{
                    block.superv = "No asignado";
                }
                if(block.tresx.length>0) {
                    block.exta2a = JSON.parse(block.tresx);
					block.extaa = block.exta2a[3].split("_");
                    block.ayudan = block.extaa[3] + " " +block.extaa[4];
                }else{
                    block.ayudan = "No asignado";
                }

                block.esf = $("#lista_asesores_general3")["0"].options.selectedIndex;
                block.tesq = $("#lista_asesores_general3")["0"][block.esf].label.split("ID:");
				block.calsulo = block.unox[13];
				block.sumas = 0;

				for(var u= 0; u<block.calsulo.length; u++){ 

                    if(!block.calsulo[u].ct && block.calsulo[u].pe==0){

                        if(block.calsulo.length>1){
                            block.sumas = block.sumas + parseInt(block.calsulo[u].cp);
                        } else {
                            block.sumas = block.calsulo[u].cp.replace(/\./g, "");
                        }

					} else if(block.calsulo[u].pe !== 0 ){
                        block.sumas = block.sumas + parseInt(block.calsulo[u].pe);
					}
                    
				}

                block.sumas = block.sumas.toString().split('').reverse().join('').replace(/(?=\d*\.?)(\d{3})/g,'$1.');
                block.sumas = block.sumas.split('').reverse().join('').replace(/^[\.]/,'');
				block.oso = block.oso + '<tr><td>'+block.unox[5]+'</td> <td>'+block.sumas+'</td><td>'+block.cuatrosx[7]+'</td> <td>'+block.cuatrosx[8]+' '+block.cuatrosx[10]+'</td> <td>'+block.tesq[0]+'</td><td>'+block.unox[3]+'</td><td>'+block.unox[7]+'%</td><td>'+block.unox[8]+'</td></tr>';

                block.unico++;
                listado_contratos(block.unico);
                $("#lista_enorme").append(block.oso);
            }

        });
    }

    function descontar(e){
        block.tecla = (document.all) ? e.keyCode : e.which;
        if (block.tecla==13) {

            block.vueno = $("#lista_asesores_general").val();
            block.toma = block.vueno.split("_");
            block.asesorId = block.toma[0];

            var cedula2 = e.srcElement.id;
            var cedula3 = cedula2.split("_");
            var cedula = cedula3[1];

            if (window.localStorage.getItem("Money-vars-token") !== null) {
                block.tokens = JSON.parse(window.localStorage.getItem("Money-vars-token"));
            } else {
                block.tokens = JSON.parse(window.sessionStorage.getItem("Money-vars-token"));
            }
            block.monto_pago = $("#descontarte_" + cedula).val();
            block.arrays = [block.tokens[1], cedula, block.monto_pago, block.tokens[4],block.asesorId];
            block.obj = {"r": "descontar_cuota_admin", "d": block.arrays};
            backend.conexionEnvio(JSON.stringify(block.obj), function (salida) {
                var valor = JSON.parse(salida);
                if (!valor.e) {
                    //window.sessionStorage.removeItem("asesore_list_liquida_"+block.asesorId);
                    //toastr.success('Procesado con éxito', 'Atención!');
                    setTimeout(function(){
                        liquidar_sincro([block.elims])
                    },4000);
                    //Tiempo real
                    //sumatoria();
                    //extraes();
                    block.subi = $("#musc_"+cedula)["0"].innerHTML;
                    block.subimon = parseInt($("#musc_"+cedula).text());
                    if( block.subi.indexOf("down")>-1 ){
                        if(block.subimon==1){
                            $("#musc_"+cedula)["0"].innerHTML = '<i class="fa fa-arrow-up" style="color:#28a745"></i> 1';
                        }else{
                            block.real = block.subimon -1;
                            $("#musc_"+cedula)["0"].innerHTML = '<i class="fa fa-arrow-up" style="color:#28a745"></i> '+block.real;
                        }
                    }else{
                        block.real = block.subimon+1;
                        $("#musc_"+cedula)["0"].innerHTML = '<i class="fa fa-arrow-up" style="color:#28a745"></i> '+block.real;
                    }

                }
            });

        }
    }


    function liquidar_sincro(arrws){

        if (window.localStorage.getItem("Money-vars-token") !== null) {
            block.tokens = JSON.parse(window.localStorage.getItem("Money-vars-token"));
        } else {
            block.tokens = JSON.parse(window.sessionStorage.getItem("Money-vars-token"));
        }

        if(arrws.length>0){
            toastr.warning('Espere mientras sincroniza liquidación de asesores', 'Atención!');

            function liqui(ind,arrws){
                if(ind==arrws.length){
                    toastr.success('Ha sincronizado todo los datos para liquidar', 'Atención!');
                }else{
                    block.unids ="";
                    block.arrays = [block.tokens[1],"nada",arrws[ind][0],arrws[ind][1]];
                    block.obj = {"r": "liquida_parte_1", "d": block.arrays};
                    backend.conexionEnvio(JSON.stringify(block.obj), function (salida) {
                        var valor = JSON.parse(salida);
                        window.sessionStorage.setItem("asesore_list_liquida_" + arrws[ind][0], salida);
                        window.sessionStorage.setItem("asesore_lis_limp", arrws[ind][0]);
                        ind++;
                        liqui(ind,arrws);
                    });

                }
            }

            liqui(0,arrws);
        }
    }


    $("#lista_asesores_general3").change(function(){
        if($("#lista_asesores_general3").val()!==""){
            block.ase = $("#lista_asesores_general3").val();
            $("#lista_enorme").html("");
            listado_contratos("0");
        }
    });

    $("#buscar_contra").keypress(function (e) {
        if (e.which == 13 && $("#buscar_contra").val()!==""){
            buscar_contratos($("#buscar_contra").val());
        }
    });

    $("#text_cedula_cliente").keypress(function (e) {
        if (e.which == 13) {
            $("#buscar_cedula_cliente").click();
        }
    });

    $("#numero_idm").keypress(function (e) {
        if (e.which == 13) {
            $("#consultar_registram").click();
        }
    });

    $("#numero_idmd").keypress(function (e) {
        if (e.which == 13) {
            $("#consultar_registramd").click();
        }
    });

    function eliminarRelacion(emailAsesor){

        if (window.localStorage.getItem("Money-vars-token") !== null) {
            block.tokens = JSON.parse(window.localStorage.getItem("Money-vars-token"));
        } else {
            block.tokens = JSON.parse(window.sessionStorage.getItem("Money-vars-token"));
        }

        block.arrays = [block.tokens[1],emailAsesor];
        block.obj = {"r": "eliminar_asociar", "d": block.arrays};
        backend.conexionEnvio(JSON.stringify(block.obj), function (salida) {
            var valor = JSON.parse(salida);
        });

    }

    $("#consultar_registra").click(function () {

        function navegador() {
            var agente = window.navigator.userAgent;
            var navegadores = ["Chrome", "Firefox", "Safari"];
            for (var i in navegadores) {
                if (agente.indexOf(navegadores[i]) != -1) {
                    return navegadores[i].toLowerCase();
                }
            }
        }

        block.nav = navegador();

        if ($("#numero_id").val() !== "") {
            if (window.localStorage.getItem("Money-vars-token") !== null) {
                block.tokens = JSON.parse(window.localStorage.getItem("Money-vars-token"));
            } else {
                block.tokens = JSON.parse(window.sessionStorage.getItem("Money-vars-token"));
            }

            block.arrays = [block.tokens[1], $("#numero_id").val(), block.nav, $("#tipo_letra").val(), window.sessionStorage.getItem("Money-vars-tipo")];
            block.obj = {"r": "consultar_cedula", "d": block.arrays};
            backend.conexionEnvio(JSON.stringify(block.obj), function (salida) {
                var valor = JSON.parse(salida);
                if (!valor.e) {
                    block.todo = valor.d[1];
                    block.nombre = block.todo[0];

                    if (block.nombre == "") {
                        $("#nombre_id1").val("");
                        $("#nombre_id2").val("");
                        $("#apellido_id1").val("");
                        $("#apellido_id2").val("");
                        toastr.error('El documento a consultar no existe', 'Atención!');

                    } else {

                        block.antece = block.todo[1];
                        block.porque = block.todo[2];

                        if(block.porque=="" && block.antece=="Si"){
                            block.porque = "Esta información es muy delicada para ser mostrada";
                        }

                        if(block.antece=="Si"){
                            swal({
								title: "Atención!",
								text: "Posee antecedente, "+block.porque,
								type: "warning"
							});
                        }

                        block.deatlle = block.nombre.substring(0, 1);

                        if (block.deatlle == " ") {
                            block.nombre = block.nombre.substring(1, block.nombre.length);
                        }

                        block.estimar = block.nombre.split(" ");
                        if (block.estimar.length == 6) {
                            block.primNom = block.estimar[0];
                            block.seguNom = block.estimar[1] + " " + block.estimar[2] + " " + block.estimar[3];
                            block.primApe = block.estimar[4];
                            block.seguApe = block.estimar[5];
                        }else if (block.estimar.length == 5) {
                            block.primNom = block.estimar[0];
                            block.seguNom = block.estimar[1] + " " + block.estimar[2];
                            block.primApe = block.estimar[3];
                            block.seguApe = block.estimar[4];
                        } else if (block.estimar.length == 4) {
                            block.primNom = block.estimar[0];
                            block.seguNom = block.estimar[1];
                            block.primApe = block.estimar[2];
                            block.seguApe = block.estimar[3];
                        } else if (block.estimar.length == 3) {
                            block.primNom = block.estimar[0];
                            block.seguNom = block.estimar[1];
                            block.primApe = block.estimar[2];
                            block.seguApe = "";
                        } else if (block.estimar.length == 2) {
                            block.primNom = block.estimar[0];
                            block.seguNom = "";
                            block.primApe = block.estimar[1];
                            block.seguApe = "";
                        }


                        $("#nombre_id1").val(block.primNom);
                        $("#nombre_id2").val(block.seguNom);
                        $("#apellido_id1").val(block.primApe);
                        $("#apellido_id2").val(block.seguApe);
                        $("#numero_id").prop("disabled", true);
                        $("#tipo_letra").prop("disabled", true);

                    }
                }else{
                    if(valor.d[1]=="r"){
                        toastr.warning('Esta persona esta registrada en otra empresa', 'Atención!');

                        swal({
                            title: "Atención!",
                            text: "Desea asociarlo a la empresa?",
                            type: "warning",
                            showCancelButton: true,
                            confirmButtonColor: "#DD6B55",
                            confirmButtonText: "Si, asociarlo",
                            closeOnConfirm: true
                        }, function () {
                            block.infeas = JSON.parse(valor.d[2]);
                            $("#nombre_id1").val(block.infeas[7]);
                            $("#nombre_id2").val(block.infeas[8]);
                            $("#apellido_id1").val(block.infeas[9]);
                            $("#apellido_id2").val(block.infeas[10]);
                            $("#direccion_ubica").val(block.infeas[11]);
                            $("#telefono_cel").val(block.infeas[16]);
                            $("#foto_m1").attr("src",block.infeas[1]);
                            $("#foto_m2").attr("src",block.infeas[2]);
                            $("#foto_m3").attr("src",block.infeas[3]);
                            eliminarRelacion(block.infeas[17]);
                        });

                    }else if(valor.d[1]=="5"){
						block.frito = JSON.parse(valor.d[2]);
						if(block.frito[1]=="1"){
							block.des = "El cliente no quiere pagar (Clavo)";
						}else if(block.frito[1]=="2"){
							block.des = "El cliente no se encuentra (Volado)";
						}else if(block.frito[1]=="3"){
							block.des = "El cliente inventado (Ficticia)";
						}
						toastr.warning(block.des, 'Atención!');
					}
                }
            });
        } else {
            toastr.warning('Falta número de identificación', 'Atención!');
        }

    });


    function extraes(){

        if($("#lista_asesores_general").val()!=="" && $("#result2").val()!==""){

            $("#listado_operacion_asesore").html("");
            block.asesoe = $("#lista_asesores_general").val();
            block.dividio = block.asesoe.split("_");
            block.ides =  block.dividio[0];
            block.cedula =  block.dividio[1];
            block.foto =  block.dividio[2];
            block.fecha = $("#result2").val();

            if (window.localStorage.getItem("Money-vars-token") !== null) {
                block.tokens = JSON.parse(window.localStorage.getItem("Money-vars-token"));
            } else {
                block.tokens = JSON.parse(window.sessionStorage.getItem("Money-vars-token"));
            }

            $("#listado_operacion_asesore")["0"].dataset.asesor = block.ides;

            if(window.sessionStorage.getItem("asesore_list_liquida_"+block.ides)!==null){
                var valor = JSON.parse(window.sessionStorage.getItem("asesore_list_liquida_"+block.ides));
                if (!valor.e) {

                    $("#listado_operacion_asesore").html("");
                    block.unids = '';
                    block.liCoutas = valor.d[1];

                    for(var bc=0; bc< block.liCoutas.length; bc++){
                        block.clienes = JSON.parse(block.liCoutas[bc][1]);
                        block.contra = block.liCoutas[bc][0];
                        block.ince = block.liCoutas[bc][2];

                        block.pages = 0;
                        block.deuda = false;
                        block.favolr = 0;
                        block.cobarar = 0;
                        block.sale2 = 0;
                        var hoy = moment().format('YYYY-MM-DD');

                        for(var k = 0; k<block.contra[13].length; k++){

                            block.sale2 = block.sale2 + parseInt(block.contra[13][k].cp);
                            if (block.contra[13][k].ct) {
                                block.sale2 = block.sale2 - parseInt(block.contra[13][k].cp);
                            }else if(block.contra[13][k].pe!==0){
                                block.sale2 = block.sale2 - parseInt(block.contra[13][k].pe);
                            }

                            if(!block.deuda){
                                if (block.contra[13][k].ct || block.contra[13][k].pe !== 0) {
                                    block.favolr++;
                                }else{
                                    block.cobarar++;
                                }
                                if(block.contra[13][k].fe == hoy){
                                    block.deuda = true;
                                }
                            }else{
                                if (block.contra[13][k].ct || block.contra[13][k].pe !== 0) {
                                    block.favolr++;
                                }
                            }
                    }


                        if (block.cobarar<block.favolr){
                            block.cobfavol ='<i class="fa fa-arrow-up" style="color:#28a745"></i> '+(block.favolr - block.cobarar);
                        } else if(block.cobarar>block.favolr){
                            block.cobfavol ='<i class="fa fa-arrow-down" style="color:#dc3545"></i> '+block.cobarar;
                        } else if(block.cobarar==block.favolr){
                            block.cobfavol ='<i class="fa fa-check" style="color:blue;"></i> 0';
                        }

                        block.evals = block.contra[3].replace(".","");
                        block.evals2 = block.evals.replace(".","");
                        block.sale2 = block.sale2.toString().split('').reverse().join('').replace(/(?=\d*\.?)(\d{3})/g,'$1.');
                        block.totaldu = block.sale2.split('').reverse().join('').replace(/^[\.]/,'');

                        block.unids = block.unids + '<tr class="item" id="iten'+bc+'" data-ubic="'+bc+'"><td>'+bc+'</td><td>'+block.clienes[8]+" "+block.clienes[10]+'</td><td>'+block.clienes[19]+'</td><td>Q'+block.contra[8]+'</td><td id="musc_'+block.clienes[7]+'_'+block.ince+'">'+block.cobfavol+'</td><td>Q'+block.contra[3]+'</td><td id="montos_'+block.clienes[7]+'_'+block.ince+'">Q'+block.totaldu+'</td></tr>';
                    }
                    $("#listado_operacion_asesore").html(block.unids);
                }
        }else{
                toastr.warning('Espere se esta sincronizando la información del asesor', 'Atención!');

                block.unids ="";
                block.arrays = [block.tokens[1],block.fecha,block.ides,block.cedula];
                block.obj = {"r": "liquida_parte_1", "d": block.arrays};
                backend.conexionEnvio(JSON.stringify(block.obj), function (salida) {
                    var valor = JSON.parse(salida);
                        if (!valor.e) {

                        $("#listado_operacion_asesore").html("");

                        block.liCoutas = valor.d[1];

                        for(var bc=0; bc< block.liCoutas.length; bc++){
                            block.clienes = JSON.parse(block.liCoutas[bc][1]);
                            block.contra = block.liCoutas[bc][0];
                            block.ince = block.liCoutas[bc][2];

                            block.pages = 0;
                            block.deuda = false;
                            block.favolr = 0;
                            block.cobarar = 0;
                            var hoy = moment().format('YYYY-MM-DD');

                            for(var k = 0; k<block.contra[13].length; k++){
                                if(!block.deuda){
                                    if (block.contra[13][k].ct || block.contra[13][k].pe !== 0) {
                                        block.favolr++;
                                    }else{
                                        block.cobarar++;
                                    }
                                    if(block.contra[13][k].fe == hoy){
                                        block.deuda = true;
                                    }
                                }else{
                                    if (block.contra[13][k].ct || block.contra[13][k].pe !== 0) {
                                        block.favolr++;
                                    }
                                }
                        }


                            if(block.cobarar<block.favolr){
                                block.cobfavol ='<i class="fa fa-arrow-up" style="color:#28a745"></i> '+(block.favolr - block.cobarar);
                            }else if(block.cobarar>block.favolr){
                                block.cobfavol ='<i class="fa fa-arrow-down" style="color:#dc3545"></i> '+block.cobarar;
                            }else if(block.cobarar==block.favolr){
                                block.cobfavol ='<i class="fa fa-check" style="color:blue;"></i> 0';
                            }

                            block.evals = block.contra[3].replace(".","");
                            block.evals2 = block.evals.replace(".","");
                            block.totaldu = parseInt(block.evals2) * ( parseInt(block.contra[7]) / 100) + parseInt(block.evals2);
                            block.totaldu = block.totaldu.toString().split('').reverse().join('').replace(/(?=\d*\.?)(\d{3})/g,'$1.');
                            block.totaldu = block.totaldu.split('').reverse().join('').replace(/^[\.]/,'');

                            block.unids = block.unids + '<tr class="item" id="iten'+bc+'" data-ubic="'+bc+'"><td>'+bc+'</td><td>'+block.clienes[8]+" "+block.clienes[10]+'</td><td>'+block.clienes[19]+'</td><td>Q'+block.contra[8]+'</td><td></td><td></td><td id="musc_'+block.clienes[7]+'_'+block.ince+'">'+block.cobfavol+'</td><td><input type="text" class="form-control" style="width: 50%;"  id="descontarte_'+block.clienes[7]+'_'+block.ince+'" onkeypress="descontar(event);" onkeyup="descontarws(event);"></td><td>Q'+block.contra[3]+'</td><td id="montos_'+block.clienes[7]+'_'+block.ince+'">Q'+block.totaldu+'</td></tr>';
                        }
                        $("#listado_operacion_asesore").html(block.unids);
                    }
                });
            }
        }

        function organizar(){
            block.suma =[];
            block.asesor = $("#listado_operacion_asesore")["0"].dataset.asesor;
            block.unisao = $("#listado_operacion_asesore")["0"].childNodes;
            for(var q = 0; q <block.unisao.length; q++){
                block.ites =block.unisao[q].dataset.ubic;
                block.suma.push(block.ites);
            }

            if (window.localStorage.getItem("Money-vars-token") !== null) {
                block.tokens = JSON.parse(window.localStorage.getItem("Money-vars-token"));
            } else {
                block.tokens = JSON.parse(window.sessionStorage.getItem("Money-vars-token"));
            }
            block.arrays = [block.tokens[1], block.suma,block.asesor];
            block.obj = {"r": "ordenar_contrato", "d": block.arrays};
            backend.conexionEnvio(JSON.stringify(block.obj), function (salida) {
                var valor = JSON.parse(salida);
                if (!valor.e) {
                    toastr.success('Se guardo el orden', 'Atención!');
                }
            });
        }

        $('table.sortable').sortable({
            items: ".item",
            axis: "y",
            stop: function(event, ui) {
                ui.item.effect('highlight');
            },
            update: function(event, ui) {
                organizar();
            }
        });
    }

    $("#registro_base").click(function(){
        $("#modal_base").modal("show");
	});

    function sumatoria(){
        block.unew = $("#lista_asesores_general").val();
        block.resq = block.unew.split("_");
        block.asesoreId=block.resq[0];

        if (window.localStorage.getItem("Money-vars-token") !== null) {
            block.tokens = JSON.parse(window.localStorage.getItem("Money-vars-token"));
        } else {
            block.tokens = JSON.parse(window.sessionStorage.getItem("Money-vars-token"));
        }

        block.arrays = [block.tokens[1],block.asesoreId];
        block.obj = {"r": "sumatoria_diario", "d": block.arrays};
        backend.conexionEnvio(JSON.stringify(block.obj), function (salida) {
            var valor = JSON.parse(salida);
            if (!valor.e) {                
                valor.d[1] = valor.d[1].toString().split('').reverse().join('').replace(/(?=\d*\.?)(\d{3})/g,'$1.');                
                valor.d[1] = valor.d[1].split('').reverse().join('').replace(/^[\.]/,'');                
                const button = document.getElementById('registro_base');
				if(valor.d[2]!=="0" && valor.d[2]!==0){
                    button.setAttribute('disabled', '');
					valor.d[2] = valor.d[2].toString().split('').reverse().join('').replace(/(?=\d*\.?)(\d{3})/g,'$1.');
					valor.d[2] = valor.d[2].split('').reverse().join('').replace(/^[\.]/,'');
				}else{
                    button.removeAttribute('disabled');
					valor.d[2] = 0;
					valor.d[3] = "";
				}
                $("#base_anterior").text("Base anterior: Q"+valor.d[2]+ " Guardado: "+ valor.d[3]);
                $("#text_recolectado").text("Q"+valor.d[1]);
                $("#text_base").text("Q"+valor.d[2]);
                window.sessionStorage.setItem("sumatoria_"+block.asesoreId,valor.d[1]);
                window.sessionStorage.setItem("liquidacion_accion",block.asesoreId);
            }
        });
    }

    function historial_clientes(){
        $("#HistorialClientes").css("display","initial");
        $("#googleMap").css("display","none");
        $("#crear_contrato_form").css("display", "none");
        $("#crear_contrato_form_dos").css("display", "none");
        $("#lista_ayu").css("display", "none");
        $("#lista_sup").css("display", "none");
        $("#lista_ase").css("display", "none");
        $("#crear").css("display", "none");
        $("#asig_supervidor").css("display", "none");
        $("#lista_asi_ayu").css("display", "none");
        $("#lista_asi_sup").css("display", "none");
        $("#configuracion_general").css("display", "none");
        $("#busqueda_asignaciones").css("display", "none");
        $("#configuracion_general_cuotas").css("display", "none");
        $("#liquidacion_page").css("display", "none");
        $("#liquidacion_page2").css("display", "none");
        $("#create_clientes_listo").css("display", "none");
        $("#contratos_view").css("display", "none");
        $("#consulta_cobros").css("display", "none");
        $("#consulta_gastos").css("display", "none");
        $("#cierre_view").css("display", "none");
    }


    function buscar_mapa(){
        $("#googleMap").css("display","initial");
        $("#crear_contrato_form").css("display", "none");
        $("#crear_contrato_form_dos").css("display", "none");
        $("#lista_ayu").css("display", "none");
        $("#lista_sup").css("display", "none");
        $("#lista_ase").css("display", "none");
        $("#crear").css("display", "none");
        $("#asig_supervidor").css("display", "none");
        $("#lista_asi_ayu").css("display", "none");
        $("#lista_asi_sup").css("display", "none");
        $("#configuracion_general").css("display", "none");
        $("#busqueda_asignaciones").css("display", "none");
        $("#configuracion_general_cuotas").css("display", "none");
        $("#liquidacion_page").css("display", "none");
        $("#liquidacion_page2").css("display", "none");
        $("#create_clientes_listo").css("display", "none");
        $("#contratos_view").css("display", "none");
        $("#cierre_view").css("display", "none");
        $("#HistorialClientes").css("display","none");
        $("#consulta_cobros").css("display", "none");
        $("#consulta_gastos").css("display", "none");
        // $("#cliente_lista_admi").css("display", "none");
    }

    $("#lista_asesores_general").change(function () {
        block.esf = $("#lista_asesores_general")["0"].options.selectedIndex;
        block.tesq = $("#lista_asesores_general")["0"][block.esf].innerHTML.split("ID: ");
		window.sessionStorage.setItem("asesore_lis_limp",block.tesq[1]);
		sumatoria();
		$("#listado_operacion_asesore").html("");
        extraes();
    });


    $.fn.setCursorPosition = function(pos) {
        this.each(function(index, elem) {
            if (elem.setSelectionRange) {
                elem.setSelectionRange(pos, pos);
            } else if (elem.createTextRange) {
                var range = elem.createTextRange();
                range.collapse(true);
                range.moveEnd('character', pos);
                range.moveStart('character', pos);
                range.select();
            }
        });
        return this;
    };

    function descontarws(e){
        var cedula2 = e.srcElement.id,cedula3 = cedula2.split("_"),cedula = cedula3[1];
        block.monto_pago = $("#descontarte_" + cedula).val();
        if(block.monto_pago.length==1 && block.monto_pago!=="0"){
            block.nume = block.monto_pago * 1000;
            $("#descontarte_" + cedula).val(block.nume);
            $("#descontarte_" + cedula).focus().setCursorPosition(1);
        }else if($("#descontarte_" + cedula).val()=="000"){
            $("#descontarte_" + cedula).val(0);
            $("#descontarte_" + cedula).val("");
        }

        block.monto_pago = $("#descontarte_" + cedula).val();
        if(block.monto_pago!=="") {
            block.monsdeu = window.sessionStorage.getItem("monto_de_"+cedula);
            block.desuda = block.monsdeu.replace(".", "");
            block.desuda2 = block.desuda.replace(".", "");
            block.desuda2 = block.desuda2.replace("$", "");
            block.dueda_real = parseInt(block.desuda2);
            block.resula = block.dueda_real - parseInt(block.monto_pago);
            block.resula = block.resula.toString().split('').reverse().join('').replace(/(?=\d*\.?)(\d{3})/g, '$1.');
            block.resula = block.resula.split('').reverse().join('').replace(/^[\.]/, '');
            $("#montos_" + cedula).html("$"+block.resula);
        }
    }


    $("#consultar_registram").click(function () {

        function navegador() {
            var agente = window.navigator.userAgent;
            var navegadores = ["Chrome", "Firefox", "Safari"];
            for (var i in navegadores) {
                if (agente.indexOf(navegadores[i]) != -1) {
                    return navegadores[i].toLowerCase();
                }
            }
        }

        block.nav = navegador();

        if ($("#numero_idm").val() !== "") {
            if (window.localStorage.getItem("Money-vars-token") !== null) {
                block.tokens = JSON.parse(window.localStorage.getItem("Money-vars-token"));
            } else {
                block.tokens = JSON.parse(window.sessionStorage.getItem("Money-vars-token"));
            }

            block.arrays = [block.tokens[1], $("#numero_idm").val(), block.nav, $("#tipo_letram").val(), window.sessionStorage.getItem("Money-vars-tipo")];

            block.obj = {"r": "consultar_cedula", "d": block.arrays};
            backend.conexionEnvio(JSON.stringify(block.obj), function (salida) {
                var valor = JSON.parse(salida);
                if (!valor.e) {
                    block.todo = valor.d[1];
                    block.nombre = block.todo[0];

                    if (block.nombre == "") {
                        $("#nombre_id1m").val("");
                        $("#nombre_id2m").val("");
                        $("#apellido_id1m").val("");
                        $("#apellido_id2m").val("");
                        toastr.error('El documento a consultar no existe', 'Atención!');

                    } else {

                        block.antece = block.todo[1];
                        block.porque = block.todo[2];

                        if(block.porque=="" && block.antece=="Si"){
                            block.porque = "Esta información es muy delicada para ser mostrada";
                        }

                        if(block.antece=="Si"){
                            swal({
								title: "Atención!",
								text: "Posee antecedente, "+block.porque,
								type: "warning"
							});
                        }

                        block.deatlle = block.nombre.substring(0, 1);

                        if (block.deatlle == " ") {
                            block.nombre = block.nombre.substring(1, block.nombre.length);
                        }

                        block.estimar = block.nombre.split(" ");

                        if (block.estimar.length == 6) {
                            block.primNom = block.estimar[0];
                            block.seguNom = block.estimar[1] + " " + block.estimar[2] + " " + block.estimar[3];
                            block.primApe = block.estimar[4];
                            block.seguApe = block.estimar[5];
                        }else if (block.estimar.length == 5) {
                            block.primNom = block.estimar[0];
                            block.seguNom = block.estimar[1] + " " + block.estimar[2];
                            block.primApe = block.estimar[3];
                            block.seguApe = block.estimar[4];
                        } else if (block.estimar.length == 4) {
                            block.primNom = block.estimar[0];
                            block.seguNom = block.estimar[1];
                            block.primApe = block.estimar[2];
                            block.seguApe = block.estimar[3];
                        } else if (block.estimar.length == 3) {
                            block.primNom = block.estimar[0];
                            block.seguNom = block.estimar[1];
                            block.primApe = block.estimar[2];
                            block.seguApe = "";
                        } else if (block.estimar.length == 2) {
                            block.primNom = block.estimar[0];
                            block.seguNom = "";
                            block.primApe = block.estimar[1];
                            block.seguApe = "";
                        }


                        $("#nombre_id1m").val(block.primNom);
                        $("#nombre_id2m").val(block.seguNom);
                        $("#apellido_id1m").val(block.primApe);
                        $("#apellido_id2m").val(block.seguApe);
                        $("#numero_idm").prop("disabled", true);
                        $("#tipo_letram").prop("disabled", true);

                    }
					
                }else{
				
					if(valor.d[1]=="5"){
						block.frito = JSON.parse(valor.d[2]);
						if(block.frito[1]=="1"){
							block.des = "El cliente no quiere pagar (Clavo)";
						}else if(block.frito[1]=="2"){
							block.des = "El cliente no se encuentra (Volado)";
						}else if(block.frito[1]=="3"){
							block.des = "El cliente inventado (Ficticia)";
						}
						toastr.warning(block.des, 'Atención!');
					}
				}
            });

        } else {
            toastr.warning('Falta número de identificación', 'Atención!');
        }

    });

    $("#consultar_registramd").click(function () {

        function navegador() {
            var agente = window.navigator.userAgent;
            var navegadores = ["Chrome", "Firefox", "Safari"];
            for (var i in navegadores) {
                if (agente.indexOf(navegadores[i]) != -1) {
                    return navegadores[i].toLowerCase();
                }
            }
        }

        block.nav = navegador();

        if ($("#numero_idmd").val() !== "") {
            if (window.localStorage.getItem("Money-vars-token") !== null) {
                block.tokens = JSON.parse(window.localStorage.getItem("Money-vars-token"));
            } else {
                block.tokens = JSON.parse(window.sessionStorage.getItem("Money-vars-token"));
            }

            block.arrays = [block.tokens[1], $("#numero_idmd").val(), block.nav, $("#tipo_letramd").val(), window.sessionStorage.getItem("Money-vars-tipo")];

            block.obj = {"r": "consultar_cedula", "d": block.arrays};
            backend.conexionEnvio(JSON.stringify(block.obj), function (salida) {
                var valor = JSON.parse(salida);
                if (!valor.e) {
                    block.todo = valor.d[1];
                    block.nombre = block.todo[0];

                    if (block.nombre == "") {
                        $("#nombre_id1md").val("");
                        $("#nombre_id2md").val("");
                        $("#apellido_id1md").val("");
                        $("#apellido_id2md").val("");
                        toastr.error('El documento a consultar no existe', 'Atención!');

                    } else {

                        block.antece = block.todo[1];
                        block.porque = block.todo[2];

                        if(block.porque=="" && block.antece=="Si"){
                            block.porque = "Esta información es muy delicada para ser mostrada";
                        }

                        if(block.antece=="Si"){
                            swal({
								title: "Atención!",
								text: "Posee antecedente, "+block.porque,
								type: "warning"
							});
                        }

                        block.deatlle = block.nombre.substring(0, 1);

                        if (block.deatlle == " ") {
                            block.nombre = block.nombre.substring(1, block.nombre.length);
                        }

                        block.estimar = block.nombre.split(" ");

                        if (block.estimar.length == 6) {
                            block.primNom = block.estimar[0];
                            block.seguNom = block.estimar[1] + " " + block.estimar[2] + " " + block.estimar[3];
                            block.primApe = block.estimar[4];
                            block.seguApe = block.estimar[5];
                        }else if (block.estimar.length == 5) {
                            block.primNom = block.estimar[0];
                            block.seguNom = block.estimar[1] + " " + block.estimar[2];
                            block.primApe = block.estimar[3];
                            block.seguApe = block.estimar[4];
                        } else if (block.estimar.length == 4) {
                            block.primNom = block.estimar[0];
                            block.seguNom = block.estimar[1];
                            block.primApe = block.estimar[2];
                            block.seguApe = block.estimar[3];
                        } else if (block.estimar.length == 3) {
                            block.primNom = block.estimar[0];
                            block.seguNom = block.estimar[1];
                            block.primApe = block.estimar[2];
                            block.seguApe = "";
                        } else if (block.estimar.length == 2) {
                            block.primNom = block.estimar[0];
                            block.seguNom = "";
                            block.primApe = block.estimar[1];
                            block.seguApe = "";
                        }


                        $("#nombre_id1md").val(block.primNom);
                        $("#nombre_id2md").val(block.seguNom);
                        $("#apellido_id1md").val(block.primApe);
                        $("#apellido_id2md").val(block.seguApe);
                        $("#numero_idmd").prop("disabled", true);
                        $("#tipo_letramd").prop("disabled", true);

                    }
                }else{
					if(valor.d[1]=="5"){
						block.frito = JSON.parse(valor.d[2]);
						if(block.frito[1]=="1"){
							block.des = "El cliente no quiere pagar (Clavo)";
						}else if(block.frito[1]=="2"){
							block.des = "El cliente no se encuentra (Volado)";
						}else if(block.frito[1]=="3"){
							block.des = "El cliente inventado (Ficticia)";
						}
						toastr.warning(block.des, 'Atención!');
					}
				}
            });

        } else {
            toastr.warning('Falta número de identificación', 'Atención!');
        }

    });


    $("#letra_venezuela").css("display", "none");
    $("#letra_venezuelam").css("display", "none");
    $("#letra_venezuelamd").css("display", "none");

    window.sessionStorage.setItem("Money-vars-tipo", "1");

    $("#tipo_cargo").change(function () {
        if ($("#tipo_cargo").val() == "a" || $("#tipo_cargo").val() == "c") {
            $("#moto_detalle").css("display", "initial");
        } else {
            $("#moto_detalle").css("display", "none");
        }
    });

    $("#pais_selecionado").change(function () {
        $("#numero_id").prop("disabled", false);
        $("#tipo_letra").prop("disabled", false);
        $("#nombre_id1").val("");
        $("#nombre_id2").val("");
        $("#apellido_id1").val("");
        $("#apellido_id2").val("");

        if ($("#pais_selecionado").val() == "1") {
            window.sessionStorage.setItem("Money-vars-tipo", "1");
            $("#numero_id").val("");
            $("#letra_venezuela").css("display", "none");
            $("#cedula_div").removeClass("col-sm-6").removeClass("col-md-3").removeClass("col-xs-12").addClass("col-xs-6").addClass("col-sm-6").addClass("col-md-6");
        } else {
            window.sessionStorage.setItem("Money-vars-tipo", "2");
            $("#numero_id").val("");
            $("#letra_venezuela").css("display", "initial");
            $("#cedula_div").addClass("col-sm-6").addClass("col-md-3").addClass("col-xs-12").removeClass("col-xs-6").removeClass("col-sm-6").removeClass("col-md-6");
        }
    });

    $("#pais_selecionadom").change(function () {

        $("#numero_idm").prop("disabled", false);
        $("#tipo_letram").prop("disabled", false);
        $("#nombre_id1m").val("");
        $("#nombre_id2m").val("");
        $("#apellido_id1m").val("");
        $("#apellido_id2m").val("");

        if ($("#pais_selecionadom").val() == "1") {
            window.sessionStorage.setItem("Money-vars-tipo", "1");
            $("#numero_idm").val("");
            $("#letra_venezuelam").css("display", "none");
            $("#cedula_divm").removeClass("col-sm-6").removeClass("col-md-3").removeClass("col-xs-12")
                    .addClass("col-xs-12").addClass("col-sm-6").addClass("col-md-6");
        } else {
            window.sessionStorage.setItem("Money-vars-tipo", "2");
            $("#numero_idm").val("");
            $("#letra_venezuelam").css("display", "initial");
            $("#cedula_divm").addClass("col-sm-6").addClass("col-md-3").addClass("col-xs-12")
                    .removeClass("col-xs-12").removeClass("col-sm-6").removeClass("col-md-6");
        }


    });


    $("#pais_selecionadomd").change(function () {

        $("#numero_idmd").prop("disabled", false);
        $("#tipo_letramd").prop("disabled", false);
        $("#nombre_id1md").val("");
        $("#nombre_id2md").val("");
        $("#apellido_id1md").val("");
        $("#apellido_id2md").val("");

        if ($("#pais_selecionadomd").val() == "1") {
            window.sessionStorage.setItem("Money-vars-tipo", "1");
            $("#numero_idmd").val("");
            $("#letra_venezuelamd").css("display", "none");
            $("#cedula_divmd").removeClass("col-sm-6").removeClass("col-md-3").removeClass("col-xs-12").addClass("col-xs-6").addClass("col-sm-6").addClass("col-md-6");
        } else {
            window.sessionStorage.setItem("Money-vars-tipo", "2");
            $("#numero_idmd").val("");
            $("#letra_venezuelamd").css("display", "initial");
            $("#cedula_divmd").addClass("col-sm-6").addClass("col-md-3").addClass("col-xs-12").removeClass("col-xs-6").removeClass("col-sm-6").removeClass("col-md-6");
        }


    });

    if (window.localStorage.getItem("Money-vars-token") !== null) {
        block.tokens = JSON.parse(window.localStorage.getItem("Money-vars-token"));
    } else {
        block.tokens = JSON.parse(window.sessionStorage.getItem("Money-vars-token"));
    }

    function actualFeacha(){
        var fecha = new Date();
        var mes = fecha.getMonth()+1;
        var dia = fecha.getDate();
        var ano = fecha.getFullYear();
        if(dia<10)
            dia='0'+dia;
        if(mes<10)
            mes='0'+mes;
        document.getElementById('fechaActual').value=ano+"-"+mes+"-"+dia;
    }

    window.onload = function(){
        actualFeacha();
    };

    function extraer_ciudades() {
        block.depart = $("#tipo_departamento").val();
        $("#tipo_ciudades").html('<option value=""></option>');

        if (window.localStorage.getItem("Money-vars-token") !== null) {
            block.tokens = JSON.parse(window.localStorage.getItem("Money-vars-token"));
        } else {
            block.tokens = JSON.parse(window.sessionStorage.getItem("Money-vars-token"));
        }

        block.arrays = [block.tokens[1], block.depart];
        block.obj = {"r": "extraer_ciudades", "d": block.arrays};
        backend.conexionEnvio(JSON.stringify(block.obj), function (salida) {
            var valor = JSON.parse(salida);
            if (!valor.e) {
                block.lista = valor.d[1];
                block.nuevo = "";
                for (var e = 0; e < block.lista.length; e++) {
                    block.nuevo = block.nuevo + '<option value="' + block.lista[e] + '">' + block.lista[e] + '</option>';
                }
                $("#tipo_ciudades").html($("#tipo_ciudades").html() + block.nuevo);
            }
        });
    }

    function extraer_ciudadesm() {
        block.depart = $("#tipo_departamentom").val();
        $("#tipo_ciudadesm").html('<option value=""></option>');

        if (window.localStorage.getItem("Money-vars-token") !== null) {
            block.tokens = JSON.parse(window.localStorage.getItem("Money-vars-token"));
        } else {
            block.tokens = JSON.parse(window.sessionStorage.getItem("Money-vars-token"));
        }

        block.arrays = [block.tokens[1], block.depart];
        block.obj = {"r": "extraer_ciudades", "d": block.arrays};
        backend.conexionEnvio(JSON.stringify(block.obj), function (salida) {
            var valor = JSON.parse(salida);
            if (!valor.e) {
                block.lista = valor.d[1];
                block.nuevo = "";
                for (var e = 0; e < block.lista.length; e++) {
                    block.nuevo = block.nuevo + '<option value="' + block.lista[e] + '">' + block.lista[e] + '</option>';
                }
                $("#tipo_ciudadesm").html($("#tipo_ciudadesm").html() + block.nuevo);
            }
        });
    }

    function extraer_ciudadesmd() {
        block.depart = $("#tipo_departamentomd").val();
        $("#tipo_ciudadesmd").html('<option value=""></option>');

        if (window.localStorage.getItem("Money-vars-token") !== null) {
            block.tokens = JSON.parse(window.localStorage.getItem("Money-vars-token"));
        } else {
            block.tokens = JSON.parse(window.sessionStorage.getItem("Money-vars-token"));
        }

        block.arrays = [block.tokens[1], block.depart];
        block.obj = {"r": "extraer_ciudades", "d": block.arrays};
        backend.conexionEnvio(JSON.stringify(block.obj), function (salida) {
            var valor = JSON.parse(salida);
            if (!valor.e) {
                block.lista = valor.d[1];
                block.nuevo = "";
                for (var e = 0; e < block.lista.length; e++) {
                    block.nuevo = block.nuevo + '<option value="' + block.lista[e] + '">' + block.lista[e] + '</option>';
                }
                $("#tipo_ciudadesmd").html($("#tipo_ciudadesmd").html() + block.nuevo);
            }
        });
    }

    function extraer_ciudadesmd() {
        block.depart = $("#tipo_departamentomd").val();
        $("#tipo_ciudadesmd").html('<option value=""></option>');

        if (window.localStorage.getItem("Money-vars-token") !== null) {
            block.tokens = JSON.parse(window.localStorage.getItem("Money-vars-token"));
        } else {
            block.tokens = JSON.parse(window.sessionStorage.getItem("Money-vars-token"));
        }

        block.arrays = [block.tokens[1], block.depart];
        block.obj = {"r": "extraer_ciudades", "d": block.arrays};
        backend.conexionEnvio(JSON.stringify(block.obj), function (salida) {
            var valor = JSON.parse(salida);
            if (!valor.e) {
                block.lista = valor.d[1];
                block.nuevo = "";
                for (var e = 0; e < block.lista.length; e++) {
                    block.nuevo = block.nuevo + '<option value="' + block.lista[e] + '">' + block.lista[e] + '</option>';
                }
                $("#tipo_ciudadesmd").html($("#tipo_ciudadesmd").html() + block.nuevo);
            }
        });
    }

    block.arrays = [block.tokens[1]];
    block.obj = {"r": "extraer_departamentos", "d": block.arrays};
    backend.conexionEnvio(JSON.stringify(block.obj), function (salida) {
        var valor = JSON.parse(salida);
        if (!valor.e) {
            block.lista = valor.d[1];
            block.nuevo = "";
            for (var e = 0; e < block.lista.length; e++) {
                block.nuevo = block.nuevo + '<option value="' + block.lista[e] + '">' + block.lista[e] + '</option>';
            }
            $("#tipo_departamento").html($("#tipo_departamento").html() + block.nuevo);
            $("#tipo_departamentom").html($("#tipo_departamentom").html() + block.nuevo);
            $("#tipo_departamentomd").html($("#tipo_departamentomd").html() + block.nuevo);
        }
    });

    function extraer_barrios() {
        block.depart = $("#tipo_departamento").val();
        block.cuidad = $("#tipo_ciudades").val();
        $("#tipo_barrio").html('<option value=""></option>');

        if (window.localStorage.getItem("Money-vars-token") !== null) {
            block.tokens = JSON.parse(window.localStorage.getItem("Money-vars-token"));
        } else {
            block.tokens = JSON.parse(window.sessionStorage.getItem("Money-vars-token"));
        }

        block.arrays = [block.tokens[1], block.depart, block.cuidad];
        block.obj = {"r": "extraer_barrios", "d": block.arrays};
        backend.conexionEnvio(JSON.stringify(block.obj), function (salida) {
            var valor = JSON.parse(salida);
            if (!valor.e) {
                block.lista = valor.d[1];
                block.nuevo = "";
                for (var e = 0; e < block.lista.length; e++) {
                    block.nuevo = block.nuevo + '<option value="' + block.lista[e] + '">' + block.lista[e] + '</option>';
                }
                $("#tipo_barrio").html($("#tipo_barrio").html() + block.nuevo);
            }
        });
    }
    
    $("#text_total_asesor").keyup(function(e){
        if($('#id_asesor_cierre').val() != "" && $('#text_total_asesor').val() != "") {
            const totalAsesor = parseFloat($('#text_total_asesor').val());
            const totalSistema = parseFloat($('#text_total_sistema').text().slice(1));
            const diferencia = totalAsesor - totalSistema;
            if ( totalAsesor !== "" && totalAsesor !== 0 && totalSistema !=="" && isNaN(totalAsesor) === false ) {
                $("#text_diferencia_cierre").text("Q" + diferencia );
                //registrarCierre();
            }else {
                $("#text_diferencia_cierre").text("Q");
            } 
        } else {
            toastr.warning("Debe de especificar el asesor y el total asignado", "Atención");
            $('#text_diferencia_cierre').text("");
        }
    });

    function extraer_barriosm() {
        block.depart = $("#tipo_departamentom").val();
        block.cuidad = $("#tipo_ciudadesm").val();
        $("#tipo_barriom").html('<option value=""></option>');

        if (window.localStorage.getItem("Money-vars-token") !== null) {
            block.tokens = JSON.parse(window.localStorage.getItem("Money-vars-token"));
        } else {
            block.tokens = JSON.parse(window.sessionStorage.getItem("Money-vars-token"));
        }

        block.arrays = [block.tokens[1], block.depart, block.cuidad];
        block.obj = {"r": "extraer_barrios", "d": block.arrays};
        backend.conexionEnvio(JSON.stringify(block.obj), function (salida) {
            var valor = JSON.parse(salida);
            if (!valor.e) {
                block.lista = valor.d[1];
                block.nuevo = "";
                for (var e = 0; e < block.lista.length; e++) {
                    block.nuevo = block.nuevo + '<option value="' + block.lista[e] + '">' + block.lista[e] + '</option>';
                }
                $("#tipo_barriom").html($("#tipo_barriom").html() + block.nuevo);
            }
        });
    }

    function extraer_barriosmd() {
        block.depart = $("#tipo_departamentomd").val();
        block.cuidad = $("#tipo_ciudadesmd").val();
        $("#tipo_barriomd").html('<option value=""></option>');

        if (window.localStorage.getItem("Money-vars-token") !== null) {
            block.tokens = JSON.parse(window.localStorage.getItem("Money-vars-token"));
        } else {
            block.tokens = JSON.parse(window.sessionStorage.getItem("Money-vars-token"));
        }

        block.arrays = [block.tokens[1], block.depart, block.cuidad];
        block.obj = {"r": "extraer_barrios", "d": block.arrays};
        backend.conexionEnvio(JSON.stringify(block.obj), function (salida) {
            var valor = JSON.parse(salida);
            if (!valor.e) {
                block.lista = valor.d[1];
                block.nuevo = "";
                for (var e = 0; e < block.lista.length; e++) {
                    block.nuevo = block.nuevo + '<option value="' + block.lista[e] + '">' + block.lista[e] + '</option>';
                }
                $("#tipo_barriomd").html($("#tipo_barriomd").html() + block.nuevo);
            }
        });
    }

    $("#tipo_ciudades").change(function () {
        if ($("#tipo_ciudades").val() !== "") {
            extraer_barrios();
        }
    });

    $("#tipo_departamento").change(function () {
        if ($("#tipo_departamento").val() !== "") {
            extraer_ciudades();
        }
    });

    $("#tipo_ciudadesm").change(function () {
        if ($("#tipo_ciudadesm").val() !== "") {
            extraer_barriosm();
        }
    });

    $("#tipo_ciudadesmd").change(function () {
        if ($("#tipo_ciudadesmd").val() !== "") {
            extraer_barriosmd();
        }
    });

    $("#tipo_departamentom").change(function () {
        if ($("#tipo_departamentom").val() !== "") {
            extraer_ciudadesm();
        }
    });

    $("#tipo_departamentomd").change(function () {
        if ($("#tipo_departamentomd").val() !== "") {
            extraer_ciudadesmd();
        }
    });

    function no_exite_cliente() {
        $("#popop_new_cliente").modal("show");
    }

    $("#buscar_cedula_cliente").click(function () {
        if ($("#text_cedula_cliente").val() !== "") {

            if (window.localStorage.getItem("Money-vars-token") !== null) {
                block.tokens = JSON.parse(window.localStorage.getItem("Money-vars-token"));
            } else {
                block.tokens = JSON.parse(window.sessionStorage.getItem("Money-vars-token"));
            }

            block.arrays = [block.tokens[1],$("#text_cedula_cliente").val()];

            block.obj = {"r": "buscar_cliente", "d": block.arrays};
            backend.conexionEnvio(JSON.stringify(block.obj), function (salida) {
                var valor = JSON.parse(salida);
                if (!valor.e) {
                    block.partes = JSON.parse(valor.d[1]);
                    block.nomre = block.partes[7] +" "+block.partes[8] +" "+block.partes[9] +" "+block.partes[10];

                    block.estraa = $("#selector_asesores_lista").val();
                    block.estraaq = block.estraa.split("_");
                    block.estra = block.estraaq[0];
                    block.cedulasesor = block.estraaq[1];
                    block.fotoas = block.estraaq[2];
                    $("#text_cedula_asesor").val(block.cedulasesor);
                    $("#text_nombre_cliente").val(block.nomre);
                    $("#asesor_foto_selec").attr("src",block.fotoas);
                    window.sessionStorage.setItem("Money-vars-registrado",block.partes[6]);
                    $("#foto_user_clien").attr("src",block.partes[1]);
                }else{
                    no_exite_cliente();
                }
            });

        } else {
            toastr.warning('Falta DPI del cliente', 'Atención!');
        }
    });

    $("#registro_final").click(function () {
        block.pais = $("#pais_selecionado").val();
        block.reverso = window.sessionStorage.getItem("Money-vars-foto-id-reverso");
        block.normal = window.sessionStorage.getItem("Money-vars-foto-id-normal");
        block.perfil = window.sessionStorage.getItem("Money-vars-foto-id");
        if ($("#pais_selecionado").val() == "1") {
            block.tipo = "C";
        } else {
            block.tipo = $("#tipo_letra").val();
        }
        block.contras = $("#contra_sena").val();
        block.numero = $("#numero_id").val();
        block.nom1 = $("#nombre_id1").val();
        block.nom2 = $("#nombre_id2").val();
        block.ape1 = $("#apellido_id1").val();
        block.ape2 = $("#apellido_id2").val();
        block.direction = $("#direccion_ubica").val();
        block.departamento = $("#tipo_departamento").val();
        block.ciudad = $("#tipo_ciudades").val();
        block.barrio = $("#tipo_barrio").val();
        block.telefofijo = $("#telefono_fijo").val();
        block.telefomovil = $("#telefono_cel").val();
        block.correo = $("#correo_electronico").val();
        block.asesorSuperAsis = $("#tipo_cargo").val();
        if ($("#tipo_cargo").val() == "a" || $("#tipo_cargo").val() == "c") {
            block.monto = $("#moto_detalle_list").val();
        } else {
            block.monto = "No asignada";
        }

        if ($("#telefono_fijo").val() == "") {
            block.telefofijo = "0";
        }
        
                if (block.perfil == null) {
			block.perfil = "default_profile_photo.jpg";
		}
		if (block.normal == null) {
			block.normal = "front_card_by_default.png";
		}
		if (block.reverso == null) {
			block.reverso = "back_card_by_default.png";
        }
		if(block.fronatls==null){
            block.fronatls="default_invoice.png";
        }

        if (block.perfil == null) {
            toastr.warning('Falta adjuntar foto frontal del usuario', 'Atención!');
        } else if (block.normal == null) {
            toastr.warning('Falta adjuntar foto frontal de la cedula de identidad del usuario', 'Atención!');
        } else if (block.reverso == null) {
            toastr.warning('Falta adjuntar foto reverso de la cedula de identidad del usuario', 'Atención!');
        } else if (block.numero == "") {
            toastr.warning('Falta insertar numero de cedula', 'Atención!');
        } else if (block.nom1 == "") {
            toastr.warning('Falta insertar primer nombre', 'Atención!');
        } else if (block.ape1 == "") {
            toastr.warning('Falta insertar primer apellido', 'Atención!');
        } else if (block.direction == "") {
            toastr.warning('Falta insertar dirección del usuario', 'Atención!');
        } else if (block.departamento == "") {
            toastr.warning('Falta insertar departamento del usuario', 'Atención!');
        } else if (block.cuidad == "") {
            toastr.warning('Falta insertar ciudad del usuario', 'Atención!');
        } else if (block.barrio == "") {
            toastr.warning('Falta insertar barrio del usuario', 'Atención!');
        } else if (block.telefomovil == "") {
            toastr.warning('Falta telefono celular del cliente', 'Atención!');
        } else if (block.asesorSuperAsis == "") {
            toastr.warning('Falta seleccion de tipo del usuario', 'Atención!');
        } else if (block.contras == "") {
            toastr.warning('Falta contraseña del perfil', 'Atención!');
        } else {

            if (window.localStorage.getItem("Money-vars-token") !== null) {
                block.tokens = JSON.parse(window.localStorage.getItem("Money-vars-token"));
            } else {
                block.tokens = JSON.parse(window.sessionStorage.getItem("Money-vars-token"));
            }

            block.arrays = [block.tokens[1], block.perfil, block.normal, block.reverso, block.pais, block.tipo, block.numero, block.nom1, block.nom2, block.ape1, block.ape2, block.direction, block.departamento, block.ciudad, block.barrio, block.telefofijo, block.telefomovil, block.correo, block.asesorSuperAsis, block.monto,block.contras];
            block.obj = {"r": "crear_usuario", "d": block.arrays};
            backend.conexionEnvio(JSON.stringify(block.obj), function (salida) {
                var valor = JSON.parse(salida);
                if (!valor.e) {
                    window.sessionStorage.removeItem("Money-vars-foto-id-reverso");
                    window.sessionStorage.removeItem("Money-vars-foto-id-normal");
                    window.sessionStorage.removeItem("Money-vars-foto-id");
                    $("#telefono_fijo").val("");
                    $("#telefono_cel").val("");
                    $("#contra_sena").val("");
                    $("#correo_electronico").val("");
                    $("#tipo_cargo option[value=a]").attr("selected", true);
                    $("#pais_selecionado option[value='1']").attr("selected", true);
                    $("#tipo_departamento option[value='']").attr("selected", true);
                    $("#tipo_ciudades option[value='']").attr("selected", true);
                    $("#tipo_barrio option[value='']").attr("selected", true);
                    $("#moto_detalle").css("display", "none");
                    $("#numero_id").val("");
                    $("#nombre_id1").val("");
                    $("#nombre_id2").val("");
                    $("#apellido_id1").val("");
                    $("#apellido_id2").val("");
                    $("#direccion_ubica").val("");
                    $("#moto_detalle_list").val("");
                    $("#numero_id").prop("disabled", false);
                    $("#letra_venezuela").css("display", "none");
                    $("#foto_m1").attr("src", "../img/default.jpg");
                    $("#foto_m2").attr("src", "../img/foto_cedula_front.png");
                    $("#foto_m3").attr("src", "../img/foto_cedula_back.png");
                    $("#cedula_div").removeClass("col-sm-6").removeClass("col-md-3").removeClass("col-xs-12").addClass("col-xs-6").addClass("col-sm-6").addClass("col-md-6");
                    toastr.success('Registrado correctamente', 'Atención!');
                }
            });

        }
    });

    $("#registro_finalm").click(function () {
        
		block.pais = $("#pais_selecionadom").val();
        block.reverso = window.sessionStorage.getItem("Money-vars-foto-id-reversom");
        block.normal = window.sessionStorage.getItem("Money-vars-foto-id-normalm");
        block.perfil = window.sessionStorage.getItem("Money-vars-foto-idm");
        block.fronatls = window.sessionStorage.getItem("Money-vars-foto-frontal");
        if ($("#pais_selecionadom").val() == "1") {
            block.tipo = "C";
        } else {
            block.tipo = $("#tipo_letram").val();
        }
        block.alias = $("#alias_text").val();
        block.numero = $("#numero_idm").val();
        block.nom1 = $("#nombre_id1m").val();
        block.nom2 = $("#nombre_id2m").val();
        block.ape1 = $("#apellido_id1m").val();
        block.ape2 = $("#apellido_id2m").val();
        block.direction = $("#direccion_ubicam").val();
        block.departamento = $("#tipo_departamentom").val();
        block.ciudad = $("#tipo_ciudadesm").val();
        block.barrio = $("#tipo_barriom").val();
        block.telefofijo = $("#telefono_fijom").val();
        block.telefomovil = $("#telefono_celm").val();
        block.correo = $("#correo_electronicom").val();
        block.asesorSuperAsis = "d";
        block.monto = "No asignada";

        if ($("#telefono_fijom").val() == "") {
            block.telefofijo = "0";
        }
        
        
                if (block.perfil == null) {
			block.perfil = "default_profile_photo.jpg";
		}
		if (block.normal == null) {
			block.normal = "front_card_by_default.png";
		}
		if (block.reverso == null) {
			block.reverso = "back_card_by_default.png";
        }
		if(block.fronatls==null){
            block.fronatls="";
        }

        if (block.perfil == null) {
            toastr.warning('Falta adjuntar foto frontal del usuario', 'Atención!');
        } else if (block.normal == null) {
            toastr.warning('Falta adjuntar foto frontal de la cedula de identidad del usuario', 'Atención!');
        } else if (block.reverso == null) {
            toastr.warning('Falta adjuntar foto reverso de la cedula de identidad del usuario', 'Atención!');
        } else if (block.numero == "") {
            toastr.warning('Falta insertar numero de cedula', 'Atención!');
        } else if (block.nom1 == "") {
            toastr.warning('Falta insertar primer nombre', 'Atención!');
        } else if (block.ape1 == "") {
            toastr.warning('Falta insertar primer apellido', 'Atención!');
        } else if (block.direction == "") {
            toastr.warning('Falta insertar dirección del usuario', 'Atención!');
        } else if (block.departamento == "") {
            toastr.warning('Falta insertar departamento del usuario', 'Atención!');
        } else if (block.cuidad == "") {
            toastr.warning('Falta insertar ciudad del usuario', 'Atención!');
        } else if (block.barrio == "") {
            toastr.warning('Falta insertar barrio del usuario', 'Atención!');
        } else if (block.telefomovil == "") {
            toastr.warning('Falta telefono celular del cliente', 'Atención!');
        } else if (block.asesorSuperAsis == "") {
            toastr.warning('Falta seleccion de tipo del usuario', 'Atención!');
        }else{

            if (block.alias == "") {
                block.alias = "No asignado";
            }

            if (block.correo == "") {
                block.correo = "No asignado";
            }

            if (window.localStorage.getItem("Money-vars-token") !== null) {
                block.tokens = JSON.parse(window.localStorage.getItem("Money-vars-token"));
            } else {
                block.tokens = JSON.parse(window.sessionStorage.getItem("Money-vars-token"));
            }

            block.estraa = $("#selector_asesores_lista").val();
            block.estraaq = block.estraa.split("_");
            block.estra = block.estraaq[0];
            block.cedulasesor = block.estraaq[1];
            block.fotoas = block.estraaq[2];
            $("#asesor_foto_selec").attr("src", block.fotoas);
            $("#text_cedula_asesor").val(block.cedulasesor);
            block.arrays = [block.tokens[1], block.perfil, block.normal, block.reverso, block.pais, block.tipo, block.numero, block.nom1, block.nom2, block.ape1, block.ape2, block.direction, block.departamento, block.ciudad, block.barrio, block.telefofijo, block.telefomovil, block.correo, block.asesorSuperAsis, block.monto, block.estra, block.alias, block.fronatls];

            block.obj = {"r": "crear_cliente_admin", "d": block.arrays};
            backend.conexionEnvio(JSON.stringify(block.obj), function (salida) {
                var valor = JSON.parse(salida);
                if (!valor.e) {
                    block.escrito = block.nom1 + " " + block.nom2 + " " + block.ape1 + " " + block.ape2;
                    $("#text_nombre_cliente").val(block.escrito);
                    $("#text_cedula_cliente").val(block.numero);
                    $("#text_alias_cliente").prop("disabled", false);
                    window.sessionStorage.setItem("Money-vars-registrado", block.numero);
                    window.sessionStorage.removeItem("Money-vars-foto-id-reversom");
                    window.sessionStorage.removeItem("Money-vars-foto-id-normalm");
                    $("#foto_user_clien").attr("src", window.sessionStorage.getItem("Money-vars-foto-idm"));
                    window.sessionStorage.removeItem("Money-vars-foto-idm");
                    window.sessionStorage.removeItem("Money-vars-foto-frontal");
                    $("#telefono_fijom").val("");
                    $("#telefono_celm").val("");
                    $("#correo_electronicom").val("");
                    $("#tipo_cargom option[value=a]").attr("selected", true);
                    $("#pais_selecionadom option[value='1']").attr("selected", true);
                    $("#tipo_departamentom option[value='']").attr("selected", true);
                    $("#tipo_ciudadesm option[value='']").attr("selected", true);
                    $("#tipo_barriom option[value='']").attr("selected", true);
                    $("#numero_idm").val("");
                    $("#nombre_id1m").val("");
                    $("#nombre_id2m").val("");
                    $("#apellido_id1m").val("");
                    $("#apellido_id2m").val("");
                    $("#direccion_ubicam").val("");
                    $("#numero_idm").prop("disabled", false);
                    $("#buscar_cedula_cliente").prop("disabled", true);
                    $("#Inserte cedula").prop("disabled", true);
                    $("#letra_venezuelam").css("display", "none");
                    $("#foto_m1m").attr("src", "../img/default.jpg");
                    $("#foto_m2m").attr("src", "../img/foto_cedula_front.png");
                    $("#foto_m3m").attr("src", "../img/foto_cedula_back.png");
                    $("#cedula_divm").removeClass("col-sm-6").removeClass("col-md-3").removeClass("col-xs-12").addClass("col-xs-6").addClass("col-sm-6").addClass("col-md-6");
                    $("#popop_new_cliente").modal("hide");
                    toastr.success('Registrado correctamente', 'Atención!');
                }
            });
        }
    });

    $("#registro_finalmd").click(function () {
        block.pais = $("#pais_selecionadomd").val();
        block.reverso = window.sessionStorage.getItem("Money-vars-foto-id-reversomd");
        block.normal = window.sessionStorage.getItem("Money-vars-foto-id-normalmd");
        block.perfil = window.sessionStorage.getItem("Money-vars-foto-idmd");
        block.fronatls = window.sessionStorage.getItem("Money-vars-foto-frontald");
        if ($("#pais_selecionadomd").val() == "1") {
            block.tipo = "C";
        } else {
            block.tipo = $("#tipo_letramd").val();
        }
        if(block.fronatls==null){
            block.fronatls="no";
        }
        block.alias = $("#alias_textd").val();
        block.numero = $("#numero_idmd").val();
        block.nom1 = $("#nombre_id1md").val();
        block.nom2 = $("#nombre_id2md").val();
        block.ape1 = $("#apellido_id1md").val();
        block.ape2 = $("#apellido_id2md").val();
        block.direction = $("#direccion_ubicamd").val();
        block.departamento = $("#tipo_departamentomd").val();
        block.ciudad = $("#tipo_ciudadesmd").val();
        block.barrio = $("#tipo_barriomd").val();
        block.telefofijo = $("#telefono_fijomd").val();
        block.telefomovil = $("#telefono_celmd").val();
        block.correo = $("#correo_electronicomd").val();
        block.asesorSuperAsis = "d";
        block.monto = "No asignada";

        if ($("#telefono_fijomd").val() == "") {
            block.telefofijo = "0";
        }
        
                if (block.perfil == null) {
			block.perfil = "default_profile_photo.jpg";
		}
		if (block.normal == null) {
			block.normal = "front_card_by_default.png";
		}
		if (block.reverso == null) {
			block.reverso = "back_card_by_default.png";
        }
		if(block.fronatls==null){
            block.fronatls="default_invoice.png";
        }

        if (block.perfil == null) {
            toastr.warning('Falta adjuntar foto frontal del usuario', 'Atención!');
        } else if (block.normal == null) {
            toastr.warning('Falta adjuntar foto frontal de la cedula de identidad del usuario', 'Atención!');
        } else if (block.reverso == null) {
            toastr.warning('Falta adjuntar foto reverso de la cedula de identidad del usuario', 'Atención!');
        } else if (block.numero == "") {
            toastr.warning('Falta insertar numero de cedula', 'Atención!');
        } else if (block.nom1 == "") {
            toastr.warning('Falta insertar primer nombre', 'Atención!');
        } else if (block.ape1 == "") {
            toastr.warning('Falta insertar primer apellido', 'Atención!');
        } else if (block.direction == "") {
            toastr.warning('Falta insertar dirección del usuario', 'Atención!');
        } else if (block.departamento == "") {
            toastr.warning('Falta insertar departamento del usuario', 'Atención!');
        } else if (block.cuidad == "") {
            toastr.warning('Falta insertar ciudad del usuario', 'Atención!');
        } else if (block.barrio == "") {
            toastr.warning('Falta insertar barrio del usuario', 'Atención!');
        } else if (block.telefomovil == "") {
            toastr.warning('Falta telefono celular del cliente', 'Atención!');
        } else if (block.asesorSuperAsis == "") {
            toastr.warning('Falta seleccion de tipo del usuario', 'Atención!');
        }else if ($("#selector_asesores_listad").val() == "") {
            toastr.warning('Falta seleccion el asesor', 'Atención!');
        }else {

            if (block.alias == "") {
                block.alias = "No asignado";
            }

            if (window.localStorage.getItem("Money-vars-token") !== null) {
                block.tokens = JSON.parse(window.localStorage.getItem("Money-vars-token"));
            } else {
                block.tokens = JSON.parse(window.sessionStorage.getItem("Money-vars-token"));
            }

            block.estraa = $("#selector_asesores_listad").val();
            block.estraaq = block.estraa.split("_");
            block.estra = block.estraaq[0];
            block.cedulasesor = block.estraaq[1];
            block.fotoas = block.estraaq[2];
            block.arrays = [block.tokens[1], block.perfil, block.normal, block.reverso, block.pais, block.tipo, block.numero, block.nom1, block.nom2, block.ape1, block.ape2, block.direction, block.departamento, block.ciudad, block.barrio, block.telefofijo, block.telefomovil, block.correo, block.asesorSuperAsis, block.monto, block.estra, block.alias, block.fronatls];

            block.obj = {"r": "crear_cliente_admin", "d": block.arrays};
            backend.conexionEnvio(JSON.stringify(block.obj), function (salida) {
                var valor = JSON.parse(salida);
                if (!valor.e) {
                    block.escrito = block.nom1 + " " + block.nom2 + " " + block.ape1 + " " + block.ape2;
                    window.sessionStorage.setItem("Money-vars-registrado", block.numero);
                    window.sessionStorage.removeItem("Money-vars-foto-id-reversomd");
                    window.sessionStorage.removeItem("Money-vars-foto-id-normalmd");
                    $("#foto_user_clien").attr("src", window.sessionStorage.getItem("Money-vars-foto-idmd"));
                    window.sessionStorage.removeItem("Money-vars-foto-idmd");
                    window.sessionStorage.removeItem("Money-vars-foto-frontald");
                    $("#telefono_fijomd").val("");
                    $("#telefono_celmd").val("");
                    $("#correo_electronicomd").val("");
                    $("#tipo_cargomd option[value=a]").attr("selected", true);
                    $("#pais_selecionadomd option[value='1']").attr("selected", true);
                    $("#selector_asesores_listad option[value='']").attr("selected", true);
                    $("#tipo_departamentomd option[value='']").attr("selected", true);
                    $("#tipo_ciudadesmd option[value='']").attr("selected", true);
                    $("#tipo_barriomd option[value='']").attr("selected", true);
                    $("#numero_idmd").val("");
                    $("#nombre_id1md").val("");
                    $("#nombre_id2md").val("");
                    $("#apellido_id1md").val("");
                    $("#apellido_id2md").val("");
                    $("#direccion_ubicamd").val("");
                    $("#numero_idmd").prop("disabled", false);
                    $("#letra_venezuelamd").css("display", "none");
                    $("#foto_m1md").attr("src", "../img/foto_cedula_front.png");
                    $("#foto_m4md").attr("src", "../img/default.jpg");
                    $("#foto_m2md").attr("src", "../img/foto_cedula_back.png");
                    $("#foto_m3md").attr("src", "../img/foto_resivo.png");
                    $("#cedula_divmd").removeClass("col-sm-6").removeClass("col-md-3").removeClass("col-xs-12").addClass("col-xs-6").addClass("col-sm-6").addClass("col-md-6");
                    toastr.success('Registrado correctamente', 'Atención!');
                }
            });
        }

    });

    $("#crear_contrato_form_dos").css("display", "none");
    $("#crear_contrato_form").css("display", "none");
    $("#lista_ase").css("display", "none");
    $("#lista_sup").css("display", "none");
    $("#lista_ayu").css("display", "none");
    $("#busqueda_asignaciones").css("display", "none");
    $("#configuracion_general").css("display", "none");
    $("#lista_asi_ayu").css("display", "none");
    $("#lista_asi_sup").css("display", "none");
    $("#configuracion_general_cuotas").css("display", "none");
    $("#asig_supervidor").css("display", "none");
    $("#liquidacion_page").css("display", "none");
    $("#liquidacion_page2").css("display", "none");
    $("#contratos_view").css("display", "block");
    $("#cierre_view").css("display", "none");
    $("#HistorialClientes").css("display","none");
    // $("#cliente_lista_admi").css("display", "none");

    function crear_contrato() {
        $("#lista_ase").css("display", "none");
        $("#lista_sup").css("display", "none");
        $("#lista_ayu").css("display", "none");
        $("#asig_supervidor").css("display", "none");
        $("#lista_asi_ayu").css("display", "none");
        $("#lista_asi_sup").css("display", "none");
        $("#configuracion_general").css("display", "none");
        $("#busqueda_asignaciones").css("display", "none");
        $("#configuracion_general_cuotas").css("display", "none");
        $("#crear_contrato_form").css("display", "initial");
        $("#crear_contrato_form_dos").css("display", "initial");
        $("#liquidacion_page2").css("display", "none");
        $("#liquidacion_page").css("display", "none");
        $("#create_clientes_listo").css("display", "none");
        $("#contratos_view").css("display", "none");
        $("#cierre_view").css("display", "none");
        $("#HistorialClientes").css("display","none");
        // $("#cliente_lista_admi").css("display", "none");

        if (window.localStorage.getItem("Money-vars-token") !== null) {
            block.tokens = JSON.parse(window.localStorage.getItem("Money-vars-token"));
        } else {
            block.tokens = JSON.parse(window.sessionStorage.getItem("Money-vars-token"));
        }

        block.listax2 = '<option value="">Seleccione</option>';
        block.lista = '';
        block.arrays = [block.tokens[1]];
        block.obj = {"r": "listar_asesores", "d": block.arrays};
        backend.conexionEnvio(JSON.stringify(block.obj), function (salida) {
            var valor = JSON.parse(salida);
            if (!valor.e) {
                block.todo = valor.d[1];
                for (var t = 0; t < block.todo.length; t++) {
                    block.item = JSON.parse(block.todo[t]);
                    block.listax2 = block.listax2 + '<option value="' + block.item[22] + '_'+ block.item[6] +'_'+ block.item[1] +'">' + block.item[7] + ' ' + block.item[9] + ' ID: ' + block.item[22] + '</option>';
                }
                $("#selector_asesores_lista").html(block.listax2);
            }
        });
    }

    $("#selector_asesores_lista").change(function () {
        if ($("#selector_asesores_lista").val() !== "") {
            $("#text_cedula_cliente").prop("disabled", false);
            $("#buscar_cedula_cliente").prop("disabled", false);
            $("#crear_contrato").prop("disabled",true);
        }
    });

    function asesores_lista_ajustada() {

        if (window.localStorage.getItem("Money-vars-token") !== null) {
            block.tokens = JSON.parse(window.localStorage.getItem("Money-vars-token"));
        } else {
            block.tokens = JSON.parse(window.sessionStorage.getItem("Money-vars-token"));
        }

        block.listax2 = '<option value="">Seleccione</option>';
        block.listax3 = '<option value="">Seleccione asesor</option>';
        block.lista = '';
        block.arrays = [block.tokens[1]];
        block.obj = {"r": "listar_asesores_para_supervisores", "d": block.arrays};
        backend.conexionEnvio(JSON.stringify(block.obj), function (salida) {
            var valor = JSON.parse(salida);
            if (!valor.e) {
                block.todo = valor.d[1];
                block.aline =[];
                for (var t = 0; t < block.todo.length; t++) {
                    block.item = JSON.parse(block.todo[t]);
                    block.aline.push([block.item[22],block.item[6]]);
                    block.listax2 = block.listax2 + '<option value="' + block.item[22] + '_'+ block.item[6] +'_'+ block.item[1] +'">' + block.item[7] + ' ' + block.item[9] + ' ID: ' + block.item[22] + '</option>';
                    block.listax3 = block.listax3 + '<option value="' + block.item[22] + '">' + block.item[7] + ' ' + block.item[9] + ' ID: ' + block.item[22] + '</option>';
                }
                $("#lista_asesores_general").html(block.listax2);
                $("#lista_asesores_general2").html(block.listax3);
                $("#lista_asesores_general3").html(block.listax3);
                $("#id_asesor_gastos_consulta").html(block.listax2);
                $("#id_asesor_cobros").html(block.listax2);
                $("#id_asesor_cierre").html(block.listax2);
                liquidar_sincro(block.aline);
            }
        });
    }

    asesores_lista_ajustada();

    $("#busqueda_gasto").click(function(){
        extraer_gastos();
    });

    $("#busqueda_cobros").click(function(){
        extraer_cobros("#id_asesor_cobros","#listado_cobros_por_fechas",false);
    });

    //Funcion para extraer datos con fecha pasandole la fecha al array
    function extraer_gastos() {
        $("#lista_gastos_exe").empty();
        if (window.localStorage.getItem("Money-vars-token") !== null) {
            block.tokens = JSON.parse(window.localStorage.getItem("Money-vars-token"));
        } else {
            block.tokens = JSON.parse(window.sessionStorage.getItem("Money-vars-token"));
        }

        var fecha = $("#fecha_gasto").val()
        block.estraa = $("#id_asesor_gastos_consulta").val();
        block.estraaq = block.estraa.split("_");
        block.estra = block.estraaq[0];
        block.cedulasesor = block.estraaq[1];
        block.arrays = [block.tokens[1], block.estra, fecha];
        block.obj = {"r": "buscar_gastos_fecha", "d": block.arrays};
        backend.conexionEnvio(JSON.stringify(block.obj), function (salida) {
        var valor = JSON.parse(salida);
            if (!valor.e) {
                block.pasero = JSON.parse(valor.d[1]);
                block.inefd = '';
                for (var wq = 0; wq < block.pasero.length; wq++) {
                    block.iteds = block.pasero[wq];
                    block.iteds[2] = block.iteds[2].toString().split('').reverse().join('').replace(/(?=\d*\.?)(\d{3})/g, '$1.');
                    block.iteds[2] = block.iteds[2].split('').reverse().join('').replace(/^[\.]/, '');
                    block.inefd = block.inefd + '<tr><td>' + block.iteds[1] + '</td><td>Q' + block.iteds[2] + '</td></tr>';
                }
                $("#lista_gastos_exe").html(block.inefd);
            } else {
                toastr.warning("No hay gastos registrados para la fecha establecida", "Atención");
            }
        });
    }

    function extraer_cobros(id_asesor, id_tabla, hoy) {        
        if (window.localStorage.getItem("Money-vars-token") !== null) {
            block.tokens = JSON.parse(window.localStorage.getItem("Money-vars-token"));
        } else {
            block.tokens = JSON.parse(window.sessionStorage.getItem("Money-vars-token"));
        }
        var fecha =  $("#fecha_busqueda_cobros").val();
        
        block.estraa = $(id_asesor).val();
        block.estraaq = block.estraa.split("_");
        block.estra = block.estraaq[0];
        block.cedulasesor = block.estraaq[1];
        block.arrays = [block.tokens[1], block.estra, fecha];
        block.obj = {"r": "buscar_cobros_fecha", "d": block.arrays};
        backend.conexionEnvio(JSON.stringify(block.obj), function (salida) {
            var valor = JSON.parse(salida);
            var cobro;
            block.inefd='';
            if(valor.d[1].length>0){
                for(var j=0; j<valor.d[1].length;j++){
                    cobro = valor.d[1][j];
                    block.inefd +='<tr><td>' + cobro.dpi + '</td><td>' + cobro.nombre + '</td><td>'+ cobro.direccion+ '</td><td>' + cobro.monto+ '</td><td>' + cobro.hora+'</td></tr>';
                }
                $(id_tabla).html(block.inefd);
            }
        });
    }

    function extraer_cobrosCierre(id_tabla) {
        $("#listado_cobros_cierre").empty();
        if (window.localStorage.getItem("Money-vars-token") !== null) {
            block.tokens = JSON.parse(window.localStorage.getItem("Money-vars-token"));
        } else {
            block.tokens = JSON.parse(window.sessionStorage.getItem("Money-vars-token"));
        }
        var fecha =  $("#fecha_busqueda_cobros_supervisor").val();
        
        block.estraa = $("#id_asesor_cierre").val();
        block.estraaq = block.estraa.split("_");
        block.estra = block.estraaq[0];
        block.cedulasesor = block.estraaq[1];
        block.arrays = [block.tokens[1], block.estra, fecha];
        block.obj = {"r": "buscar_cobros_fecha", "d": block.arrays};
        backend.conexionEnvio(JSON.stringify(block.obj), function (salida) {
            var valor = JSON.parse(salida);
            var cobro;
            block.inefd='';
            if(valor.d[1].length>0){
                for(var j=0; j<valor.d[1].length;j++){
                    cobro = valor.d[1][j];
                    block.inefd +='<tr><td>' + cobro.dpi + '</td><td>' + cobro.nombre + '</td><td>'+ cobro.direccion+ '</td><td>' + cobro.monto+ '</td><td>' + cobro.hora+'</td></tr>';
                }
                $(id_tabla).html(block.inefd);
            }
        });
    }

    function ver_imagen(uno, dos, tres) {
        $("#idfoto").attr("src", uno);
        $("#caratula").attr("src", dos);
        $("#reverso").attr("src", tres);
        $("#identidad_fotos").modal("show");
    }

    function cargarListas_asigandos() {
        if (window.localStorage.getItem("Money-vars-token") !== null) {
            block.tokens = JSON.parse(window.localStorage.getItem("Money-vars-token"));
        } else {
            block.tokens = JSON.parse(window.sessionStorage.getItem("Money-vars-token"));
        }

        var hoy = moment().format('DD_MM_YYYY');
        block.lista = '';
        block.arrays = [block.tokens[1], hoy, block.tokens[4]];
        block.obj = {"r": "lista_asigandos_fecha", "d": block.arrays};
        backend.conexionEnvio(JSON.stringify(block.obj), function (salida) {
            var valor = JSON.parse(salida);
            if (!valor.e) {
                block.tods = valor.d[1];
                block.lista1 = "";
                block.lista2 = "";
                for (var f = 0; f < block.tods.length; f++) {
                    block.itme = JSON.parse(block.tods[f]);
                    if (block.itme[1] == "b") {
                        block.unosa = block.itme[2].split("_");
                        block.unosb = block.itme[3].split("_");
                        block.nombreAsesor = block.unosa[3] + " " + block.unosa[4] + " ID:" + block.unosa[2];
                        block.nombreAyudante = block.unosb[3] + " " + block.unosb[4] + " ID:" + block.unosb[2];
                        block.lista1 = block.lista1 + '<tr><td>' + block.nombreAyudante + '</td><td>' + block.nombreAsesor + '</td></tr>';
                    } else {
                        block.unosa = block.itme[2].split("_");
                        block.unosb = block.itme[3].split("_");
                        block.nombreAsesor = block.unosa[3] + " " + block.unosa[4] + " ID:" + block.unosa[2];
                        block.nombreSupervisor = block.unosb[3] + " " + block.unosb[4] + " ID:" + block.unosb[2];
                        block.lista2 = block.lista2 + '<tr><td>' + block.nombreSupervisor + '</td><td>' + block.nombreAsesor + '</td></tr>';
                    }
                }
                $("#listado_ayudante_asignado").html(block.lista1);
                $("#listado_supervisor_asignado").html(block.lista2);
            }
        });

        block.listax = '<option value="">Seleccione</option>';
        block.listax2 = '<option value="">Seleccione</option>';
        block.arrays = [block.tokens[1]];
        block.obj = {"r": "listar_asesores", "d": block.arrays};
        backend.conexionEnvio(JSON.stringify(block.obj), function (salida) {
            var valor = JSON.parse(salida);
            if (!valor.e) {
                block.todo = valor.d[1];
                for (var t = 0; t < block.todo.length; t++) {
                    block.item = JSON.parse(block.todo[t]);
                    if (block.item[4] == "2") {
                        block.cedula = block.item[5] + block.item[6];
                    } else {
                        block.cedula = block.item[6];
                    }
                    block.nom = block.item[7] + ' ' + block.item[9] + ' - ' + block.cedula;
                    block.listax = block.listax + '<option value="' + block.item[22] + '_asesor_' + block.item[23] + '_' + block.item[7] + '_' + block.item[9] + '">' + block.nom + '</option>';
                    block.listax2 = block.listax2 + '<option value="' + block.item[22] + '">' + block.item[7] + ' ' + block.item[9] + ' ID:' + block.item[22] + '</option>';
                }
                $("#tipo_cargo_dos").html(block.listax);
                $("#id_asesor").html(block.listax2);
                $("#id_asesor_consulta").html(block.listax2);                
            }
        });
    }

    function totalGastos(){
        $("#text_gastosAsesor").empty();
        block.fechaABuscar = $("#fecha_busqueda_cobros_supervisor").val();
        if (window.localStorage.getItem("Money-vars-token") !== null) {
            block.tokens = JSON.parse(window.localStorage.getItem("Money-vars-token"));
        } else {
            block.tokens = JSON.parse(window.sessionStorage.getItem("Money-vars-token"));
        }
        let gastos = 0;
        block.arrays = [ block.tokens[1], $("#id_asesor_cierre").val().split('_')[0], block.fechaABuscar ];
        block.obj = {"r": "extrae_gastos_supervisor", "d": block.arrays};
        backend.conexionEnvio(JSON.stringify(block.obj), function (salida) {
            var valor = JSON.parse(salida);
            if (!valor.e) {
                block.pasero = JSON.parse(valor.d[1]);
                
                for(var i= 0; i< block.pasero.length; i++){
                    gastos += parseFloat(block.pasero[i][2]);
                }
                $("#text_gastosAsesor").text("Q"+gastos);
                const base = parseFloat($("#text_baseAsesor").text().slice(1));
                const recaudado = parseFloat($("#text_recolectadoAsesor").text().slice(1));
                const totalSistema = base + recaudado-gastos;
                $("#text_total_sistema").text("Q"+totalSistema);
            } else {
                $("#text_diferencia_cierre").text("0");
            }
        });
        return gastos;
    }

    $("#btn_buscar_cierre_supervisor").click(function(){        
        $("#lista_gastos_exeAsesor").empty();                     
        if($("#id_asesor_cierre").val()!=="" || $("#fecha_busqueda_cobros_supervisor").val() !== ""){
            block.ase = $("#id_asesor_cierre").val().split("_");
            block.ase = block.ase[0];
            block.fechaABuscar = $("#fecha_busqueda_cobros_supervisor").val();
            $("#lista_enorme").html("");
            listado_contratos("0");
    
            if (window.localStorage.getItem("Money-vars-token") !== null) {
                block.tokens = JSON.parse(window.localStorage.getItem("Money-vars-token"));
            } else {
                block.tokens = JSON.parse(window.sessionStorage.getItem("Money-vars-token"));
            }
    
            block.arrays = [block.tokens[1]];  
            block.obj = {"r": "down_configuracion", "d": block.arrays};
            backend.conexionEnvio(JSON.stringify(block.obj), function (salida) {
                var valor = JSON.parse(salida);
                if (!valor.e && valor.d[1] !== null) {
                    window.sessionStorage.setItem("Configuracion",valor.d[1]);
                }
            });
            
            block.arrays = [ block.tokens[1],block.ase, block.fechaABuscar ];
            block.obj = { "r": "sumatoria_diario_supervisor", "d": block.arrays }; //Obtiene el token y el ID del asesor
            backend.conexionEnvio(JSON.stringify(block.obj), function (salida) {
                var valor = JSON.parse(salida);
                if (!valor.e) {                
                    $("#text_recolectadoAsesor").text("Q"+valor.d[1]);
                    $("#text_baseAsesor").text("Q"+valor.d[2]);
                    const base = parseFloat($("#text_baseAsesor").text().slice(1));
                    const recaudado = parseFloat($("#text_recolectadoAsesor").text().slice(1));
                    const totalSistema = base + recaudado;
                    $("#text_total_sistema").text("Q"+totalSistema);

                    if( valor.d[2] == 0 || valor.d[4] ){
                        $("#registrar_cierre").prop("disabled", true);
                        $("#text_total_asesor").val(valor.d[5]);
                        $("#text_total_asesor").prop("disabled", true);
                        $("#text_diferencia_cierre").text( valor.d[6] == '' ? 0 : parseInt(valor.d[6]) );
                    } else {
                        $("#text_diferencia_cierre").text("Debe calcular diferencia");
                        $("#registrar_cierre").prop("disabled", false);
                        $("#text_total_asesor").val(0);
                        $("#text_total_asesor").prop("disabled", false);
                    }
                    totalGastos();
                } else {
                    $("#text_diferencia_cierre").text("0");
                }
            });
            extraer_gastosAsesor();
            extraer_cobrosCierre("#listado_cobros_cierre");
        } else {
            toastr.warning("Hay campos vacíos", "Atención");
        }
    })

    $("#registrar_cierre").click(function(){
        const totalAsesor = $('#text_total_asesor').val();
        const base = parseFloat($("#text_baseAsesor").text().slice(1)); 
        const asesor = $('#id_asesor_cierre').val();
        if ( parseInt(totalAsesor) < 0 ) {
            toastr.warning('El total del asesor debe de ser un valor positivo.', 'Atención!');
        } else if ( totalAsesor != "" && totalAsesor != 0 && base != 0 && asesor != ""  ){
            registrarCierre(totalAsesor,base,asesor);
        } else {
            toastr.warning('El total del asesor y tener una base diaria es necesario.', 'Atención!');
        }

    });

    function registrarCierre(totalAsesor,base,asesor){
        block.asesor =  $('#id_asesor_cierre').val();
        block.diferencia = $("#text_diferencia_cierre").text().slice(1);
        const fecha_cierre = $("#fecha_busqueda_cobros_supervisor").val();

        if (window.localStorage.getItem("Money-vars-token") !== null) {
            block.tokens = JSON.parse(window.localStorage.getItem("Money-vars-token"));
        } else {
            block.tokens = JSON.parse(window.sessionStorage.getItem("Money-vars-token"));
        }
        const id_usuario = block.tokens[5] = "-" ? "sa" : block.tokens[5];
        block.arrays = [block.tokens[1], fecha_cierre, totalAsesor, asesor.split('_')[0], id_usuario, block.diferencia];
        block.obj = {"r": "registrar_cierre", "d": block.arrays};
        backend.conexionEnvio(JSON.stringify(block.obj), function (salida) {
            var valor = JSON.parse(salida);
            if (valor.d[1]) {
                toastr.success('Registrado con exito', 'Atención!');
                setTimeout(() => {
                    location.reload();
                }, 1500);
            }
        });
    }

    function extraer_gastosAsesor() {        
        $("#lista_gastos_exeAsesor").empty();
        if (window.localStorage.getItem("Money-vars-token") !== null) {
            block.tokens = JSON.parse(window.localStorage.getItem("Money-vars-token"));
        } else {
            block.tokens = JSON.parse(window.sessionStorage.getItem("Money-vars-token"));
        }
    
        var fecha = $("#fecha_busqueda_cobros_supervisor").val();
        block.estraa = $("#id_asesor_cierre").val().split('_');
        block.estraa = block.estraa[0];
        block.arrays = [block.tokens[1], block.estraa, fecha];
        block.obj = {"r": "buscar_gastos_fecha", "d": block.arrays};
        backend.conexionEnvio(JSON.stringify(block.obj), function (salida) {
            var valor = JSON.parse(salida);
            if (!valor.e) {
                block.pasero = JSON.parse(valor.d[1]);
                block.inefd = '';
                for (var wq = 0; wq < block.pasero.length; wq++) {
                    block.iteds = block.pasero[wq];
                    block.iteds[2] = block.iteds[2].toString().split('').reverse().join('').replace(/(?=\d*\.?)(\d{3})/g, '$1.');
                    block.iteds[2] = block.iteds[2].split('').reverse().join('').replace(/^[\.]/, '');
                    block.inefd = block.inefd + '<tr><td>' + block.iteds[1] + '</td><td>Q' + block.iteds[2] + '</td></tr>';
                }
                $("#lista_gastos_exeAsesor").html(block.inefd);
            } else {
                toastr.warning("No se registraron gastos en la fecha seleccionada", "Atención");
            }
        });        
    }

    function asignar_supervisor_asesor() {
        $("#crear_contrato_form").css("display", "none");
        $("#crear_contrato_form_dos").css("display", "none");
        $("#asig_supervidor").css("display", "initial");
        $("#lista_ayu").css("display", "none");
        $("#lista_sup").css("display", "none");
        $("#lista_ase").css("display", "none");
        $("#busqueda_asignaciones").css("display", "initial");
        $("#lista_asi_ayu").css("display", "initial");
        $("#lista_asi_sup").css("display", "initial");
        $("#configuracion_general").css("display", "none");
        $("#configuracion_general_cuotas").css("display", "none");
        $("#liquidacion_page2").css("display", "none");
        $("#liquidacion_page").css("display", "none");
        $("#create_clientes_listo").css("display", "none");
        $("#contratos_view").css("display", "none");
        $("#cierre_view").css("display", "none");
        $("#HistorialClientes").css("display","none");
        // $("#cliente_lista_admi").css("display", "none");

        cargarListas_asigandos();
    }


    $("#busqueda_directa").click(function () {
        if ($("#id_asesor").val() !== "" && $("#fecha_asesor").val() !== "") {

            if (window.localStorage.getItem("Money-vars-token") !== null) {
                block.tokens = JSON.parse(window.localStorage.getItem("Money-vars-token"));
            } else {
                block.tokens = JSON.parse(window.sessionStorage.getItem("Money-vars-token"));
            }

            block.uni = $("#fecha_asesor").val();
            block.dos = block.uni.replace("-", "_");
            block.tres = block.dos.replace("-", "_");
            block.nuve = block.tres.split("_");
            block.list = block.nuve[2] + "_" + block.nuve[1] + "_" + block.nuve[0];

            block.lista = '';
            block.arrays = [block.tokens[1], block.list, block.tokens[4], $("#id_asesor").val()];
            block.obj = {"r": "lista_asigandos_fecha2", "d": block.arrays};
            backend.conexionEnvio(JSON.stringify(block.obj), function (salida) {
                var valor = JSON.parse(salida);
                if (!valor.e) {
                    block.tods = valor.d[1];
                    block.lista1 = "";
                    block.lista2 = "";
                    for (var f = 0; f < block.tods.length; f++) {
                        block.itme = JSON.parse(block.tods[f]);
                        if (block.itme[1] == "b") {
                            block.unosa = block.itme[2].split("_");
                            block.unosb = block.itme[3].split("_");
                            block.nombreAsesor = block.unosa[3] + " " + block.unosa[4] + " ID:" + block.unosb[2];
                            block.nombreAyudante = block.unosb[3] + " " + block.unosb[4] + " ID:" + block.unosb[2];
                            block.lista1 = block.lista1 + '<tr><td>' + block.nombreAyudante + '</td><td>' + block.nombreAsesor + '</td></tr>';
                        } else {
                            block.unosa = block.itme[2].split("_");
                            block.unosb = block.itme[3].split("_");
                            block.nombreAsesor = block.unosa[3] + " " + block.unosa[4] + " ID:" + block.unosb[2];
                            block.nombreSupervisor = block.unosb[3] + " " + block.unosb[4] + " ID:" + block.unosb[2];
                            block.lista2 = block.lista2 + '<tr><td>' + block.nombreSupervisor + '</td><td>' + block.nombreAsesor + '</td></tr>';
                        }
                    }
                    $("#listado_ayudante_asignado").html(block.lista1);
                    $("#listado_supervisor_asignado").html(block.lista2);
                }
            });
        }
    });

    $("#buscar_cedula_cliente_historia").click(function () {

        $('#listado_historial_cliente').empty();

        if ($("#text_cedula_cliente_historial").val() !== "") {
            if (window.localStorage.getItem("Money-vars-token") !== null) {
                block.tokens = JSON.parse(window.localStorage.getItem("Money-vars-token"));
            } else {
                block.tokens = JSON.parse(window.sessionStorage.getItem("Money-vars-token"));
            }

            block.arrays = [ block.tokens[1], $("#text_cedula_cliente_historial").val() ];
            block.obj = { "r": "buscar_cliente_supervisor", "d": block.arrays };
            backend.conexionEnvio(JSON.stringify(block.obj), function (salida) {
                var valor = JSON.parse(salida);                
                if ( !valor.e ) {
                    block.partes = JSON.parse(valor.d[1]);
                    block.nomre = block.partes[8] +" "+block.partes[9] +" "+block.partes[10] + " "+block.partes[11];
                    block.comportamiento = valor.d[3] < 0 ? 'El cliente paga puntual' : 'El cliente paga atrasado';
                    // Agregar una nueva fila a la tabla
                    $('#listado_historial_cliente').append('<tr><td>'+block.nomre+'</td><td>'+valor.d[2]+'</td><td>'+block.comportamiento+'</td></tr>');
                } else {
                    toastr.warning('El cliente no posee contratos finalizados', 'Atención!');
                }
            });
        } else {
            toastr.warning('Falta DPI del cliente', 'Atención!');
        }
    });

    function ValorToMonto(valor, callback) {
        block.valorNum = valor.toString();
        block.valorNumExpa = block.valorNum.split("");
        block.valorNumMou = block.valorNumExpa.length / 3;
        block.valorNumpes = parseInt(block.valorNumMou);
        block.cons = 0;
        block.salidaya = "";
        for (var u = block.valorNumExpa.length - 1; u > -1; u--) {
            if (block.cons == 3) {
                block.cons = 1;
                block.salidaya = "." + block.salidaya;
            } else {
                block.cons++;
            }
            block.salidaya = block.valorNumExpa[u] + block.salidaya;
        }
        return callback(block.salidaya);
    }

    $("#monto_num_interes").keyup(function () {
        block.numero = $("#monto_num_interes").val();
        if (block.numero > 99) {
            block.numero = 100;
            $("#monto_num_interes").val(100);
        }
    });

    $("#monto_num_interes").change(function () {
        block.numero = $("#monto_num_interes").val();
        if (block.numero > 99) {
            block.numero = 100;
            $("#monto_num_interes").val(100);
        }
    });

    $("#monto_num_prestamo").keyup(function () {
        block.numero = $("#monto_num_prestamo").val();
        if (block.numero > 50000) {
            block.numero = 50000;
            $("#monto_num_prestamo").val(block.numero);
            $("#prestamo_principal").val(block.numero);
            ValorToMonto(block.numero, function (salidax) {
                $("#prestamo_principal_ini").html("$" + salidax);
            });
        } else {
            $("#prestamo_principal").val(block.numero);
            ValorToMonto(block.numero, function (salidax) {
                $("#prestamo_principal_ini").html("$" + salidax);
            });
        }
    });

    $("#boton_pdf").click(function () {
        var divContents = $("#liquidacion_page").html();
        var printWindow = window.open('', '', 'height=400,width=800');
        printWindow.document.write(`<html><head><title>Listado de contratos de un asesor</title>`);
        printWindow.document.write(`</head><body>`);
        printWindow.document.write(divContents);
        printWindow.document.write('< /body></html>');        
        printWindow.document.close();
        printWindow.print();
    });

    $("#monto_num_prestamo2").keyup(function () {
        block.numero = $("#monto_num_prestamo2").val();
        if (block.numero > 99999998) {
            block.numero = 99999999;
            $("#monto_num_prestamo2").val(block.numero);
            $("#prestamo_principal2").val(block.numero);
            ValorToMonto(block.numero, function (salidax) {
                $("#prestamo_principal_ini2").html("$" + salidax);
            });
        } else {
            $("#prestamo_principal2").val(block.numero);
            ValorToMonto(block.numero, function (salidax) {
                $("#prestamo_principal_ini2").html("$" + salidax);
            });
        }
    });

    $("#monto_num_prestamo2").change(function () {
        block.numero = $("#monto_num_prestamo2").val();
        if (block.numero > 99999998) {
            block.numero = 99999999;
            $("#monto_num_prestamo2").val(block.numero);
            $("#prestamo_principal2").val(block.numero);s
            ValorToMonto(block.numero, function (salidax) {
                $("#prestamo_principal_ini2").html("$" + salidax);
            });
        } else {
            $("#prestamo_principal2").val(block.numero);
            ValorToMonto(block.numero, function (salidax) {
                $("#prestamo_principal_ini2").html("$" + salidax);
            });
        }
    });

    $("#dias_colores").change(function () {
        if ($("#dias_colores").val() !== "") {
            $("#color_click").click();
        }
    });

    function consulta_x(){
        block.num = window.sessionStorage.getItem("numero_lista");
        if (window.localStorage.getItem("Money-vars-token") !== null) {
            block.tokens = JSON.parse(window.localStorage.getItem("Money-vars-token"));
        } else {
            block.tokens = JSON.parse(window.sessionStorage.getItem("Money-vars-token"));
        }
        block.listadi ="";
        block.arrays = [block.tokens[1],$("#lista_asesores_general2").val(),block.num];
        block.obj = {"r": "lista_cliente_basic_asesor", "d": block.arrays};
        backend.conexionEnvio(JSON.stringify(block.obj), function (salida) {
            var valor = JSON.parse(salida);
            if (!valor.e) {
                if(valor.d[1]!==null) {
                    block.item = JSON.parse(valor.d[1]);
                    block.cedula = block.item[7];
                    block.nomre = block.item[8];
                    block.nomre2 = block.item[9];
                    block.apellido = block.item[10];
                    block.apellido2 = block.item[11];
                    block.direcion = block.item[12];
                    block.telefono = block.item[16];
                    block.listadi = block.listadi + '<tr><td>' + block.nomre + ' ' + block.nomre2 + ' ' + block.apellido + ' ' + block.apellido2 + '</td><td>' + block.cedula + '</td><td>' + block.direcion + '</td><td>' + block.telefono + '</td><td><a href="javascript:editar_cliente(' + String.fromCharCode(39) + block.cedula + String.fromCharCode(39) + ');">Editar</a></td></tr>';
                    $("#listado_liengenerela").append(block.listadi);
                    block.nexr = parseInt(block.num) + 1;
                    window.sessionStorage.setItem("numero_lista", block.nexr);
                    consulta_x();
                }
            }
            // else{
            //     if(valor.d[1]=="4"){
            //         $("#listado_liengenerela").html("");
            //         window.sessionStorage.setItem("numero_lista","0");
            //     }
            // }
        });
    }

    $("#lista_asesores_general2").change(function () {
        if($("#lista_asesores_general2").val()!==""){
            window.sessionStorage.setItem("numero_lista","0");
            consulta_x();
        }
    });


    function editar_cliente(cedula){
        alert(cedula);
    }

    // function cliente_lista() {
    //     $("#crear_contrato_form").css("display", "none");
    //     $("#crear_contrato_form_dos").css("display", "none");
    //     $("#lista_ayu").css("display", "none");
    //     $("#lista_sup").css("display", "none");
    //     $("#lista_ase").css("display", "none");
    //     $("#asig_supervidor").css("display", "none");
    //     $("#lista_asi_ayu").css("display", "none");
    //     $("#lista_asi_sup").css("display", "none");
    //     $("#configuracion_general").css("display", "none");
    //     $("#busqueda_asignaciones").css("display", "none");
    //     $("#configuracion_general_cuotas").css("display", "none");
    //     $("#liquidacion_page2").css("display", "none");
    //     $("#liquidacion_page").css("display", "none");
    //     $("#create_clientes_listo").css("display", "none");
    //     $("#contratos_view").css("display", "none");
    //     $("#cliente_lista_admi").css("display", "initial");
    //     $("#listado_liengenerela").html("");
    //     window.sessionStorage.setItem("numero_lista","0");
    // }

    $("#configurar_directa").click(function () {
        block.refinanciacioinCoun = $("#count_refinansacion").val();
        if(block.refinanciacioinCoun==""){ block.refinanciacioinCoun = 3;}
        block.nombremp = $("#nom_empresa").val();
        block.direcccion = $("#dire_empresa").val();
        block.nit_empresa = $("#nit_empresa").val();
        block.min = $("#monto_num_prestamo").val();
        block.max = $("#monto_num_prestamo2").val();
        block.sobrePrestamo = $("#mora_clientes_prestamo").val();
        block.demora = $("#selector_demora").val();
        block.is_color_lunes = $("#valor_lunes").css('background-color');
        block.is_color_martes = $("#valor_martes").css('background-color');
        block.is_color_miercoles = $("#valor_miercoles").css('background-color');
        block.is_color_jueves = $("#valor_jueves").css('background-color');
        block.is_color_viernes = $("#valor_viernes").css('background-color');
        block.is_color_sabado = $("#valor_sabado").css('background-color');
        block.is_color_domingo = $("#valor_domingo").css('background-color');

        if (window.localStorage.getItem("Money-vars-token") !== null) {
            block.tokens = JSON.parse(window.localStorage.getItem("Money-vars-token"));
        } else {
            block.tokens = JSON.parse(window.sessionStorage.getItem("Money-vars-token"));
        }

        block.arrays = [block.tokens[1], block.min, block.max, block.demora, block.is_color_lunes, block.is_color_martes, block.is_color_miercoles, block.is_color_jueves, block.is_color_viernes, block.is_color_sabado, block.is_color_domingo,block.sobrePrestamo,block.refinanciacioinCoun,block.nombremp,block.direcccion,block.nit_empresa];
        block.obj = {"r": "load_configuracion", "d": block.arrays};
        backend.conexionEnvio(JSON.stringify(block.obj), function (salida) {
            var valor = JSON.parse(salida);
            if (!valor.e) {
                toastr.success('Se ha configurado correctamente', 'Atención!');
            }
        });

    });

    if (window.localStorage.getItem("Money-vars-token") !== null) {
        block.tokens = JSON.parse(window.localStorage.getItem("Money-vars-token"));
    } else {
        block.tokens = JSON.parse(window.sessionStorage.getItem("Money-vars-token"));
    }
    $("#selector_asesores_listad").html("");
    block.listax2c = '<option value="">Seleccione</option>';
    block.lista = '';
    block.arrays = [block.tokens[1]];
    block.obj = {"r": "listar_asesores", "d": block.arrays};
    backend.conexionEnvio(JSON.stringify(block.obj), function (salida) {
        var valor = JSON.parse(salida);
        if (!valor.e) {
            block.todo = valor.d[1];

            for (var t = 0; t < block.todo.length; t++) {
                block.item = JSON.parse(block.todo[t]);
                block.listax2c = block.listax2c + '<option value="' + block.item[22] + '_'+ block.item[6] +'_'+ block.item[1] +'">' + block.item[7] + ' ' + block.item[9] + ' ID: ' + block.item[22] + '</option>';
            }

            $("#selector_asesores_listad").html(block.listax2c);
        }
    });

    function down_configuracion() {
        if (window.localStorage.getItem("Money-vars-token") !== null) {
            block.tokens = JSON.parse(window.localStorage.getItem("Money-vars-token"));
        } else {
            block.tokens = JSON.parse(window.sessionStorage.getItem("Money-vars-token"));
        }

        block.arrays = [block.tokens[1]];
        block.obj = {"r": "downconfiguracion", "d": block.arrays};
        backend.conexionEnvio(JSON.stringify(block.obj), function (salida) {
            var valor = JSON.parse(salida);
            if (!valor.e && valor.d[1] !== null) {
                block.lista = JSON.parse(valor.d[1]);
                $("#count_refinansacion").val(block.lista[12]);
                $("#monto_num_prestamo").val(block.lista[1]);
                $("#monto_num_prestamo2").val(block.lista[2]);
                $("#selector_demora option[value='" + block.lista[3] + "']").attr("selected", true);
                $("#mora_clientes_prestamo option[value='" + block.lista[11] + "']").attr("selected", true);
                $("#valor_lunes").css('background-color', block.lista[4]);
                $("#valor_martes").css('background-color', block.lista[5]);
                $("#valor_miercoles").css('background-color', block.lista[6]);
                $("#valor_jueves").css('background-color', block.lista[7]);
                $("#valor_viernes").css('background-color', block.lista[8]);
                $("#valor_sabado").css('background-color', block.lista[9]);
                $("#valor_domingo").css('background-color', block.lista[10]);
                $("#nit_empresa").val(block.lista[15]);
                $("#dire_empresa").val(block.lista[14]);
                $("#nom_empresa").val(block.lista[13]);
            }
        });
    }

    down_configuracion();


    $("#color_click").change(function () {
        block.color = $("#color_click").val();
        $("#valor_" + $("#dias_colores").val()).css("background-color", block.color);
    });

    $("#monto_num_prestamo").change(function () {
        block.numero = $("#monto_num_prestamo").val();
        if (block.numero > 50000) {
            block.numero = 50000;
            $("#monto_num_prestamo").val(block.numero);
            $("#prestamo_principal").val(block.numero);
            ValorToMonto(block.numero, function (salidax) {
                $("#prestamo_principal_ini").html("$" + salidax);
            });
        } else {
            $("#prestamo_principal").val(block.numero);
            ValorToMonto(block.numero, function (salidax) {
                $("#prestamo_principal_ini").html("$" + salidax);
            });
        }
    });

    function informe_completo(){
        $("#crear_contrato_form").css("display", "none");
        $("#crear_contrato_form_dos").css("display", "none");
        $("#lista_ayu").css("display", "none");
        $("#lista_sup").css("display", "none");
        $("#lista_ase").css("display", "none");
        $("#asig_supervidor").css("display", "none");
        $("#lista_asi_ayu").css("display", "none");
        $("#lista_asi_sup").css("display", "none");
        $("#configuracion_general").css("display", "none");
        $("#busqueda_asignaciones").css("display", "none");
        $("#configuracion_general_cuotas").css("display", "none");
        $("#create_clientes_listo").css("display", "none");
        $("#liquidacion_page").css("display", "initial");
        $("#liquidacion_page2").css("display", "initial");
        $("#contratos_view").css("display", "none");
        $("#cierre_view").css("display", "none");
        $("#HistorialClientes").css("display","none");
        $("#consulta_cobros").css("display", "none");
        $("#consulta_gastos").css("display", "none");
        $("#googleMap").css("display","none");
        // $("#cliente_lista_admi").css("display", "none");

    }

    function informe_completo_gastos(){
        $("#crear_contrato_form").css("display", "none");
        $("#crear_contrato_form_dos").css("display", "none");
        $("#lista_ayu").css("display", "none");
        $("#lista_sup").css("display", "none");
        $("#lista_ase").css("display", "none");
        $("#crear").css("display", "none");
        $("#asig_supervidor").css("display", "none");
        $("#lista_asi_ayu").css("display", "none");
        $("#lista_asi_sup").css("display", "none");
        $("#configuracion_general").css("display", "none");
        $("#busqueda_asignaciones").css("display", "none");
        $("#configuracion_general_cuotas").css("display", "none");
        $("#create_clientes_listo").css("display", "none");
        $("#liquidacion_page").css("display", "none");
        $("#contratos_view").css("display", "none");
        $("#HistorialClientes").css("display","none");
        $("#cliente_lista_admi").css("display", "none");
        $("#googleMap").css("display","none");
		$("#flotante2").css("display","none");
		$("#flotante3").css("display","none");
        $("#recaduos_ink").css("display", "none");
		$("#migrar_cion_div").css("display", "none");
		$("#suplanter").css("display", "none");
        $("#consulta_cobros").css("display", "none");
        $("#cierre_view").css("display", "none");
        $("#consulta_gastos").css("display", "initial");
        
        cargarListas_asigandos();
    }

    function informe_completo_cobros(){
        $("#crear_contrato_form").css("display", "none");
        $("#crear_contrato_form_dos").css("display", "none");
        $("#lista_ayu").css("display", "none");
        $("#lista_sup").css("display", "none");
        $("#lista_ase").css("display", "none");
        $("#crear").css("display", "none");
        $("#asig_supervidor").css("display", "none");
        $("#lista_asi_ayu").css("display", "none");
        $("#lista_asi_sup").css("display", "none");
        $("#configuracion_general").css("display", "none");
        $("#busqueda_asignaciones").css("display", "none");
        $("#configuracion_general_cuotas").css("display", "none");
        $("#create_clientes_listo").css("display", "none");
        $("#liquidacion_page").css("display", "none");
        $("#contratos_view").css("display", "none");
        $("#HistorialClientes").css("display","none");
        $("#cliente_lista_admi").css("display", "none");
        $("#googleMap").css("display","none");
		$("#flotante2").css("display","none");
		$("#flotante3").css("display","none");
        $("#recaduos_ink").css("display", "none");
		$("#migrar_cion_div").css("display", "none");
		$("#suplanter").css("display", "none");
        $("#consulta_gastos").css("display", "none");
        $("#cierre_view").css("display", "none");
        $("#consulta_cobros").css("display", "initial");
        cargarListas_asigandos();

        window.sessionStorage.setItem("numero_lista","0");
        //consulta_cobrosFecha();
    }

    function vers_contratos(){
        $("#crear_contrato_form").css("display", "none");
        $("#crear_contrato_form_dos").css("display", "none");
        $("#lista_ayu").css("display", "none");
        $("#lista_sup").css("display", "none");
        $("#lista_ase").css("display", "none");
        $("#asig_supervidor").css("display", "none");
        $("#lista_asi_ayu").css("display", "none");
        $("#lista_asi_sup").css("display", "none");
        $("#configuracion_general").css("display", "none");
        $("#busqueda_asignaciones").css("display", "none");
        $("#configuracion_general_cuotas").css("display", "none");
        $("#liquidacion_page2").css("display", "none");
        $("#liquidacion_page").css("display", "none");
        $("#create_clientes_listo").css("display", "none");
        $("#consulta_cobros").css("display", "none");
        $("#consulta_gastos").css("display", "none");
        $("#contratos_view").css("display", "initial");
        $("#HistorialClientes").css("display","none");
        $("#cierre_view").css("display","none");
        $("#googleMap").css("display","none");
        
        
        // $("#cliente_lista_admi").css("display", "none");
    }

    function crear_infor(){
        $("#HistorialClientes").css("display","none");
        $("#contratos_view").css("display", "none");
        $("#cierre_view").css("display", "none");
        $("#crear_contrato_form").css("display", "none");
        $("#crear_contrato_form_dos").css("display", "none");
        $("#lista_ayu").css("display", "none");
        $("#lista_sup").css("display", "none");
        $("#lista_ase").css("display", "none");
        $("#asig_supervidor").css("display", "none");
        $("#lista_asi_ayu").css("display", "none");
        $("#lista_asi_sup").css("display", "none");
        $("#configuracion_general").css("display", "none");
        $("#busqueda_asignaciones").css("display", "none");
        $("#configuracion_general_cuotas").css("display", "none");
        $("#liquidacion_page2").css("display", "none");
        $("#liquidacion_page").css("display", "none");
        $("#consulta_cobros").css("display", "none");
        $("#create_clientes_listo").css("display", "initial");
        // $("#cliente_lista_admi").css("display", "none");


    }

    var actuesli = moment().format('DD/MM/YYYY');
    $("#result2").val(block.actuesli);

    function myMap() {
        
        if (window.localStorage.getItem("Money-vars-token") !== null) {
            block.tokens = JSON.parse(window.localStorage.getItem("Money-vars-token"));
        } else {
            block.tokens = JSON.parse(window.sessionStorage.getItem("Money-vars-token"));
        }

        block.arrays = [block.tokens[1],block.tokens[4], block.tokens[5]];
        block.obj = {"r": "down_geo_admin", "d": block.arrays};
        backend.conexionEnvio(JSON.stringify(block.obj), function (salida) {
            var valor = JSON.parse(salida);
            if (!valor.e) {
                block.listao=valor.d[1];

                var map;
                var bounds = new google.maps.LatLngBounds();
                var mapOptions = {
                    // mapTypeId: 'roadmap',
					// gestureHandling: 'greedy'
                    center: {lat: 16.91, lng: -89.89},
                    mapTypeId: 'roadmap',
					zoom: 15,
					gestureHandling: 'greedy'
                };

                map = new google.maps.Map(document.getElementById("googleMap"), mapOptions);

                block.markesa=[];
                block.tarjetero ="";
                block.infoWindowContents=[];

                for(var q=0; q<block.listao.length; q++){
                    block.markesa.push([block.listao[q].user,parseFloat(block.listao[q].lat),parseFloat(block.listao[q].lon)]);
                    block.infoWindowContents.push(['<div class="info_content">Nombre: '+block.listao[q].user+' <br> DPI: '+block.listao[q].cedula+'</div>']);
                }

                var infoWindow = new google.maps.InfoWindow(), marker, i;
                for( i = 0; i <  block.markesa.length; i++ ) {
                    var position = new google.maps.LatLng(block.markesa[i][1], block.markesa[i][2]);
                    bounds.extend(position);
                    marker = new google.maps.Marker({
                        position: position,
                        map: map,
                        title: block.markesa[i][0]
                    });

                    google.maps.event.addListener(marker, 'click', (function(marker, i) {
                        return function() {
                            infoWindow.setContent(block.infoWindowContents[i][0]);
                            infoWindow.open(map, marker);
                        }
                    })(marker, i));
                    map.fitBounds(bounds);
                }

                var boundsListener = google.maps.event.addListener((map), 'bounds_changed', function(event) {
                    this.setZoom(18);
                    google.maps.event.removeListener(boundsListener);
                });

            }else{
                toastr.warning('No posee contratos para generar ruta', 'Atención!');
            }
        });
    }

</script>

<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCMtw9w0lIUfU8TcuAdPdDgNZuc9p_J2-Y&callback=myMap"></script>
</body>
</html>
